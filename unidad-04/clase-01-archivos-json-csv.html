<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clase 1: Persistencia en Archivos | IF0100</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <style>
        :root { --primary: #0d6efd; --success: #198754; --warning: #ffc107; --danger: #dc3545; --info: #0dcaf0; }
        header { background: linear-gradient(135deg, var(--primary) 0%, #0a58ca 100%); color: white; padding: 2rem 0; }
        .sidebar { background: #f8f9fa; border-radius: 8px; padding: 1.5rem; position: sticky; top: 2rem; }
        section { margin-bottom: 2rem; padding: 1.5rem; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        pre[class*="language-"] { border-radius: 6px; }
        .alert-tip { background: #d1e7dd; border-left: 4px solid var(--success); padding: 1rem; border-radius: 4px; }
        .alert-warning { background: #fff3cd; border-left: 4px solid var(--warning); padding: 1rem; border-radius: 4px; }
        .alert-note { background: #e7f3ff; border-left: 4px solid var(--info); padding: 1rem; border-radius: 4px; }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>IF0100 - Programación OO II</h1>
            <h2>Unidad 4: Manejo de Persistencia</h2>
            <h3>Clase 1: Persistencia en Archivos JSON y CSV</h3>
            <p class="mt-2">
                <span class="badge bg-light text-dark"><i class="bi bi-calendar3"></i> Martes, 28 de abril de 2026</span>
                <span class="badge bg-info text-dark">Semana 13 - Martes (120 minutos)</span>
                <span class="badge bg-primary">60 min Teoría</span>
                <span class="badge bg-success text-white">60 min Práctica</span>
            </p>
            <p class="mt-2">
                <a href="../evaluaciones/evaluacion-05-crud-fastapi.html" class="badge bg-danger text-decoration-none">
                    <i class="bi bi-clipboard-check"></i> E5: Proyecto SQLAlchemy - Jueves 07/05/2026 (9 días)
                </a>
            </p>
        </div>
    </header>

    <div class="container mt-4">
        <div class="row">
            <aside class="col-lg-3">
                <nav class="sidebar">
                    <h5>Contenido</h5>
                    <ul class="list-unstyled">
                        <li><a href="#objetivos" class="text-decoration-none">Objetivos</a></li>
                        <li><a href="#json" class="text-decoration-none">Archivos JSON</a></li>
                        <li><a href="#csv" class="text-decoration-none">Archivos CSV</a></li>
                        <li><a href="#pathlib" class="text-decoration-none">pathlib</a></li>
                        <li><a href="#ejercicio" class="text-decoration-none">Ejercicio</a></li>
                    </ul>
                </nav>
            </aside>

            <main class="col-lg-9">
                <section id="objetivos">
                    <h2 class="text-primary border-bottom pb-2">Objetivos de Aprendizaje</h2>
                    <p>Al finalizar esta clase, serás capaz de:</p>
                    <ul>
                        <li>Leer y escribir archivos <strong>JSON (JavaScript Object Notation)</strong> con el módulo <code>json</code></li>
                        <li>Leer y escribir archivos <strong>CSV (Comma Separated Values)</strong> con el módulo <code>csv</code></li>
                        <li>Usar <code>pathlib</code> para manejo moderno de rutas</li>
                        <li>Implementar persistencia básica para el proyecto TaskFlow</li>
                        <li>Manejar excepciones en operaciones de archivo</li>
                    </ul>
                </section>

                <section id="json">
                    <h2 class="text-primary border-bottom pb-2">Archivos JSON (20 min)</h2>
                    
                    <p><strong>JSON (JavaScript Object Notation)</strong> es un formato ligero para intercambio de datos. Python lo soporta nativamente.</p>

                    <h4>Escribir JSON</h4>
                    <pre><code class="language-python">import json
from pathlib import Path

# Datos a guardar
usuario = {
    "id": 1,
    "username": "juan123",
    "email": "juan@example.com",
    "activo": True
}

# Escribir archivo JSON
archivo = Path("data/usuario.json")
archivo.parent.mkdir(exist_ok=True)  # Crear directorio si no existe

with open(archivo, "w", encoding="utf-8") as f:
    json.dump(usuario, f, indent=4, ensure_ascii=False)

print(f"Archivo guardado en {archivo}")</code></pre>

                    <h4>Leer JSON</h4>
                    <pre><code class="language-python">import json
from pathlib import Path

archivo = Path("data/usuario.json")

with open(archivo, "r", encoding="utf-8") as f:
    datos = json.load(f)

print(datos["username"])  # "juan123"
print(datos["email"])     # "juan@example.com"</code></pre>

                    <h4>Lista de objetos JSON</h4>
                    <pre><code class="language-python">usuarios = [
    {"id": 1, "username": "juan", "email": "juan@test.com"},
    {"id": 2, "username": "ana", "email": "ana@test.com"},
    {"id": 3, "username": "pedro", "email": "pedro@test.com"}
]

# Guardar lista
with open("data/usuarios.json", "w", encoding="utf-8") as f:
    json.dump(usuarios, f, indent=2, ensure_ascii=False)

# Leer lista
with open("data/usuarios.json", "r", encoding="utf-8") as f:
    usuarios_cargados = json.load(f)

for u in usuarios_cargados:
    print(f"@{u['username']} - {u['email']}")</code></pre>
                </section>

                <section id="csv">
                    <h2 class="text-primary border-bottom pb-2">Archivos CSV (20 min)</h2>
                    
                    <p><strong>CSV (Comma Separated Values)</strong> es un formato tabular comun en hojas de calculo.</p>

                    <h4>Escribir CSV</h4>
                    <pre><code class="language-python">import csv
from pathlib import Path

tareas = [
    {"id": 1, "titulo": "Aprender Python", "completada": False},
    {"id": 2, "titulo": "Hacer proyecto", "completada": True},
    {"id": 3, "titulo": "Estudiar FastAPI", "completada": False}
]

archivo = Path("data/tareas.csv")

with open(archivo, "w", newline="", encoding="utf-8") as f:
    writer = csv.DictWriter(f, fieldnames=["id", "titulo", "completada"])
    writer.writeheader()
    writer.writerows(tareas)

print(f"CSV guardado con {len(tareas)} tareas")</code></pre>

                    <h4>Leer CSV</h4>
                    <pre><code class="language-python">import csv
from pathlib import Path

archivo = Path("data/tareas.csv")

with open(archivo, "r", encoding="utf-8") as f:
    reader = csv.DictReader(f)
    tareas = list(reader)

for tarea in tareas:
    completada = "✅" if tarea["completada"] == "True" else "⬜"
    print(f"{completada} {tarea['titulo']}")</code></pre>

                    <div class="alert-warning">
                        <strong>Importante:</strong> CSV guarda todo como texto. Necesitas convertir tipos manualmente.
                    </div>
                </section>

                <section id="pathlib">
                    <h2 class="text-primary border-bottom pb-2">Modulo pathlib (10 min)</h2>
                    
                    <p><strong>pathlib</strong> es la forma moderna de manejar rutas en Python.</p>

                    <pre><code class="language-python">from pathlib import Path

# Ruta actual
actual = Path.cwd()
print(f"Directorio actual: {actual}")

# Crear rutas
data_dir = Path("data")
archivo = data_dir / "usuarios.json"

# Verificar existencia
if not data_dir.exists():
    data_dir.mkdir(parents=True, exist_ok=True)

# Informacion del archivo
if archivo.exists():
    print(f"Nombre: {archivo.name}")        # usuarios.json
    print(f"Extension: {archivo.suffix}")   # .json
    print(f"Padre: {archivo.parent}")       # data
    print(f"Tamaño: {archivo.stat().st_size} bytes")

# Listar archivos
for f in data_dir.glob("*.json"):
    print(f"Encontrado: {f}")</code></pre>
                </section>

                <section id="ejercicio">
                    <h2 class="text-primary border-bottom pb-2">Ejercicio: Repositorio JSON (25 min)</h2>
                    
                    <p>Crear un repositorio que guarde usuarios en JSON:</p>

                    <pre><code class="language-python"># repositorio_usuario.py
import json
from pathlib import Path
from typing import Optional, List

class UsuarioRepositorioJSON:
    """Repositorio que persiste usuarios en archivo JSON."""
    
    def __init__(self, archivo: str = "data/usuarios.json"):
        self.archivo = Path(archivo)
        self._asegurar_archivo()
    
    def _asegurar_archivo(self):
        """Crea el archivo si no existe."""
        self.archivo.parent.mkdir(parents=True, exist_ok=True)
        if not self.archivo.exists():
            self._guardar_todos([])
    
    def _leer_todos(self) -> List[dict]:
        """Lee todos los usuarios del archivo."""
        with open(self.archivo, "r", encoding="utf-8") as f:
            return json.load(f)
    
    def _guardar_todos(self, usuarios: List[dict]):
        """Guarda todos los usuarios en el archivo."""
        with open(self.archivo, "w", encoding="utf-8") as f:
            json.dump(usuarios, f, indent=2, ensure_ascii=False)
    
    def crear(self, usuario: dict) -> dict:
        """Crea un nuevo usuario."""
        usuarios = self._leer_todos()
        nuevo_id = max([u["id"] for u in usuarios], default=0) + 1
        usuario["id"] = nuevo_id
        usuarios.append(usuario)
        self._guardar_todos(usuarios)
        return usuario
    
    def obtener_por_id(self, id: int) -> Optional[dict]:
        """Obtiene un usuario por su ID."""
        usuarios = self._leer_todos()
        for u in usuarios:
            if u["id"] == id:
                return u
        return None
    
    def obtener_todos(self) -> List[dict]:
        """Obtiene todos los usuarios."""
        return self._leer_todos()
    
    def actualizar(self, id: int, datos: dict) -> Optional[dict]:
        """Actualiza un usuario existente."""
        usuarios = self._leer_todos()
        for i, u in enumerate(usuarios):
            if u["id"] == id:
                usuarios[i].update(datos)
                usuarios[i]["id"] = id  # No cambiar ID
                self._guardar_todos(usuarios)
                return usuarios[i]
        return None
    
    def eliminar(self, id: int) -> bool:
        """Elimina un usuario."""
        usuarios = self._leer_todos()
        for i, u in enumerate(usuarios):
            if u["id"] == id:
                usuarios.pop(i)
                self._guardar_todos(usuarios)
                return True
        return False


# === PRUEBAS ===
if __name__ == "__main__":
    repo = UsuarioRepositorioJSON()
    
    # Crear usuarios
    u1 = repo.crear({"username": "juan", "email": "juan@test.com"})
    u2 = repo.crear({"username": "ana", "email": "ana@test.com"})
    print(f"Creados: {u1['id']}, {u2['id']}")
    
    # Listar
    print(f"Total: {len(repo.obtener_todos())} usuarios")
    
    # Actualizar
    repo.actualizar(u1["id"], {"email": "nuevo@test.com"})
    
    # Eliminar
    repo.eliminar(u2["id"])
    print(f"Despues de eliminar: {len(repo.obtener_todos())}")</code></pre>

                    <div class="alert-tip">
                        <strong>E4 Laboratorio:</strong> Implementa un repositorio CSV para tareas con las mismas operaciones CRUD.
                    </div>
                </section>

                <section>
                    <h2 class="text-primary border-bottom pb-2">Resumen</h2>
                    <ul>
                        <li><strong>json.dump()/json.load():</strong> Escribir/leer JSON</li>
                        <li><strong>csv.DictWriter/DictReader:</strong> Escribir/leer CSV</li>
                        <li><strong>pathlib.Path:</strong> Manejo moderno de rutas</li>
                        <li><strong>with open():</strong> Context manager para archivos</li>
                        <li><strong>encoding="utf-8":</strong> Siempre especificar encoding</li>
                    </ul>
                </section>
            </main>
        </div>
    </div>

    <!-- Navegación entre clases -->
    <div class="container mt-4 mb-4">
        <div class="d-flex justify-content-between align-items-center bg-light p-3 rounded">
            <div>
                <a href="../unidad-03/clase-05-persistencia-datos.html" class="btn btn-outline-secondary btn-sm">
                    ← Anterior: Persistencia de Datos
                </a>
            </div>
            <div>
                <span class="text-muted small">Clase 16 de 25</span>
            </div>
            <div>
                <a href="clase-02-sqlalchemy-modelos.html" class="btn btn-primary btn-sm">
                    Siguiente: SQLAlchemy Modelos →
                </a>
            </div>
        </div>
    </div>

    <footer class="bg-light text-center py-3 mt-5">
        <div class="container">
            <p class="mb-0">&copy; 2026 IF0100 - UNAULA | <a href="../index.html">Inicio</a></p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
</body>
</html>
