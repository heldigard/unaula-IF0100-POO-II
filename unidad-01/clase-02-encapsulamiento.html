<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clase 4: Encapsulamiento | IF0100</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <style>
        :root { --primary: #0d6efd; --success: #198754; --warning: #ffc107; --danger: #dc3545; --info: #0dcaf0; }
        header { background: linear-gradient(135deg, var(--primary) 0%, #0a58ca 100%); color: white; padding: 2rem 0; }
        .sidebar { background: #f8f9fa; border-radius: 8px; padding: 1.5rem; position: sticky; top: 2rem; }
        section { margin-bottom: 2rem; padding: 1.5rem; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        pre[class*="language-"] { border-radius: 6px; }
        .alert-tip { background: #d1e7dd; border-left: 4px solid var(--success); padding: 1rem; border-radius: 4px; }
        .alert-warning { background: #fff3cd; border-left: 4px solid var(--warning); padding: 1rem; border-radius: 4px; }
        .alert-note { background: #e7f3ff; border-left: 4px solid var(--info); padding: 1rem; border-radius: 4px; }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>IF0100 - Programación OO II</h1>
            <h2>Unidad 1: Programación Orientada a Objetos</h2>
            <h3>Clase 4: Encapsulamiento</h3>
            <p class="mt-2">
                <span class="badge bg-light text-dark"><i class="bi bi-calendar3"></i> Jueves, 19 de febrero de 2026</span>
                <span class="badge bg-info text-dark">Semana 3 - Jueves (60 minutos)</span>
                <span class="badge bg-primary">30 min Teoría</span>
                <span class="badge bg-success text-white">30 min Práctica</span>
            </p>
            <p class="mt-2">
                <a href="../evaluaciones/evaluacion-01-conceptos-poo.html" class="badge bg-danger text-decoration-none">
                    <i class="bi bi-clipboard-check"></i> E1: Examen POO - Jueves 26/02/2026 (7 días)
                </a>
            </p>
        </div>
    </header>

    <div class="container mt-4">
        <div class="row">
            <aside class="col-lg-3">
                <nav class="sidebar">
                    <h5>Contenido</h5>
                    <ul class="list-unstyled">
                        <li><a href="#objetivos" class="text-decoration-none">Objetivos</a></li>
                        <li><a href="#encapsulamiento" class="text-decoration-none">Encapsulamiento</a></li>
                        <li><a href="#convencion" class="text-decoration-none">Convención _ y __</a></li>
                        <li><a href="#property" class="text-decoration-none">@property</a></li>
                        <li><a href="#ejercicio" class="text-decoration-none">Ejercicio</a></li>
                    </ul>
                </nav>
            </aside>

            <main class="col-lg-9">
                <!-- OBJETIVOS -->
                <section id="objetivos">
                    <h2 class="text-primary border-bottom pb-2">Objetivos de Aprendizaje</h2>
                    <p>Al finalizar esta clase, serás capaz de:</p>
                    <ul>
                        <li>Comprender el concepto de encapsulamiento</li>
                        <li>Usar convenciones <code>_</code> (protegido) y <code>__</code> (privado)</li>
                        <li>Crear getters y setters con <code>@property</code></li>
                        <li>Validar datos en los setters</li>
                        <li>Aplicar encapsulamiento al modelo Usuario</li>
                    </ul>
                </section>

                <!-- ENCAPSULAMIENTO -->
                <section id="encapsulamiento">
                    <h2 class="text-primary border-bottom pb-2">¿Qué es el Encapsulamiento? (10 min)</h2>
                    
                    <p>El <strong>encapsulamiento</strong> es ocultar los detalles internos de una clase y exponer solo lo necesario. Protege los datos del acceso directo.</p>

                    <div class="alert-note">
                        <strong>Analogía:</strong> Un coche tiene un motor, pero no puedes tocarlo directamente. Solo interactúas con el volante, pedales y botones. El motor está "encapsulado".
                    </div>

                    <h4>Problema sin Encapsulamiento</h4>
                    <pre><code class="language-python">class CuentaBancaria:
    def __init__(self, saldo):
        self.saldo = saldo  # Acceso público

cuenta = CuentaBancaria(1000)
cuenta.saldo = -5000  # ¡Cualquiera puede modificar!
print(cuenta.saldo)   # -5000 (¡inválido!)</code></pre>

                    <h4>Solución con Encapsulamiento</h4>
                    <pre><code class="language-python">class CuentaBancaria:
    def __init__(self, saldo_inicial):
        self._saldo = saldo_inicial  # Atributo "protegido"
    
    def depositar(self, cantidad):
        if cantidad > 0:
            self._saldo += cantidad
    
    def retirar(self, cantidad):
        if 0 < cantidad <= self._saldo:
            self._saldo -= cantidad
    
    def obtener_saldo(self):
        return self._saldo

cuenta = CuentaBancaria(1000)
cuenta.depositar(500)
cuenta.retirar(200)
print(cuenta.obtener_saldo())  # 1300

# El saldo solo se modifica por métodos controlados
# cuenta._saldo = -5000  # No deberías hacer esto</code></pre>
                </section>

                <!-- CONVENCIÓN -->
                <section id="convencion">
                    <h2 class="text-primary border-bottom pb-2">Convenciones en Python (15 min)</h2>
                    
                    <p>Python no tiene verdaderos atributos privados como Java o C++. Usa <strong>convenciones</strong>:</p>

                    <table class="table">
                        <tr>
                            <th>Convención</th>
                            <th>Significado</th>
                            <th>Ejemplo</th>
                        </tr>
                        <tr>
                            <td><code>nombre</code></td>
                            <td>Público</td>
                            <td><code>self.nombre</code> (puede usarse libremente)</td>
                        </tr>
                        <tr>
                            <td><code>_nombre</code></td>
                            <td>Protegido</td>
                            <td><code>self._nombre</code> (no tocar desde fuera)</td>
                        </tr>
                        <tr>
                            <td><code>__nombre</code></td>
                            <td>Privado (name mangling)</td>
                            <td><code>self.__nombre</code> (difícil de acceder)</td>
                        </tr>
                    </table>

                    <pre><code class="language-python">class Ejemplo:
    def __init__(self):
        self.publico = "Todos pueden verme"
        self._protegido = "No deberías tocarme desde fuera"
        self.__privado = "Difícil de acceder desde fuera"

obj = Ejemplo()

print(obj.publico)       # ✅ Funciona
print(obj._protegido)    # ⚠️ Funciona pero no deberías
# print(obj.__privado)   # ❌ Error! No existe

# Para acceder al privado (no recomendado):
print(obj._Ejemplo__privado)  # "Difícil de acceder..."</code></pre>

                    <div class="alert-warning">
                        <strong>Regla de Oro:</strong> En Python, "somos todos adultos". No hay atributos verdaderamente privados. La convención <code>_</code> indica "no tocar" y debe respetarse.
                    </div>
                </section>

                <!-- PROPERTY -->
                <section id="property">
                    <h2 class="text-primary border-bottom pb-2">@property - Getters y Setters (20 min)</h2>
                    
                    <p>El decorador <code>@property</code> permite crear atributos "inteligentes" que ejecutan código al leer o escribir.</p>

                    <h4>Getter con @property</h4>
                    <pre><code class="language-python">class Circulo:
    def __init__(self, radio):
        self._radio = radio
    
    @property
    def radio(self):
        """Getter: se llama al leer circulo.radio"""
        print("Obteniendo radio...")
        return self._radio
    
    @property
    def area(self):
        """Getter calculado: no se almacena, se calcula"""
        return 3.14159 * self._radio ** 2

# Uso
c = Circulo(5)
print(c.radio)    # Llama al getter
print(c.area)     # Calcula automáticamente (78.54)</code></pre>

                    <h4>Setter con @atributo.setter</h4>
                    <pre><code class="language-python">class Circulo:
    def __init__(self, radio):
        self._radio = radio
    
    @property
    def radio(self):
        """Getter"""
        return self._radio
    
    @radio.setter
    def radio(self, valor):
        """Setter: se llama al asignar circulo.radio = valor"""
        if valor <= 0:
            raise ValueError("El radio debe ser positivo")
        self._radio = valor
    
    @property
    def area(self):
        return 3.14159 * self._radio ** 2

# Uso
c = Circulo(5)
print(c.radio)    # 5

c.radio = 10      # Llama al setter
print(c.area)     # 314.159

# c.radio = -5    # ❌ ValueError: El radio debe ser positivo</code></pre>

                    <h4>Ejemplo: Usuario con Email Validado</h4>
                    <pre><code class="language-python">class Usuario:
    def __init__(self, username, email):
        self._username = username
        self._email = None  # Inicializa vacío
        self.email = email  # Usa el setter para validar
    
    @property
    def username(self):
        return self._username
    
    @property
    def email(self):
        return self._email
    
    @email.setter
    def email(self, valor):
        if "@" not in valor:
            raise ValueError("Email inválido: debe contener @")
        self._email = valor

# Uso
u = Usuario("juan", "juan@email.com")
print(u.email)           # juan@email.com

u.email = "nuevo@email.com"  # ✅ Válido
print(u.email)

# u.email = "invalido"    # ❌ ValueError: Email inválido...</code></pre>
                </section>

                <!-- EJERCICIO -->
                <section id="ejercicio">
                    <h2 class="text-primary border-bottom pb-2">Ejercicio: Usuario Encapsulado (25 min)</h2>
                    
                    <p>Mejora la clase Usuario con encapsulamiento completo.</p>

                    <h4>Requisitos</h4>
                    <ul>
                        <li><code>username</code>: solo lectura (no setter), validar ≥3 caracteres</li>
                        <li><code>email</code>: getter/setter con validación de @</li>
                        <li><code>edad</code>: getter/setter, validar 0-120 años</li>
                        <li><code>_activo</code>: protegido, métodos activar()/desactivar()</li>
                    </ul>

                    <pre><code class="language-python"># usuario_encapsulado.py
class Usuario:
    """Usuario con encapsulamiento completo."""
    
    def __init__(self, username, email, edad=None):
        # Validar username en el constructor
        if len(username) < 3:
            raise ValueError("Username debe tener al menos 3 caracteres")
        
        self._username = username
        self._email = None
        self._edad = None
        self._activo = True
        
        # Usar setters para validar
        self.email = email
        if edad is not None:
            self.edad = edad
    
    @property
    def username(self):
        """Username es de solo lectura (no hay setter)."""
        return self._username
    
    @property
    def email(self):
        return self._email
    
    @email.setter
    def email(self, valor):
        if "@" not in valor or "." not in valor.split("@")[1]:
            raise ValueError("Email inválido")
        self._email = valor
    
    @property
    def edad(self):
        return self._edad
    
    @edad.setter
    def edad(self, valor):
        if not isinstance(valor, int):
            raise ValueError("Edad debe ser un número entero")
        if not (0 <= valor <= 120):
            raise ValueError("Edad debe estar entre 0 y 120")
        self._edad = valor
    
    @property
    def activo(self):
        return self._activo
    
    def activar(self):
        self._activo = True
    
    def desactivar(self):
        self._activo = False
    
    def __str__(self):
        return f"@{self._username} ({self._email})"


# === PRUEBAS ===
if __name__ == "__main__":
    # Crear usuario válido
    try:
        u = Usuario("juan123", "juan@email.com", 25)
        print(f"✅ Creado: {u}")
        print(f"   Edad: {u.edad}")
        print(f"   Activo: {u.activo}")
    except ValueError as e:
        print(f"❌ Error: {e}")
    
    # Intentar modificar username (solo lectura)
    print("\n--- Username es solo lectura ---")
    try:
        u.username = "otro"  # Esto debería fallar
    except AttributeError as e:
        print(f"✅ Correcto: No se puede modificar username")
    
    # Cambiar email válido
    print("\n--- Cambiar email ---")
    u.email = "nuevo@email.com"
    print(f"✅ Nuevo email: {u.email}")
    
    # Intentar email inválido
    print("\n--- Email inválido ---")
    try:
        u.email = "sin-arroba"
    except ValueError as e:
        print(f"✅ Correcto: {e}")
    
    # Edad inválida
    print("\n--- Edad inválida ---")
    try:
        u.edad = 150
    except ValueError as e:
        print(f"✅ Correcto: {e}")
    
    # Activar/Desactivar
    print("\n--- Estado ---")
    u.desactivar()
    print(f"Desactivado: Activo = {u.activo}")
    u.activar()
    print(f"Activado: Activo = {u.activo}")</code></pre>

                    <div class="alert-note">
                        <strong>Conexión con TaskFlow:</strong> El encapsulamiento protege los datos del usuario. El email no puede ser cualquier texto, la edad debe ser razonable, y el username no cambia (es la identidad del usuario).
                    </div>
                </section>

                <!-- RESUMEN -->
                <section>
                    <h2 class="text-primary border-bottom pb-2">Resumen</h2>
                    
                    <ul>
                        <li><strong>Encapsulamiento:</strong> Ocultar detalles internos, exponer solo lo necesario</li>
                        <li><strong>_</code> (underscore):</strong> Convención para atributos protegidos</li>
                        <li><strong>__</code> (dunder):</strong> Atributos privados con name mangling</li>
                        <li><strong>@property:</strong> Define getters elegantes</li>
                        <li><strong>@atributo.setter:</strong> Define setters con validación</li>
                    </ul>
                    
                    <div class="alert-tip">
                        <strong>Para el examen E1:</strong> Practica crear clases con @property y setters que validen datos. Es fundamental para el modelo de dominio.
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Navegación entre clases -->
    <div class="container mt-4 mb-4">
        <div class="d-flex justify-content-between align-items-center bg-light p-3 rounded">
            <div>
                <a href="clase-01-clases-objetos.html" class="btn btn-outline-secondary btn-sm">
                    ← Anterior: Clases y Objetos
                </a>
            </div>
            <div>
                <span class="text-muted small">Clase 4 de 25</span>
            </div>
            <div>
                <a href="clase-03-herencia-polimorfismo.html" class="btn btn-primary btn-sm">
                    Siguiente: Herencia y Polimorfismo →
                </a>
            </div>
        </div>
    </div>

    <footer class="bg-light text-center py-3 mt-5">
        <div class="container">
            <p class="mb-0">&copy; 2026 IF0100 - UNAULA | <a href="../index.html">Inicio</a></p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
</body>
</html>