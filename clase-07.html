<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Clase 07 - DDD Domain-Driven Design | IF0100 - POO II</title>
  <style>
    :root {
      --bg: #f7f7f4;
      --ink: #1f2933;
      --muted: #52606d;
      --brand: #1e3a8a;
      --accent: #3b82f6;
      --card: #ffffff;
      --line: #d9e2ec;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "IBM Plex Sans", "Segoe UI", Tahoma, sans-serif;
      color: var(--ink);
      background: var(--bg);
      line-height: 1.65;
    }
    header {
      background: linear-gradient(135deg, #0b2d6b, #1e40af);
      color: #fff;
      padding: 36px 20px 28px;
    }
    header .wrap { max-width: 1100px; margin: 0 auto; }
    header h1 {
      font-family: "Merriweather", Georgia, serif;
      margin: 8px 0 10px;
      font-size: 2.2rem;
    }
    header .meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 16px;
      margin-top: 18px;
      background: rgba(255, 255, 255, 0.12);
      padding: 16px;
      border-radius: 12px;
    }
    header ul { margin: 8px 0 0 18px; }
    nav {
      max-width: 1100px;
      margin: 18px auto 0;
      padding: 14px 18px;
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 12px;
    }
    nav ul {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 8px 14px;
    }
    nav a {
      color: var(--brand);
      text-decoration: none;
      padding: 8px 10px;
      border-radius: 8px;
      background: #eef2ff;
      display: block;
    }
    nav a:hover { background: #dbeafe; }
    main { max-width: 1100px; margin: 18px auto 60px; padding: 0 20px; }
    section {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 22px;
      margin: 18px 0;
    }
    h2 { margin-top: 0; color: var(--brand); font-size: 1.6rem; border-bottom: 3px solid var(--accent); padding-bottom: 6px; }
    h3 { color: #0b2d6b; margin-top: 20px; }
    h4 { color: #2f4b7c; margin-top: 16px; }
    .grid-2 {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 16px;
      align-items: start;
    }
    .note {
      background: #f0f4ff;
      border-left: 4px solid var(--accent);
      padding: 10px 12px;
      border-radius: 8px;
      color: var(--muted);
    }
    figure {
      margin: 0;
      padding: 12px;
      border: 1px dashed var(--line);
      border-radius: 10px;
      background: #fbfbff;
    }
    figure img { max-width: 100%; height: auto; display: block; border-radius: 6px; }
    figcaption { font-size: 0.95rem; color: var(--muted); margin-top: 8px; }
    pre {
      background: #0b1020;
      color: #e2e8f0;
      padding: 14px;
      border-radius: 10px;
      overflow-x: auto;
    }
    code { font-family: "Cascadia Code", Consolas, monospace; font-size: 0.95rem; }
    /* Syntax highlighting para Python */
    .token-keyword { color: #c792ea; font-weight: 600; }
    .token-type { color: #ffcb6b; }
    .token-string { color: #c3e88d; }
    .token-comment { color: #546e7a; font-style: italic; }
    .token-number { color: #f78c6c; }
    .token-operator { color: #89ddff; }
    /* Accessibility */
    abbr[title] { text-decoration: underline dotted; cursor: help; }
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: var(--brand);
      color: #fff;
      padding: 8px 16px;
      text-decoration: none;
      z-index: 100;
      transition: top 0.3s;
    }
    .skip-link:focus {
      top: 0;
    }
    table { width: 100%; border-collapse: collapse; margin: 10px 0; }
    th, td { border: 1px solid var(--line); padding: 8px 10px; text-align: left; }
    th { background: #f1f5f9; }
    /* Print styles */
    @media print {
      header, nav, footer { background: white !important; color: black !important; }
      a[href]:after { content: " (" attr(href) ")"; font-size: 0.8em; }
      pre, code { white-space: pre-wrap; }
    }

    /* BLOQUES DE CÓDIGO MEJORADOS */
    .code-block {
      background: #1e1e2e;
      border-radius: 12px;
      margin: 16px 0;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      border: 1px solid #313244;
    }

    .code-header {
      background: linear-gradient(90deg, #313244 0%, #45475a 100%);
      padding: 10px 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      border-bottom: 1px solid #45475a;
    }

    .code-dots {
      display: flex;
      gap: 6px;
    }

    .code-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    .code-dot.red { background: #f38ba8; }
    .code-dot.yellow { background: #f9e2af; }
    .code-dot.green { background: #a6e3a1; }

    .code-title {
      color: #cdd6f4;
      font-size: 0.85rem;
      font-weight: 600;
      margin-left: auto;
      font-family: 'Cascadia Code', Consolas, monospace;
    }

    .code-content {
      display: flex;
      background: #1e1e2e;
    }

    .line-numbers {
      background: #181825;
      color: #6c7086;
      padding: 12px 10px;
      text-align: right;
      font-family: 'Cascadia Code', Consolas, monospace;
      font-size: 0.9rem;
      line-height: 1.5;
      user-select: none;
      border-right: 1px solid #313244;
    }

    .code-block pre {
      background: transparent;
      margin: 0;
      padding: 12px 16px;
      flex: 1;
      overflow-x: auto;
    }

    .code-block pre code {
      color: #cdd6f4;
      font-size: 0.95rem;
      line-height: 1.5;
      display: block;
    }

    /* Syntax highlighting mejorado - Catppuccin Mocha theme */
    .code-block .token-keyword { color: #cba6f7; font-weight: 600; } /* purple */
    .code-block .token-type { color: #f9e2af; } /* yellow */
    .code-block .token-string { color: #a6e3a1; } /* green */
    .code-block .token-comment { color: #6c7086; font-style: italic; } /* gray */
    .code-block .token-number { color: #fab387; } /* peach */
    .code-block .token-operator { color: #89dceb; } /* cyan */
    .code-block .token-method { color: #89b4fa; } /* blue */
    .code-block .token-class { color: #f9e2af; font-weight: 600; }
    .code-block .token-property { color: #b4befe; } /* lavender */
    .code-block .token-namespace { color: #f38ba8; } /* pink */

    /* Código inline */
    p code, li code {
      background: #313244;
      color: #cdd6f4;
      padding: 2px 8px;
      border-radius: 6px;
      font-size: 0.9em;
      border: 1px solid #45475a;
    }

    /* Tablas de código */
    .code-comparison {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 16px;
      margin: 16px 0;
    }

    .code-comparison .code-block {
      margin: 0;
    }

    .code-label {
      font-size: 0.8rem;
      color: #6c7086;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 6px;
    }
  </style>
</head>
<body>
  <a href="#main" class="skip-link">Saltar al contenido</a>
  <header>
    <div class="wrap">
      <div>IF0100 - Lenguaje de Programación OO II | Unidad 2</div>
      <h1>Clase 07: DDD - Domain-Driven Design con Python</h1>
      <div>Duración: 90 minutos</div>
      <div class="meta">
        <div>
          <strong>Objetivos</strong>
          <ul>
            <li>Comprender fundamentos de DDD.</li>
            <li>Distinguir Entities, Value Objects y Aggregates.</li>
            <li>Aplicar el patrón Repository.</li>
            <li>Identificar Bounded Contexts.</li>
            <li>Implementar arquitectura en capas.</li>
          </ul>
        </div>
        <div>
          <strong>Prerrequisitos</strong>
          <ul>
            <li>Conocer conceptos de POO y capas.</li>
            <li>Experiencia básica con Python 3.11+ y dataclasses.</li>
            <li>Comprensión de necesidades de negocio.</li>
            <li>Windows 10/11 con Python instalado.</li>
          </ul>
        </div>
      </div>
    </div>
  </header>

  <nav>
    <ul>
      <li><a href="#teoria">Teoría</a></li>
      <li><a href="#ejemplos">Ejemplos</a></li>
      <li><a href="#practica">Práctica / laboratorio</a></li>
      <li><a href="#ejercicios">Ejercicios</a></li>
      <li><a href="#referencias">Referencias</a></li>
    </ul>
  </nav>

  <main id="main">
    <section id="teoria">
      <h2>Teoría</h2>

      <h3>Qué es DDD y cuándo usarlo</h3>
      <p><strong><abbr title="Domain-Driven Design: Diseño guiado por el dominio, enfoque de desarrollo de software que se centra en el modelo del dominio del negocio y su lógica, más que en detalles técnicos">DDD</abbr></strong> (Domain-Driven Design) modela el software según el dominio del negocio, usando un <strong>lenguaje ubicuo</strong> compartido entre expertos y equipo técnico.</p>

      <div class="note">
        <h4>¿Por qué DDD?</h4>
        <p>DDD nació para resolver un problema crítico en proyectos complejos: <strong>la brecha entre el lenguaje del negocio y el código</strong>. En muchos proyectos, los términos y conceptos del negocio se pierden o distorsionan al traducirlos a código. DDD propone que el <strong>modelo del dominio</strong> (las clases y relaciones en el código) debe reflejar fielmente la realidad del negocio. Esto permite:</p>
        <ul>
          <li><strong>Comunicación precisa:</strong> Expertos y desarrolladores hablan el mismo idioma</li>
          <li><strong>Código expresivo:</strong> El código lee como negocio, no como técnica</li>
          <li><strong>Mantenibilidad:</strong> Los cambios en el negocio se reflejan directamente en el código</li>
          <li><strong>Alineación estratégica:</strong> El software evoluciona con el negocio</li>
        </ul>
      </div>

      <div class="grid-2">
        <div>
          <h4>Usar DDD cuando</h4>
          <ul>
            <li>Reglas de negocio complejas.</li>
            <li>Dominio cambiante.</li>
            <li>Proyecto estratégico y de larga duración.</li>
            <li>Hay expertos de dominio disponibles.</li>
          </ul>
        </div>
        <div>
          <h4>Evitar DDD cuando</h4>
          <ul>
            <li><abbr title="CRUD: Create-Read-Update-Delete (Crear-Leer-Actualizar-Borrar), operaciones básicas de persistencia de datos">CRUD</abbr> simple sin reglas.</li>
            <li>Proyectos cortos o <abbr title="MVP: Minimum Viable Product (Producto Mínimo Viable), versión básica de un producto con solo las características esenciales">MVP</abbr>.</li>
            <li>No hay expertos de dominio.</li>
            <li>Se requiere velocidad sobre precisión.</li>
          </ul>
        </div>
      </div>

      <h3>Lenguaje ubicuo</h3>
      <p>El <strong><abbr title="Lenguaje ubicuo: Lenguaje compartido entre expertos de dominio y desarrolladores, usado tanto en conversaciones como en el código, garantizando que los términos tengan el mismo significado en todos los contextos">lenguaje ubicuo</abbr></strong> es el pilar de DDD: es un lenguaje compartido que se usa en conversaciones, documentación y código. Regla de oro: <strong>los mismos términos se usan en todas partes</strong>.</p>
      <table>
        <thead>
          <tr><th>Concepto</th><th>Término correcto</th></tr>
        </thead>
        <tbody>
          <tr><td>Cliente</td><td>Cliente (no User)</td></tr>
          <tr><td>Pedido</td><td>RealizarPedido</td></tr>
          <tr><td>Estado</td><td>PedidoPendiente</td></tr>
          <tr><td>Pago</td><td>ConfirmarPago</td></tr>
        </tbody>
      </table>
      <div class="note">Regla: los mismos términos se usan en conversaciones, documentación y código.</div>

      <h3>Entities vs Value Objects</h3>
      <p>En DDD distinguimos entre objetos que tienen <strong>identidad</strong> (Entities) y objetos definidos por sus <strong>atributos</strong> (Value Objects). Esta distinción es crucial para diseñar modelos precisos.</p>

      <div class="note">
        <h4>¿Por qué distinguir Entity vs Value Object?</h4>
        <p>La distinción permite que el modelo refleje la realidad del negocio. Un <strong>Cliente</strong> es una Entity porque sigue siendo la misma persona aunque cambie su dirección. Un <strong>Dinero</strong> es un Value Object porque $100 es $100 sin importar de dónde venga. Esto permite:</p>
        <ul>
          <li><strong>Modelo preciso:</strong> El código expresa las intenciones del negocio</li>
          <li><strong>Inmutabilidad:</strong> Los Value Objects pueden ser inmutables (más seguros)</li>
          <li><strong>Performance:</strong> Los Value Objects se pueden copiar en lugar de referenciar</li>
          <li><strong>Menos bugs:</strong> La comparación por valor evita errores de igualdad</li>
        </ul>
      </div>

      <table>
        <thead>
          <tr><th>Aspecto</th><th>Entity</th><th>Value Object</th></tr>
        </thead>
        <tbody>
          <tr><td>Definida por</td><td>Identidad</td><td>Atributos</td></tr>
          <tr><td>ID único</td><td>Sí</td><td>No</td></tr>
          <tr><td>Mutabilidad</td><td>Mutable</td><td>Inmutable</td></tr>
          <tr><td>Comparación</td><td>Por identidad</td><td>Por valor</td></tr>
        </tbody>
      </table>

      <h3>Aggregates y reglas</h3>
      <p>Un <strong><abbr title="Aggregate: Grupo de objetos tratados como una unidad para propósitos de modificación de datos, con un Aggregate Root como punto de entrada único y control de invariantes">Aggregate</abbr></strong> es un conjunto de objetos que se tratan como una unidad. El <strong>Aggregate Root</strong> es la única forma externa de interactuar con el aggregate.</p>

      <div class="note">
        <h4>¿Por qué Aggregates?</h4>
        <p>Los Aggregates resuelven dos problemas clave: <strong>consistencia transaccional</strong> y <strong>acceso controlado</strong>. Al definir límites claros:</p>
        <ul>
          <li><strong>Invariantes protegidos:</strong> Las reglas de negocio se aplican en el Root, nadie puede saltárselas</li>
          <li><strong>Transacciones claras:</strong> Una transacción modifica un solo aggregate</li>
          <li><strong>Performance:</strong> Se cargan solo los objetos necesarios</li>
          <li><strong>Diseño intencional:</strong> Fuerza a pensar en agrupaciones naturales del dominio</li>
        </ul>
      </div>

      <ul>
        <li>El Aggregate Root es el único punto de entrada.</li>
        <li>Referencias entre aggregates por ID, no por objetos completos.</li>
        <li>Una transacción modifica un solo aggregate.</li>
        <li>Los <strong><abbr title="Invariante: Regla de negocio que debe cumplirse siempre, un constraint que nunca se puede violar">invariantes</abbr></strong> (reglas que deben cumplirse siempre) se protegen dentro del aggregate.</li>
      </ul>

      <h3>Repository y Domain Services</h3>
      <p>El patrón <strong><abbr title="Repository: Patrón que abstrae el acceso a datos, proporcionando una interfaz de colección-like para obtener y persistir agregados">Repository</abbr></strong> abstrae la persistencia; <strong>Domain Service</strong> encapsula lógica de negocio que cruza aggregates o no pertenece naturalmente a una entidad.</p>
    </section>

    <section id="ejemplos">
      <h2>Ejemplos e infografías</h2>

      <h3>Infografía: Arquitectura DDD</h3>
      <figure>
        <object data="../assets/svg/clase-07-ddd-arquitectura.svg" type="image/svg+xml" style="max-width: 100%; height: auto; border-radius: 6px;">
          <img src="../assets/svg/clase-07-ddd-arquitectura.svg" alt="Infografia arquitectura DDD" />
        </object>
        <figcaption>Figura 1: Arquitectura en capas de DDD - Presentation/UI maneja interacción con usuarios, Application/Domain coordina lógica de negocio y flujos de trabajo, Domain contiene el modelo del dominio con entidades de negocio y reglas, e Infrastructure abstrae persistencia y servicios externos; las flechas hacia el centro indican la dependencia invertida donde las capas exteriores dependen del núcleo (Domain), manteniendo el dominio puro y libre de detalles técnicos.</figcaption>
      </figure>

      <h3>Entity en Python (Cliente)</h3>
      <div class="code-block">
        <div class="code-header">
          <div class="code-dots">
            <span class="code-dot red"></span>
            <span class="code-dot yellow"></span>
            <span class="code-dot green"></span>
          </div>
          <span class="code-title">cliente.py</span>
        </div>
        <div class="code-content">
          <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21</div>
          <pre><code><span class="token-keyword">from</span> dataclasses <span class="token-keyword">import</span> <span class="token-type">dataclass</span>
<span class="token-keyword">from</span> typing <span class="token-keyword">import</span> <span class="token-type">Optional</span>

<span class="token-operator">@dataclass</span><span class="token-operator">(</span>frozen<span class="token-operator">=</span><span class="token-type">True</span><span class="token-operator">)</span>
<span class="token-keyword">class</span> <span class="token-class">ClienteId</span><span class="token-operator">:</span>
    <span class="token-property">valor</span><span class="token-operator">:</span> <span class="token-keyword">int</span>

<span class="token-operator">@dataclass</span><span class="token-operator">(</span>frozen<span class="token-operator">=</span><span class="token-type">True</span><span class="token-operator">)</span>
<span class="token-keyword">class</span> <span class="token-class">Email</span><span class="token-operator">:</span>
    <span class="token-property">valor</span><span class="token-operator">:</span> <span class="token-keyword">str</span>

<span class="token-keyword">class</span> <span class="token-class">Cliente</span><span class="token-operator">:</span>
    <span class="token-keyword">def</span> <span class="token-method">__init__</span><span class="token-operator">(</span><span class="token-keyword">self</span><span class="token-operator">,</span> id<span class="token-operator">:</span> <span class="token-type">ClienteId</span><span class="token-operator">,</span> nombre<span class="token-operator">:</span> <span class="token-keyword">str</span><span class="token-operator">,</span> email<span class="token-operator">:</span> <span class="token-type">Email</span><span class="token-operator">)</span> <span class="token-operator">-></span> <span class="token-type">None</span><span class="token-operator">:</span>
        <span class="token-keyword">self</span><span class="token-operator">.</span>_id <span class="token-operator">=</span> id
        <span class="token-keyword">self</span><span class="token-operator">.</span>_nombre <span class="token-operator">=</span> nombre
        <span class="token-keyword">self</span><span class="token-operator">.</span>_email <span class="token-operator">=</span> email

    <span class="token-property">@property</span>
    <span class="token-keyword">def</span> <span class="token-method">id</span><span class="token-operator">(</span><span class="token-keyword">self</span><span class="token-operator">)</span> <span class="token-operator">-></span> <span class="token-type">ClienteId</span><span class="token-operator">:</span>
        <span class="token-keyword">return</span> <span class="token-keyword">self</span><span class="token-operator">.</span>_id

    <span class="token-property">@property</span>
    <span class="token-keyword">def</span> <span class="token-method">nombre</span><span class="token-operator">(</span><span class="token-keyword">self</span><span class="token-operator">)</span> <span class="token-operator">-></span> <span class="token-keyword">str</span><span class="token-operator">:</span>
        <span class="token-keyword">return</span> <span class="token-keyword">self</span><span class="token-operator">.</span>_nombre

    <span class="token-property">@property</span>
    <span class="token-keyword">def</span> <span class="token-method">email</span><span class="token-operator">(</span><span class="token-keyword">self</span><span class="token-operator">)</span> <span class="token-operator">-></span> <span class="token-type">Email</span><span class="token-operator">:</span>
        <span class="token-keyword">return</span> <span class="token-keyword">self</span><span class="token-operator">.</span>_email

    <span class="token-keyword">def</span> <span class="token-method">cambiar_email</span><span class="token-operator">(</span><span class="token-keyword">self</span><span class="token-operator">,</span> nuevo_email<span class="token-operator">:</span> <span class="token-type">Email</span><span class="token-operator">)</span> <span class="token-operator">-></span> <span class="token-type">None</span><span class="token-operator">:</span>
        <span class="token-keyword">self</span><span class="token-operator">.</span>_email <span class="token-operator">=</span> nuevo_email</code></pre>
        </div>
      </div>

      <h3>Value Object en Python (Dinero)</h3>
      <div class="code-block">
        <div class="code-header">
          <div class="code-dots">
            <span class="code-dot red"></span>
            <span class="code-dot yellow"></span>
            <span class="code-dot green"></span>
          </div>
          <span class="code-title">dinero.py</span>
        </div>
        <div class="code-content">
          <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37</div>
          <pre><code><span class="token-keyword">from</span> dataclasses <span class="token-keyword">import</span> <span class="token-type">dataclass</span>
<span class="token-keyword">from</span> typing <span class="token-keyword">import</span> <span class="token-type">Self</span>

<span class="token-operator">@dataclass</span><span class="token-operator">(</span>frozen<span class="token-operator">=</span><span class="token-type">True</span><span class="token-operator">)</span>
<span class="token-keyword">class</span> <span class="token-class">Dinero</span><span class="token-operator">:</span>
    <span class="token-property">monto</span><span class="token-operator">:</span> <span class="token-keyword">float</span>
    <span class="token-property">moneda</span><span class="token-operator">:</span> <span class="token-keyword">str</span>

    <span class="token-keyword">def</span> <span class="token-method">__post_init__</span><span class="token-operator">(</span><span class="token-keyword">self</span><span class="token-operator">)</span> <span class="token-operator">-></span> <span class="token-type">None</span><span class="token-operator">:</span>
        <span class="token-keyword">if</span> <span class="token-keyword">self</span><span class="token-operator">.</span>monto <span class="token-operator">&lt;</span> <span class="token-number">0</span><span class="token-operator">:</span>
            <span class="token-keyword">raise</span> <span class="token-type">ValueError</span><span class="token-operator">(</span><span class="token-string">"Monto debe ser positivo"</span><span class="token-operator">)</span>

    <span class="token-keyword">def</span> <span class="token-method">sumar</span><span class="token-operator">(</span><span class="token-keyword">self</span><span class="token-operator">,</span> otro<span class="token-operator">:</span> <span class="token-type">Self</span><span class="token-operator">)</span> <span class="token-operator">-></span> <span class="token-type">Self</span><span class="token-operator">:</span>
        <span class="token-keyword">if</span> <span class="token-keyword">self</span><span class="token-operator">.</span>moneda <span class="token-operator">!=</span> otro<span class="token-operator">.</span>moneda<span class="token-operator">:</span>
            <span class="token-keyword">raise</span> <span class="token-type">ValueError</span><span class="token-operator">(</span><span class="token-string">"Monedas diferentes"</span><span class="token-operator">)</span>
        <span class="token-keyword">return</span> <span class="token-type">Dinero</span><span class="token-operator">(</span><span class="token-keyword">self</span><span class="token-operator">.</span>monto <span class="token-operator">+</span> otro<span class="token-operator">.</span>monto<span class="token-operator">,</span> <span class="token-keyword">self</span><span class="token-operator">.</span>moneda<span class="token-operator">)</span>

    <span class="token-keyword">def</span> <span class="token-method">__eq__</span><span class="token-operator">(</span><span class="token-keyword">self</span><span class="token-operator">,</span> otro<span class="token-operator">:</span> <span class="token-keyword">object</span><span class="token-operator">)</span> <span class="token-operator">-></span> <span class="token-keyword">bool</span><span class="token-operator">:</span>
        <span class="token-keyword">if</span> <span class="token-keyword">not</span> <span class="token-keyword">isinstance</span><span class="token-operator">(</span>otro<span class="token-operator">,</span> <span class="token-type">Dinero</span><span class="token-operator">)</span><span class="token-operator">:</span>
            <span class="token-keyword">return</span> <span class="token-type">False</span>
        <span class="token-keyword">return</span> <span class="token-keyword">self</span><span class="token-operator">.</span>monto <span class="token-operator">==</span> otro<span class="token-operator">.</span>monto <span class="token-keyword">and</span> <span class="token-keyword">self</span><span class="token-operator">.</span>moneda <span class="token-operator">==</span> otro<span class="token-operator">.</span>moneda

    <span class="token-keyword">def</span> <span class="token-method">__hash__</span><span class="token-operator">(</span><span class="token-keyword">self</span><span class="token-operator">)</span> <span class="token-operator">-></span> <span class="token-keyword">int</span><span class="token-operator">:</span>
        <span class="token-keyword">return</span> <span class="token-method">hash</span><span class="token-operator">((</span><span class="token-keyword">self</span><span class="token-operator">.</span>monto<span class="token-operator">,</span> <span class="token-keyword">self</span><span class="token-operator">.</span>moneda<span class="token-operator">))</span></code></pre>
        </div>
      </div>

      <h3>Aggregate Root: Pedido</h3>
      <div class="code-block">
        <div class="code-header">
          <div class="code-dots">
            <span class="code-dot red"></span>
            <span class="code-dot yellow"></span>
            <span class="code-dot green"></span>
          </div>
          <span class="code-title">pedido.py</span>
        </div>
        <div class="code-content">
          <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46</div>
          <pre><code><span class="token-keyword">from</span> dataclasses <span class="token-keyword">import</span> <span class="token-type">dataclass</span>
<span class="token-keyword">from</span> typing <span class="token-keyword">import</span> <span class="token-type">List</span>

<span class="token-operator">@dataclass</span><span class="token-operator">(</span>frozen<span class="token-operator">=</span><span class="token-type">True</span><span class="token-operator">)</span>
<span class="token-keyword">class</span> <span class="token-class">PedidoId</span><span class="token-operator">:</span>
    <span class="token-property">valor</span><span class="token-operator">:</span> <span class="token-keyword">int</span>

<span class="token-operator">@dataclass</span><span class="token-operator">(</span>frozen<span class="token-operator">=</span><span class="token-type">True</span><span class="token-operator">)</span>
<span class="token-keyword">class</span> <span class="token-class">ClienteId</span><span class="token-operator">:</span>
    <span class="token-property">valor</span><span class="token-operator">:</span> <span class="token-keyword">int</span>

<span class="token-operator">@dataclass</span><span class="token-operator">(</span>frozen<span class="token-operator">=</span><span class="token-type">True</span><span class="token-operator">)</span>
<span class="token-keyword">class</span> <span class="token-class">ProductoId</span><span class="token-operator">:</span>
    <span class="token-property">valor</span><span class="token-operator">:</span> <span class="token-keyword">int</span>

<span class="token-operator">@dataclass</span><span class="token-operator">(</span>frozen<span class="token-operator">=</span><span class="token-type">True</span><span class="token-operator">)</span>
<span class="token-keyword">class</span> <span class="token-class">LineaPedido</span><span class="token-operator">:</span>
    <span class="token-property">producto_id</span><span class="token-operator">:</span> <span class="token-type">ProductoId</span>
    <span class="token-property">cantidad</span><span class="token-operator">:</span> <span class="token-keyword">int</span>
    <span class="token-property">precio</span><span class="token-operator">:</span> <span class="token-type">Dinero</span>

<span class="token-keyword">class</span> <span class="token-class">Pedido</span><span class="token-operator">:</span>
    <span class="token-keyword">def</span> <span class="token-method">__init__</span><span class="token-operator">(</span><span class="token-keyword">self</span><span class="token-operator">,</span> id<span class="token-operator">:</span> <span class="token-type">PedidoId</span><span class="token-operator">,</span> cliente_id<span class="token-operator">:</span> <span class="token-type">ClienteId</span><span class="token-operator">)</span> <span class="token-operator">-></span> <span class="token-type">None</span><span class="token-operator">:</span>
        <span class="token-keyword">self</span><span class="token-operator">.</span>_id <span class="token-operator">=</span> id
        <span class="token-keyword">self</span><span class="token-operator">.</span>_cliente_id <span class="token-operator">=</span> cliente_id
        <span class="token-keyword">self</span><span class="token-operator">.</span>_lineas<span class="token-operator">:</span> <span class="token-type">List</span><span class="token-operator">[</span><span class="token-type">LineaPedido</span><span class="token-operator">]</span> <span class="token-operator">=</span> <span class="token-operator">[]</span>

    <span class="token-property">@property</span>
    <span class="token-keyword">def</span> <span class="token-method">id</span><span class="token-operator">(</span><span class="token-keyword">self</span><span class="token-operator">)</span> <span class="token-operator">-></span> <span class="token-type">PedidoId</span><span class="token-operator">:</span>
        <span class="token-keyword">return</span> <span class="token-keyword">self</span><span class="token-operator">.</span>_id

    <span class="token-property">@property</span>
    <span class="token-keyword">def</span> <span class="token-method">cliente_id</span><span class="token-operator">(</span><span class="token-keyword">self</span><span class="token-operator">)</span> <span class="token-operator">-></span> <span class="token-type">ClienteId</span><span class="token-operator">:</span>
        <span class="token-keyword">return</span> <span class="token-keyword">self</span><span class="token-operator">.</span>_cliente_id

    <span class="token-property">@property</span>
    <span class="token-keyword">def</span> <span class="token-method">lineas</span><span class="token-operator">(</span><span class="token-keyword">self</span><span class="token-operator">)</span> <span class="token-operator">-></span> <span class="token-type">List</span><span class="token-operator">[</span><span class="token-type">LineaPedido</span><span class="token-operator">]</span><span class="token-operator">:</span>
        <span class="token-keyword">return</span> <span class="token-keyword">self</span><span class="token-operator">.</span>_lineas<span class="token-operator">.</span><span class="token-method">copy</span><span class="token-operator">()</span>

    <span class="token-keyword">def</span> <span class="token-method">agregar_producto</span><span class="token-operator">(</span><span class="token-keyword">self</span><span class="token-operator">,</span> producto_id<span class="token-operator">:</span> <span class="token-type">ProductoId</span><span class="token-operator">,</span> cantidad<span class="token-operator">:</span> <span class="token-keyword">int</span><span class="token-operator">,</span> precio<span class="token-operator">:</span> <span class="token-type">Dinero</span><span class="token-operator">)</span> <span class="token-operator">-></span> <span class="token-type">None</span><span class="token-operator">:</span>
        <span class="token-keyword">if</span> cantidad <span class="token-operator">&lt;=</span> <span class="token-number">0</span><span class="token-operator">:</span>
            <span class="token-keyword">raise</span> <span class="token-type">ValueError</span><span class="token-operator">(</span><span class="token-string">"Cantidad debe ser positiva"</span><span class="token-operator">)</span>
        linea <span class="token-operator">=</span> <span class="token-type">LineaPedido</span><span class="token-operator">(</span>producto_id<span class="token-operator">,</span> cantidad<span class="token-operator">,</span> precio<span class="token-operator">)</span>
        <span class="token-keyword">self</span><span class="token-operator">.</span>_lineas<span class="token-operator">.</span><span class="token-method">append</span><span class="token-operator">(</span>linea<span class="token-operator">)</span></code></pre>
        </div>
      </div>
    </section>

    <section id="practica">
      <h2>Práctica / laboratorio (35 min)</h2>
      <section class="actividad">
        <h3>Actividad: Laboratorio DDD - Modelado de Dominio (35 min)</h3>
        <p><strong>Tipo:</strong> Opcional / práctica</p>
        <p><strong>Relacionado con:</strong> Ninguno</p>
        <p><strong>Entregable:</strong> Solución .NET con modelo de dominio y Repository</p>
        <p><strong>Tiempo estimado:</strong> 35 min</p>
        <p><strong>Criterios de éxito:</strong> Solución compila, dominio sin referencias a infraestructura, repositorio por interfaz</p>
        <div class="note">Objetivo: modelar un dominio simple y aplicar Repository en una solución .NET.</div>

      <h3>Pasos en Windows (Visual Studio 2022)</h3>
      <ol>
        <li>Crear solución nueva con proyectos: <strong>Domain</strong> (Class Library) y <strong>App</strong> (Console App).</li>
        <li>En Domain, definir Entity <code>Cliente</code> y Value Object <code>Dinero</code>.</li>
        <li>En App, crear un servicio de aplicación que use el repositorio.</li>
        <li>Probar flujo simple: crear pedido y agregar línea.</li>
      </ol>
      <div class="note">Checklist: solución compila, dominio sin referencias a infraestructura, repositorio por interfaz.</div>

      <h3>Repository pattern (interface + implementación)</h3>
      <div class="code-block">
        <div class="code-header">
          <div class="code-dots">
            <span class="code-dot red"></span>
            <span class="code-dot yellow"></span>
            <span class="code-dot green"></span>
          </div>
          <span class="code-title">pedido_repository.py (ABC - Interface)</span>
        </div>
        <div class="code-content">
          <div class="line-numbers">1<br>2<br>3<br>4<br>5</div>
          <pre><code><span class="token-keyword">from</span> abc <span class="token-keyword">import</span> ABC, abstractmethod
<span class="token-keyword">from</span> typing <span class="token-keyword">import</span> Optional

<span class="token-keyword">class</span> <span class="token-class">PedidoRepository</span>(ABC):
    <span class="token-string">"""Interfaz (clase abstracta) para el repositorio de pedidos"""</span>
    
    <span class="token-keyword">@abstractmethod</span>
    <span class="token-keyword">def</span> <span class="token-method">obtener</span>(<span class="token-keyword">self</span>, id: <span class="token-type">PedidoId</span>) <span class="token-operator">-></span> Optional[<span class="token-type">Pedido</span>]:
        <span class="token-keyword">raise</span> <span class="token-type">NotImplementedError</span>
    
    <span class="token-keyword">@abstractmethod</span>
    <span class="token-keyword">def</span> <span class="token-method">guardar</span>(<span class="token-keyword">self</span>, pedido: <span class="token-type">Pedido</span>) <span class="token-operator">-></span> <span class="token-type">None</span>:
        <span class="token-keyword">raise</span> <span class="token-type">NotImplementedError</span></code></pre>
        </div>
      </div>

      <div class="code-block">
        <div class="code-header">
          <div class="code-dots">
            <span class="code-dot red"></span>
            <span class="code-dot yellow"></span>
            <span class="code-dot green"></span>
          </div>
          <span class="code-title">pedido_repository_impl.py (Implementación)</span>
        </div>
        <div class="code-content">
          <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14</div>
          <pre><code><span class="token-keyword">from</span> typing <span class="token-keyword">import</span> Optional, Dict

<span class="token-keyword">class</span> <span class="token-class">PedidoRepositoryImpl</span>(PedidoRepository):
    <span class="token-string">"""Implementación en memoria del repositorio"""</span>
    
    <span class="token-keyword">def</span> <span class="token-method">__init__</span>(<span class="token-keyword">self</span>) <span class="token-operator">-></span> <span class="token-type">None</span>:
        <span class="token-keyword">self</span>._pedidos: Dict[<span class="token-type">int</span>, <span class="token-type">Pedido</span>] <span class="token-operator">=</span> {}
    
    <span class="token-keyword">def</span> <span class="token-method">obtener</span>(<span class="token-keyword">self</span>, id: <span class="token-type">PedidoId</span>) <span class="token-operator">-></span> Optional[<span class="token-type">Pedido</span>]:
        <span class="token-keyword">return</span> <span class="token-keyword">self</span>._pedidos.get(id.valor)
    
    <span class="token-keyword">def</span> <span class="token-method">guardar</span>(<span class="token-keyword">self</span>, pedido: <span class="token-type">Pedido</span>) <span class="token-operator">-></span> <span class="token-type">None</span>:
        <span class="token-keyword">self</span>._pedidos[pedido.id.valor] <span class="token-operator">=</span> pedido</code></pre>
        </div>
      </div>

      <h3>Bounded Contexts</h3>
      <p>Un <strong><abbr title="Bounded Context: Límite conceptual dentro del cual un modelo particular aplica y tiene significado; cada contexto tiene su propio lenguaje ubicuo y modelo del dominio">Bounded Context</abbr></strong> (Contexto Delimitado) es un límite conceptual dentro del cual un modelo particular aplica. DDD divide sistemas grandes en múltiples bounded contexts, cada uno con su propio modelo.</p>
      <ul>
        <li>Separar Ventas, Inventario y Envíos como contextos diferentes.</li>
        <li>El término "Producto" cambia significado según el contexto.</li>
        <li>Definir integraciones explícitas entre contextos.</li>
      </ul>

      <h3>Checklist de consistencia</h3>
      <ul>
        <li>Dominio no depende de infraestructura.</li>
        <li>Interfaces en Domain, implementaciones en Infrastructure.</li>
        <li>Aggregate Root controla invariantes.</li>
      </ul>
      <div class="note">Checklist práctico: proyecto ejecuta, repositorio aislado, invariantes documentadas.</div>
    </section>

    <section id="ejercicios">
      <h2>Ejercicios</h2>

      <section class="actividad">
        <h3>Actividad: Ejercicio 1 - Biblioteca (20 min)</h3>
        <p><strong>Tipo:</strong> Opcional / práctica</p>
        <p><strong>Relacionado con:</strong> Ninguno</p>
        <p><strong>Entregable:</strong> Identificación de elementos DDD para sistema de préstamos</p>
        <p><strong>Tiempo estimado:</strong> 20 min</p>
        <p><strong>Criterios de éxito:</strong> Al menos 2 entities, 2 value objects, 1 aggregate root y 1 domain service</p>
        <p>Identificar Entities, Value Objects, Aggregates y Services para un sistema de préstamos.</p>
      <div class="note">Checklist: al menos 2 entities, 2 value objects, 1 aggregate root y 1 domain service.</div>
    </section>

    <section id="entrega-git">
      <h2>Entrega con Git</h2>
      <p>Entrega mínima por clase usando control de versiones:</p>
      <ul>
        <li>Branch: <code>feature/ddd-clase-07</code></li>
        <li>Commits: <code>setup</code> / <code>implementacion</code> / <code>pruebas-docs</code></li>
        <li>Tag: <code>clase-07-v1</code></li>
      </ul>
    </section>

    <section id="referencias">
      <h2>Referencias</h2>
      <ul>
        <li><strong>Domain-Driven Design: Tackling Complexity in the Heart of Software</strong> - Eric Evans (libro fundamental)</li>
        <li><strong>Implementing Domain-Driven Design</strong> - Vaughn Vernon (implementación práctica)</li>
        <li><strong>Patterns, Principles, and Practices of Domain-Driven Design</strong> - Scott Millett</li>
        <li><strong>DDD Reference</strong> - <a href="https://domainlanguage.com/ddd/reference/" target="_blank" rel="noopener">https://domainlanguage.com/ddd/reference/</a></li>
        <li><strong>DDD Community</strong> - <a href="https://dddcommunity.org/" target="_blank" rel="noopener">https://dddcommunity.org/</a></li>
        <li><strong>Strategic Domain-Driven Design</strong> - <a href="https://vaadin.com/learn/tutorials/ddd/strategic-domain-driven-design" target="_blank" rel="noopener">Tutorial Vaadin</a></li>
      </ul>
    </section>
  </main>

  <footer>
    <p><strong>IF0100 - Lenguaje de Programación OO II</strong></p>
    <p>UNAULA - Ingeniería Informática - 2026-I</p>
    <p style="margin-top: 15px; font-size: 0.9em; opacity: 0.8;">
      Contacto: [correo del docente] | Repositorio: [enlace del curso]
    </p>
  </footer>
</body>
</html>