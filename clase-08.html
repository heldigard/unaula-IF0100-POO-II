<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clase 08 - Introducci√≥n a Angular y FastAPI | IF0100 - POO II</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f7fa;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
            border-radius: 0 0 20px 20px;
            margin-bottom: 30px;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        header .meta {
            margin-top: 15px;
            font-size: 0.9em;
            opacity: 0.85;
        }

        nav {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        nav ul {
            list-style: none;
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 0;
            padding: 0;
            flex-wrap: wrap;
        }

        nav li {
            margin: 0;
        }

        nav a {
            display: block;
            padding: 10px 20px;
            color: #1e3a8a;
            text-decoration: none;
            border-radius: 5px;
            transition: background 0.3s;
            font-weight: 500;
        }

        nav a:hover {
            background: #e0e7ff;
        }

        section {
            background: white;
            padding: 30px;
            margin-bottom: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h2 {
            color: #1e40af;
            font-size: 2em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #3b82f6;
        }

        h3 {
            color: #1e3a8a;
            font-size: 1.5em;
            margin-top: 25px;
            margin-bottom: 15px;
        }

        h4 {
            color: #3b82f6;
            font-size: 1.2em;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #e5e7eb;
        }

        th {
            background: #1e40af;
            color: white;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background: #f9fafb;
        }

        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
        }

        code {
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
        }

        pre code {
            color: inherit;
        }

        /* Syntax highlighting para Python */
        .token-keyword { color: #c792ea; font-weight: 600; }
        .token-type { color: #ffcb6b; }
        .token-string { color: #c3e88d; }
        .token-comment { color: #546e7a; font-style: italic; }
        .token-number { color: #f78c6c; }
        .token-operator { color: #89ddff; }
        /* Accessibility */
        abbr[title] { text-decoration: underline dotted; cursor: help; }

        p code, li code {
            background: #e0e7ff;
            color: #1e40af;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .diagram {
            font-family: 'Consolas', 'Monaco', monospace;
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            overflow-x: auto;
            border: 1px solid #e5e7eb;
        }

        figure {
            margin: 30px 0;
            text-align: center;
        }

        figure img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        figcaption {
            margin-top: 15px;
            font-style: italic;
            color: #64748b;
            font-size: 0.95em;
        }

        .highlight-box {
            background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #1e40af;
            margin: 20px 0;
        }

        .warning-box {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #f59e0b;
            margin: 20px 0;
        }

        .success-box {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #10b981;
            margin: 20px 0;
        }

        .note {
            background: #f0f4ff;
            border-left: 4px solid #3b82f6;
            padding: 10px 12px;
            border-radius: 8px;
            color: #52606d;
        }

        ul, ol {
            margin-left: 25px;
            margin-bottom: 15px;
        }

        li {
            margin-bottom: 8px;
        }

        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #1e40af;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            box-shadow: 0 4px 15px rgba(30, 64, 175, 0.4);
            transition: transform 0.3s;
        }

        .back-to-top:hover {
            transform: translateY(-5px);
        }

        footer {
            background: #1e293b;
            color: white;
            text-align: center;
            padding: 30px;
            margin-top: 50px;
        }

        /* Print styles */
        @media print {
            header, nav, footer { background: white !important; color: black !important; }
            a[href]:after { content: " (" attr(href) ")"; font-size: 0.8em; }
            pre, code { white-space: pre-wrap; }
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }

            section {
                padding: 20px;
            }
        }

        /* BLOQUES DE C√ìDIGO MEJORADOS */
        .code-block {
            background: #1e1e2e;
            border-radius: 12px;
            margin: 16px 0;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            border: 1px solid #313244;
        }

        .code-header {
            background: linear-gradient(90deg, #313244 0%, #45475a 100%);
            padding: 10px 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid #45475a;
        }

        .code-dots {
            display: flex;
            gap: 6px;
        }

        .code-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .code-dot.red { background: #f38ba8; }
        .code-dot.yellow { background: #f9e2af; }
        .code-dot.green { background: #a6e3a1; }

        .code-title {
            color: #cdd6f4;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: auto;
            font-family: 'Cascadia Code', Consolas, monospace;
        }

        .code-content {
            display: flex;
            background: #1e1e2e;
        }

        .line-numbers {
            background: #181825;
            color: #6c7086;
            padding: 12px 10px;
            text-align: right;
            font-family: 'Cascadia Code', Consolas, monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            user-select: none;
            border-right: 1px solid #313244;
        }

        .code-block pre {
            background: transparent;
            margin: 0;
            padding: 12px 16px;
            flex: 1;
            overflow-x: auto;
        }

        .code-block pre code {
            color: #cdd6f4;
            font-size: 0.95rem;
            line-height: 1.5;
            display: block;
        }

        /* Syntax highlighting mejorado - Catppuccin Mocha theme */
        .code-block .token-keyword { color: #cba6f7; font-weight: 600; } /* purple */
        .code-block .token-type { color: #f9e2af; } /* yellow */
        .code-block .token-string { color: #a6e3a1; } /* green */
        .code-block .token-comment { color: #6c7086; font-style: italic; } /* gray */
        .code-block .token-number { color: #fab387; } /* peach */
        .code-block .token-operator { color: #89dceb; } /* cyan */
        .code-block .token-method { color: #89b4fa; } /* blue */
        .code-block .token-class { color: #f9e2af; font-weight: 600; }
        .code-block .token-property { color: #b4befe; } /* lavender */
        .code-block .token-namespace { color: #f38ba8; } /* pink */

        /* C√≥digo inline */
        p code, li code {
            background: #313244;
            color: #cdd6f4;
            padding: 2px 8px;
            border-radius: 6px;
            font-size: 0.9em;
            border: 1px solid #45475a;
        }

        /* Tablas de c√≥digo */
        .code-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
            margin: 16px 0;
        }

        .code-comparison .code-block {
            margin: 0;
        }

        .code-label {
            font-size: 0.8rem;
            color: #6c7086;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: #1e40af;
            color: #fff;
            padding: 8px 16px;
            text-decoration: none;
            z-index: 100;
            transition: top 0.3s;
        }
        .skip-link:focus {
            top: 0;
        }
    </style>
</head>
<body>
    <a href="#main" class="skip-link">Saltar al contenido</a>
    <header>
        <h1>Introducci√≥n a Angular y FastAPI</h1>
        <div class="subtitle">IF0100 - Lenguaje de Programaci√≥n OO II | Unidad 3</div>
        <div class="meta">Duraci√≥n: 90 minutos</div>
        <div class="meta" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 16px; margin-top: 18px; background: rgba(255,255,255,0.12); padding: 16px; border-radius: 12px;">
            <div>
                <strong>Objetivos</strong>
                <ul style="margin: 8px 0 0 18px;">
                    <li>Entender qu√© es Angular (frontend) y FastAPI (backend).</li>
                    <li>Conocer la arquitectura y middleware pipeline.</li>
                    <li>Crear un primer proyecto web.</li>
                    <li>Crear componentes Angular b√°sicos.</li>
                    <li>Escribir middleware personalizado.</li>
                </ul>
            </div>
            <div>
                <strong>Prerrequisitos</strong>
                <ul style="margin: 8px 0 0 18px;">
                    <li>Conocimientos b√°sicos de Python, TypeScript y POO.</li>
                    <li>Comprensi√≥n de <abbr title="HTTP: HyperText Transfer Protocol, protocolo de comunicaci√≥n para la World Wide Web que define c√≥mo los mensajes son formateados y transmitidos">HTTP</abbr> (GET, POST, Headers).</li>
                    <li>Node.js + Angular CLI, Python 3.11+.</li>
                </ul>
            </div>
        </div>
    </header>

    <div class="container" id="main">
        <nav>
            <ul>
                <li><a href="#teoria">Teor√≠a</a></li>
                <li><a href="#ejemplos">Ejemplos</a></li>
                <li><a href="#practica">Pr√°ctica / Laboratorio</a></li>
                <li><a href="#ejercicios">Ejercicios</a></li>
                <li><a href="#referencias">Referencias</a></li>
            </ul>
        </nav>

        <section id="teoria">
        <section id="objetivos">
            <h2>Objetivos y Agenda</h2>
            <table>
                <thead>
                    <tr>
                        <th>Objetivos</th>
                        <th>Agenda (90 min)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>1. Entender Angular + FastAPI</td><td>15' Qu√© es Angular y FastAPI?</td></tr>
                    <tr><td>2. Conocer arquitectura</td><td>20' Arquitectura y Middleware</td></tr>
                    <tr><td>3. Crear primer proyecto</td><td>25' Crear Proyecto</td></tr>
                    <tr><td>4. Componentes Angular</td><td>20' Componentes y Templates</td></tr>
                    <tr><td>5. Middleware personalizado</td><td>10' Middleware Custom</td></tr>
                </tbody>
            </table>
        </section>

        <section id="que-es">
            <h2>1. Stack Web Moderno: Angular + FastAPI</h2>

            <h3>Angular (Frontend)</h3>
            <p><strong>Angular</strong> es un framework frontend de Google para construir aplicaciones web single-page (SPA) con TypeScript.</p>
            
            <h3>FastAPI (Backend)</h3>
            <p><strong>FastAPI</strong> es un framework web moderno y r√°pido para Python 3.7+, basado en Starlette y Pydantic, ideal para APIs REST.</p>
            
            <div class="note">Arquitectura t√≠pica: Angular consume APIs REST desarrolladas en FastAPI. Separaci√≥n clara entre frontend y backend.</div></p>

            <div class="success-box">
                <h4>Caracter√≠sticas del Stack:</h4>
                <ul>
                    <li><strong>Angular:</strong> Framework frontend completo con TypeScript</li>
                    <li><strong>FastAPI:</strong> Backend Python de alto rendimiento con validaci√≥n autom√°tica</li>
                    <li><strong>Cross-platform:</strong> Ambos funcionan en Windows, Linux, macOS</li>
                    <li><strong>Moderno:</strong> Async/await, DI integrado, tipado fuerte</li>
                    <li><strong>Separaci√≥n:</strong> Frontend y backend desacoplados v√≠a REST API</li>
                </ul>
            </div>

            <figure>
                <object data="../assets/infografias/clase-08-angular-fastapi.svg" type="image/svg+xml" style="max-width: 100%; height: auto; border-radius: 8px;">
                <img src="../assets/infografias/clase-08-angular-fastapi.svg" alt="Infograf√≠a Arquitectura Angular + FastAPI" />
        </object>
                <figcaption>Figura 1: Arquitectura Angular + FastAPI - Frontend con componentes, servicios HTTP y routing; Backend con FastAPI (Python) proporcionando API REST con validaci√≥n autom√°tica Pydantic y documentaci√≥n Swagger/OpenAPI generada autom√°ticamente.</figcaption>
            </figure>
        </section>

        <section id="arquitectura">
            <h2>2. Arquitectura</h2>

            <h3>Vista General</h3>
            <figure>
              <svg width="100%" viewBox="0 0 760 260" preserveAspectRatio="xMidYMid meet" role="img" aria-labelledby="fastapiTitle">
                <title id="fastapiTitle">Arquitectura FastAPI: Middleware pipeline y servidor Uvicorn</title>
                <style>
                  .app{fill:#05998b;rx:8}
                  .pipe{fill:#eef2ff;stroke:#a5f3fc;rx:8}
                  .s{font:700 13px Arial, sans-serif; fill:#fff}
                  .p{font:12px Arial, sans-serif; fill:#05998b}
                </style>
                <rect x="40" y="20" width="680" height="56" rx="10" fill="#05998b"/>
                <text x="380" y="54" text-anchor="middle" class="s">FASTAPI APP</text>

                <rect x="80" y="96" width="600" height="120" rx="8" fill="#eef2ff" stroke="#a5f3fc"/>
                <text x="380" y="120" text-anchor="middle" class="p">MIDDLEWARE PIPELINE (Starlette/ASGI)</text>
                <text x="380" y="140" text-anchor="middle" class="p">CORS ¬∑ GZip ¬∑ Session ¬∑ Authentication ¬∑ Custom Middleware ¬∑ Routes ¬∑ Response Middleware</text>

                <rect x="200" y="230" width="360" height="32" rx="8" fill="#fff" stroke="#a5f3fc"/>
                <text x="380" y="252" text-anchor="middle" class="p">UVICORN ASGI SERVER</text>
              </svg>
              <figcaption>Arquitectura simplificada de FastAPI: pipeline de middleware ASGI que procesa solicitudes, con Uvicorn como servidor web subyacente.</figcaption>
            </figure>
            </div> 

            <h3>Componentes Clave</h3>
            <table>
                <thead>
                    <tr>
                        <th>Componente</th>
                        <th>Descripci√≥n</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td><strong>Uvicorn</strong></td><td>Servidor ASGI de alto rendimiento</td></tr>
                    <tr><td><strong>Middleware Pipeline</strong></td><td>Tuber√≠a de procesamiento de solicitudes ASGI</td></tr>
                    <tr><td><strong><abbr title="Dependency Injection: Inyecci√≥n de dependencias, patr√≥n de dise√±o que implementa Inversi√≥n de Control (IoC) para lograr bajo acoplamiento entre componentes">Dependency Injection</abbr></strong></td><td>Contenedor DI en Angular + FastAPI</td></tr>
                    <tr><td><strong>Pydantic</strong></td><td>Validaci√≥n de datos con Python type hints</td></tr>
                    <tr><td><strong>OpenAPI</strong></td><td>Documentaci√≥n autom√°tica de API</td></tr>
                </tbody>
            </table>
        </section>

        <section id="middleware">
            <h2>3. Middleware Pipeline</h2>

            <h3>¬øQu√© es el Middleware Pipeline?</h3>
            <p>El Middleware Pipeline es una secuencia de componentes que procesan las solicitudes <abbr title="HTTP: HyperText Transfer Protocol, protocolo de comunicaci√≥n para la World Wide Web">HTTP</abbr> entrantes y las respuestas HTTP salientes.</p>

            <div class="highlight-box">
                <h4>¬øPor qu√© el Middleware Pipeline?</h4>
                <p>El patr√≥n Middleware es potente porque permite <strong>componer comportamiento</strong> de forma modular. Cada middleware hace una cosa bien, y el orden determina el comportamiento:</p>
                <ul>
                    <li><strong>Modularidad:</strong> Cada concern (auth, logging, routing) est√° aislado</li>
                    <li><strong>Reutilizable:</strong> Los middlewares se pueden reutilizar entre proyectos</li>
                    <li><strong>Flexible:</strong> Puedes agregar/quitar middlewares sin afectar otros</li>
                    <li><strong>El orden IMPORTA:</strong> Exception handler primero (catch todo), endpoints √∫ltimo (responden)</li>
                </ul>
            </div>

            <h3>Orden T√≠pico de Middleware</h3>
            <div class="code-block">
                <div class="code-header">
                    <div class="code-dots">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <span class="code-title">main.py (FastAPI)</span>
                </div>
                <div class="code-content">
                    <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29</div>
                    <pre><code><span class="token-keyword">from</span> fastapi <span class="token-keyword">import</span> FastAPI
<span class="token-keyword">from</span> fastapi.middleware.cors <span class="token-keyword">import</span> CORSMiddleware

<span class="token-property">app</span> = <span class="token-class">FastAPI</span>(title=<span class="token-string">"Mi API"</span>)

<span class="token-comment"># 1. CORS (para permitir llamadas desde Angular)</span>
<span class="token-property">app</span>.<span class="token-method">add_middleware</span>(
    CORSMiddleware,
    allow_origins=[<span class="token-string">"http://localhost:4200"</span>],
    allow_credentials=<span class="token-keyword">True</span>,
    allow_methods=[<span class="token-string">"*"</span>],
    allow_headers=[<span class="token-string">"*"</span>],
)

<span class="token-comment"># 2. Endpoints de la API</span>
<span class="token-keyword">@app.get</span>(<span class="token-string">"/api/saludo"</span>)
<span class="token-keyword">async def</span> <span class="token-method">saludo</span>(nombre: str = <span class="token-string">"Mundo"</span>):
    <span class="token-keyword">return</span> {<span class="token-string">"mensaje"</span>: <span class="token-string">f"Hola, {nombre}!"</span>}

<span class="token-comment"># Ejecutar: uvicorn main:app --reload</span></code></pre>
                </div>
            </div>

            <div class="highlight-box">
                <h4>Flujo de Solicitud</h4>
                <ol>
                    <li><strong>Request entra:</strong> CORS ‚Üí GZip ‚Üí Session ‚Üí Custom Middleware...</li>
                    <li><strong><strong>Endpoint</strong>: La solicitud llega al endpoint (Route Operation Function)</li>
                    <li><strong>Response sale:</strong> Endpoint ‚Üí Response Middleware ‚Üí ... ‚Üí Cliente</li>
                </ol>
            </div>

            <h3>Middleware Personalizado</h3>
            <p>Puedes crear tu propio middleware para procesamiento personalizado de solicitudes.</p>
        </section>

        <section id="crear-proyecto">
            <h2>4. Crear Proyecto</h2>

            <h3>Comandos CLI</h3>
            <div class="code-block">
                <div class="code-header">
                    <div class="code-dots">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <span class="code-title">bash</span>
                </div>
                <div class="code-content">
                    <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13</div>
                    <pre><code><span class="token-comment"># 1. Crear proyecto Angular</span>
npm install -g @angular/cli
ng new mi-app-angular --routing --style=css
cd mi-app-angular

<span class="token-comment"># 2. Crear componente</span>
ng generate component saludo

<span class="token-comment"># 3. Ejecutar frontend</span>
ng serve
<span class="token-comment"># Abrir: http://localhost:4200</span>

<span class="token-comment"># 4. Backend FastAPI (en otra terminal)</span>
pip install fastapi uvicorn
<span class="token-comment"># Crear main.py y ejecutar:</span>
uvicorn main:app --reload
<span class="token-comment"># API: http://localhost:8000</span></code></pre>
                </div>
            </div>

            <h3>Tipos de Proyecto</h3>
            <table>
                <thead>
                    <tr>
                        <th>Tipo</th>
                        <th>Uso Recomendado</th>
                        <th>Caracter√≠sticas</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td><strong>Angular <abbr title="SPA: Single Page Application, aplicaci√≥n web que cabe en una sola p√°gina y se actualiza din√°micamente sin recargar">SPA</abbr></strong></td><td>Aplicaciones web interactivas</td><td>TypeScript, Components, RxJS</td></tr>
                    <tr><td><strong>FastAPI REST</strong></td><td>Servicios <abbr title="API: Application Programming Interface, interfaz que permite que dos componentes de software se comuniquen entre s√≠">API</abbr> <abbr title="REST: Representational State Transfer, estilo arquitect√≥nico para sistemas distribuidos que usa HTTP">REST</abbr></td><td>Python, async/await, OpenAPI</td></tr>
                    <tr><td><strong>Angular + FastAPI</strong></td><td>Full-stack moderno</td><td>Frontend SPA + Backend API</td></tr>
                    <tr><td><strong>FastAPI + Jinja2</strong></td><td>Sitios web tradicionales</td><td>Server-side rendering, templates</td></tr>
                </tbody>
            </table>
        </section>

        <section id="fastapi-routes">
            <h2>5. FastAPI Routes</h2>

            <h3>¬øQu√© son las Routes en FastAPI?</h3>
            <p><strong>Routes</strong> son decoradores que definen c√≥mo responde la aplicaci√≥n a diferentes solicitudes HTTP. FastAPI usa decoradores como <code>@app.get()</code>, <code>@app.post()</code>, etc.</p>

            <h3>Route Handler (Backend)</h3>
            <div class="code-block">
                <div class="code-header">
                    <div class="code-dots">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <span class="code-title">main.py</span>
                </div>
                <div class="code-content">
                    <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27</div>
                    <pre><code><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Request, Form
<span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> HTMLResponse, JSONResponse
<span class="keyword">from</span> fastapi.templating <span class="keyword">import</span> Jinja2Templates
<span class="keyword">from</span> typing <span class="keyword">import</span> Optional
<span class="keyword">import</span> logging

<span class="comment"># Configurar logging</span>
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

<span class="comment"># Inicializar app</span>
app = FastAPI()
templates = Jinja2Templates(directory=<span class="string">"templates"</span>)

<span class="comment"># Route: GET / (cargar p√°gina)</span>
<span class="keyword">@app</span>.get(<span class="string">"/"</span>, response_class=HTMLResponse)
<span class="keyword">async def</span> <span class="method">index</span>(request: Request):
    logger.info(<span class="string">"Cargando p√°gina Index"</span>)
    <span class="keyword">return</span> templates.TemplateResponse(
        <span class="string">"index.html"</span>,
        {<span class="string">"request"</span>: request, <span class="string">"mensaje"</span>: <span class="string">"¬°Hola FastAPI!"</span>}
    )

<span class="comment"># Route: POST /saludo (procesar formulario)</span>
<span class="keyword">@app</span>.post(<span class="string">"/saludo"</span>)
<span class="keyword">async def</span> <span class="method">saludo</span>(nombre: <span class="type">str</span> = Form(...)):
    logger.info(f<span class="string">"Formulario enviado: {nombre}"</span>)
    <span class="keyword">return</span> {<span class="string">"mensaje"</span>: f<span class="string">"Formulario enviado: {nombre}"</span>}</code></pre>
                </div>
            </div>

            <h3>Jinja2 Template (Frontend)</h3>
            <div class="code-block">
                <div class="code-header">
                    <div class="code-dots">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <span class="code-title">templates/index.html</span>
                </div>
                <div class="code-content">
                    <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16</div>
                    <pre><code><span class="keyword">&lt;!DOCTYPE html&gt;</span>
<span class="keyword">&lt;html&gt;</span>
<span class="keyword">&lt;head&gt;</span>
    <span class="keyword">&lt;title&gt;</span>Home Page<span class="keyword">&lt;/title&gt;</span>
<span class="keyword">&lt;/head&gt;</span>
<span class="keyword">&lt;body&gt;</span>
    <span class="keyword">&lt;h1&gt;</span>{{ mensaje }}<span class="keyword">&lt;/h1&gt;</span>

    <span class="keyword">&lt;form</span> action=<span class="string">"/saludo"</span> method=<span class="string">"post"</span><span class="keyword">&gt;</span>
        <span class="keyword">&lt;input</span> name=<span class="string">"nombre"</span> placeholder=<span class="string">"Tu nombre"</span> /<span class="keyword">&gt;</span>
        <span class="keyword">&lt;button</span> type=<span class="string">"submit"</span><span class="keyword">&gt;</span>Enviar<span class="keyword">&lt;/button&gt;</span>
    <span class="keyword">&lt;/form&gt;</span>
<span class="keyword">&lt;/body&gt;</span>
<span class="keyword">&lt;/html&gt;</span></code></pre>
                </div>
            </div>

            <h3>Convenciones FastAPI</h3>
            <table>
                <thead>
                    <tr>
                        <th>Elemento</th>
                        <th>Convencion</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td><strong>Archivo Main</strong></td><td><code>main.py</code></td></tr>
                    <tr><td><strong>Archivo Template</strong></td><td><code>templates/nombre.html</code></td></tr>
                    <tr><td><strong>Route GET</strong></td><td><code>@app.get("/ruta")</code></td></tr>
                    <tr><td><strong>Route POST</strong></td><td><code>@app.post("/ruta")</code></td></tr>
                    <tr><td><strong>Route Async</strong></td><td><code>async def nombre():</code></td></tr>
                </tbody>
            </table>
        </section>

        <section id="middleware-custom">
            <h2>6. Middleware Personalizado</h2>

            <h3>Estructura B√°sica</h3>
            <div class="code-block">
                <div class="code-header">
                    <div class="code-dots">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <span class="code-title">middleware.py</span>
                </div>
                <div class="code-content">
                    <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36</div>
                    <pre><code><span class="keyword">import</span> time
<span class="keyword">import</span> logging
<span class="keyword">from</span> fastapi <span class="keyword">import</span> Request
<span class="keyword">from</span> starlette.middleware.base <span class="keyword">import</span> BaseHTTPMiddleware, RequestResponseEndpoint

logger = logging.getLogger(__name__)

<span class="keyword">class</span> <span class="type">TimingMiddleware</span>(BaseHTTPMiddleware):
    <span class="keyword">async def</span> <span class="method">dispatch</span>(
        <span class="keyword">self</span>,
        request: Request,
        call_next: RequestResponseEndpoint
    ):
        <span class="comment"># Iniciar temporizador</span>
        start_time = time.time()

        <span class="comment"># Pasar al siguiente middleware</span>
        response = <span class="keyword">await</span> call_next(request)

        <span class="comment"># Calcular tiempo transcurrido</span>
        process_time = (time.time() - start_time) * <span class="number">1000</span>

        <span class="comment"># Log del tiempo de respuesta</span>
        logger.info(
            <span class="string">f"Request: {request.url.path} - "</span>
            <span class="string">f"Tiempo: {process_time:.2f}ms - "</span>
            <span class="string">f"Status: {response.status_code}"</span>
        )

        <span class="comment"># Agregar header de tiempo</span>
        response.headers[<span class="string">"X-Process-Time"</span>] = <span class="keyword">str</span>(process_time)
        <span class="keyword">return</span> response</code></pre>
                </div>
            </div>

            <h3>Registro en main.py</h3>
            <div class="code-block">
                <div class="code-header">
                    <div class="code-dots">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <span class="code-title">main.py</span>
                </div>
                <div class="code-content">
                    <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8</div>
                    <pre><code><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI
<span class="keyword">from</span> middleware <span class="keyword">import</span> TimingMiddleware

<span class="comment"># Crear app FastAPI</span>
app = FastAPI()

<span class="comment"># Registrar middleware custom</span>
app.add_middleware(TimingMiddleware)

<span class="comment"># O como m√©todo de extensi√≥n</span>
<span class="comment"># app.add_middleware(TimingMiddleware)</span></code></pre>
                </div>
            </div>

            <h3>Middleware con Condici√≥n</h3>
            <div class="code-block">
                <div class="code-header">
                    <div class="code-dots">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <span class="code-title">auth.py</span>
                </div>
                <div class="code-content">
                    <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26</div>
                    <pre><code><span class="keyword">from</span> fastapi <span class="keyword">import</span> Depends, HTTPException, Request, status
<span class="keyword">from</span> typing <span class="keyword">import</span> List

<span class="keyword">class</span> <span class="type">AuthService</span>:
    <span class="keyword">def</span> <span class="method">is_admin</span>(<span class="keyword">self</span>, request: Request) -> <span class="type">bool</span>:
        <span class="comment"># Verificar si el usuario es admin</span>
        user_role = request.state.get(<span class="string">"user_role"</span>, <span class="string">"guest"</span>)
        <span class="keyword">return</span> user_role == <span class="string">"admin"</span>

<span class="comment"># Servicio singleton</span>
auth_service = AuthService()

<span class="comment"># Dependencia para verificar admin</span>
<span class="keyword">async def</span> <span class="method">require_admin</span>(
    request: Request,
    auth: AuthService = Depends(<span class="keyword">lambda</span>: auth_service)
):
    <span class="keyword">if</span> <span class="keyword">not</span> auth.is_admin(request):
        <span class="keyword">raise</span> HTTPException(
            status_code=status.HTTP_403_FORBIDDEN,
            detail=<span class="string">"Acceso denegado: Se requiere rol de admin"</span>
        )
    <span class="keyword">return</span> <span class="keyword">True</span>

<span class="comment"># Uso en routes</span>
<span class="keyword">@app</span>.get(<span class="string">"/admin/dashboard"</span>)
<span class="keyword">async def</span> <span class="method">admin_dashboard</span>(
    request: Request,
    _: <span class="type">bool</span> = Depends(require_admin)
):
    <span class="keyword">return</span> {<span class="string">"message"</span>: <span class="string">"Panel de administraci√≥n"</span>}</code></pre>
                </div>
            </div>
        </section>
        </section>

        <section id="ejemplos">
            <h2>Ejemplos</h2>
            <p>Los ejemplos de c√≥digo est√°n integrados en las secciones te√≥ricas anteriores. Consulte cada secci√≥n para ver ejemplos pr√°cticos de:</p>
            <ul>
                <li>Configuraci√≥n de middleware en FastAPI</li>
                <li>Creaci√≥n de proyectos con FastAPI CLI</li>
                <li>Implementaci√≥n de routes con FastAPI</li>
                <li>Desarrollo de middleware personalizado con BaseHTTPMiddleware</li>
            </ul>
        </section>

        <section id="practica">
            <h2>Pr√°ctica / Laboratorio (35 min)</h2>
            <section class="actividad">
                <h3>Actividad: Laboratorio FastAPI + Angular - Primera App Web (35 min)</h3>
                <p><strong>Tipo:</strong> Opcional / pr√°ctica</p>
                <p><strong>Relacionado con:</strong> Ninguno</p>
                <p><strong>Entregable:</strong> Aplicaci√≥n web con Angular (frontend) y FastAPI (backend) con middleware</p>
                <p><strong>Tiempo estimado:</strong> 35 min</p>
                <p><strong>Criterios de √©xito:</strong> Backend se ejecuta, frontend se ejecuta, middleware registrado y funcionando</p>
                <div class="success-box">Objetivo: Crear una aplicaci√≥n web con Angular + FastAPI con middleware personalizado.</div>

            <h3>Pasos - Backend FastAPI</h3>
            <ol>
                <li>Crear carpeta para el proyecto: <code>mkdir mi-app-web</code> y entrar: <code>cd mi-app-web</code>.</li>
                <li>Crear entorno virtual: <code>python -m venv venv</code>.</li>
                <li>Activar entorno (Windows): <code>venv\Scripts\activate</code>.</li>
                <li>Instalar FastAPI y Uvicorn: <code>pip install fastapi uvicorn</code>.</li>
                <li>Crear archivo <code>main.py</code> con aplicaci√≥n FastAPI b√°sica.</li>
                <li>Ejecutar: <code>uvicorn main:app --reload</code>.</li>
            </ol>
            <div class="success-box">Checklist: Entorno virtual creado, dependencias instaladas, servidor se ejecuta en http://localhost:8000, API responde en /docs.</div>

            <h3>Crear una Route con Formulario</h3>
            <ol>
                <li>En <code>main.py</code>, importar <code>Request</code> y <code>Form</code> de FastAPI.</li>
                <li>Crear template engine con Jinja2: <code>templates = Jinja2Templates(directory="templates")</code>.</li>
                <li>Crear carpeta <code>templates</code> y agregar archivo HTML.</li>
                <li>Crear route <code>@app.post("/calcular")</code> que recibe datos del formulario.</li>
                <li>Probar la route con Swagger UI en <code>http://localhost:8000/docs</code>.</li>
            </ol>

            <h3>Crear Middleware Personalizado</h3>
            <div class="code-block">
                <div class="code-header">
                    <div class="code-dots">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <span class="code-title">middleware.py</span>
                </div>
                <div class="code-content">
                    <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20</div>
                    <pre><code><span class="keyword">import</span> time
<span class="keyword">import</span> logging
<span class="keyword">from</span> fastapi <span class="keyword">import</span> Request
<span class="keyword">from</span> starlette.middleware.base <span class="keyword">import</span> BaseHTTPMiddleware, RequestResponseEndpoint

logger = logging.getLogger(__name__)

<span class="keyword">class</span> <span class="type">TimingMiddleware</span>(BaseHTTPMiddleware):
    <span class="keyword">async def</span> <span class="method">dispatch</span>(
        <span class="keyword">self</span>,
        request: Request,
        call_next: RequestResponseEndpoint
    ):
        <span class="comment"># Iniciar temporizador</span>
        start_time = time.time()

        <span class="comment"># Pasar al siguiente middleware</span>
        response = <span class="keyword">await</span> call_next(request)

        <span class="comment"># Calcular tiempo transcurrido</span>
        process_time = (time.time() - start_time) * <span class="number">1000</span>

        <span class="comment"># Log del tiempo de respuesta</span>
        logger.info(
            <span class="string">f"Request: {request.url.path} - "</span>
            <span class="string">f"Tiempo: {process_time:.2f}ms"</span>
        )

        <span class="comment"># Agregar header de tiempo</span>
        response.headers[<span class="string">"X-Process-Time"</span>] = <span class="keyword">str</span>(process_time)
        <span class="keyword">return</span> response</code></pre>
                </div>
            </div>
            <ol>
                <li>En <code>main.py</code>, agregar el middleware con <code>app.add_middleware()</code>.</li>
                <li>Ejecutar y verificar los logs en la consola.</li>
            </ol>
            <div class="success-box">Checklist: Middleware registrado correctamente, logs muestran tiempo de respuesta, no hay errores de ejecuci√≥n.</div>
        </section>

        <section id="ejercicios">
            <h2>8. Ejercicios Pr√°cticos</h2>

            <section class="actividad">
                <h3>Actividad: Ejercicio 1 - Calculadora con FastAPI (20 min)</h3>
                <p><strong>Tipo:</strong> Opcional / pr√°ctica</p>
                <p><strong>Relacionado con:</strong> Ninguno</p>
                <p><strong>Entregable:</strong> Route FastAPI con calculadora funcional</p>
                <p><strong>Tiempo estimado:</strong> 20 min</p>
                <p><strong>Criterios de √©xito:</strong> Route creada, formulario funcional, operaciones correctas, validaci√≥n de divisi√≥n por cero</p>
                <p><strong>Objetivo:</strong> Crear una route FastAPI con calculadora b√°sica.</p>
            <ul>
                <li>Route POST <code>/calcular</code> con dos par√°metros num√©ricos</li>
                <li>Operaciones: Sumar, Restar, Multiplicar, Dividir</li>
                <li>Retornar JSON con resultado</li>
                <li>Validar divisi√≥n por cero con HTTP 400</li>
            </ul>
            <div class="success-box">Checklist: Route creada, responde correctamente, operaciones implementadas, validaci√≥n de divisi√≥n por cero funcionando.</div>

            <section class="actividad">
                <h3>Actividad: Ejercicio 2 - Middleware de Timing (15 min)</h3>
                <p><strong>Tipo:</strong> Opcional / pr√°ctica</p>
                <p><strong>Relacionado con:</strong> Ninguno</p>
                <p><strong>Entregable:</strong> Middleware personalizado de timing</p>
                <p><strong>Tiempo estimado:</strong> 15 min</p>
                <p><strong>Criterios de √©xito:</strong> Middleware creado y registrado, tiempo medido correctamente, logs visibles en consola</p>
                <p><strong>Objetivo:</strong> Middleware que mide tiempo de respuesta.</p>
            <ul>
                <li>Cronometrar cada solicitud</li>
                <li>Mostrar tiempo en header de respuesta</li>
                <li>Log de solicitudes lentas (>1 segundo)</li>
            </ul>
            <div class="success-box">Checklist: Middleware creado y registrado, tiempo medido correctamente, logs visibles en consola.</div>

            <section class="actividad">
                <h3>Actividad: Ejercicio 3 - Formulario con Validaci√≥n (25 min)</h3>
                <p><strong>Tipo:</strong> Opcional / pr√°ctica</p>
                <p><strong>Relacionado con:</strong> Ninguno</p>
                <p><strong>Entregable:</strong> Componente Angular con formulario validado + Route FastAPI</p>
                <p><strong>Tiempo estimado:</strong> 25 min</p>
                <p><strong>Criterios de √©xito:</strong> Validaciones implementadas, mensajes de error visibles, formulario rechaza datos inv√°lidos</p>
                <p><strong>Objetivo:</strong> Formulario con validaciones en Angular + FastAPI.</p>
            <ul>
                <li>Nombre requerido</li>
                <li>Email formato v√°lido</li>
                <li>Edad entre 18 y 100</li>
                <li>Mensajes de error en pantalla</li>
            </ul>
            <div class="success-box">Checklist: Validaciones implementadas, mensajes de error visibles, formulario rechaza datos inv√°lidos.</div>
            <div class="success-box" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-left-color: #f59e0b;">Tiempo sugerido total: 60 min (20 + 15 + 25).</div>
        </section>

        <section class="evaluacion-calificable">
            <h3>üìã Evaluaci√≥n programada</h3>
            <p><strong>Detalle:</strong> Consultar plataforma del curso para informaci√≥n completa sobre evaluaci√≥n calificable.</p>
        </section>

        <section id="resumen">
            <h2>Resumen de la Clase</h2>

            <h3>Conceptos Clave Aprendidos</h3>
            <table>
                <thead>
                    <tr>
                        <th>Tema</th>
                        <th>Descripci√≥n</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td><strong>FastAPI</strong></td><td>Framework web moderno as√≠ncrono para Python</td></tr>
                    <tr><td><strong>Uvicorn</strong></td><td>Servidor ASGI de alto rendimiento</td></tr>
                    <tr><td><strong>Middleware Pipeline</strong></td><td>Tuber√≠a de procesamiento de solicitudes ASGI</td></tr>
                    <tr><td><strong>Routes</strong></td><td>Decoradores que definen endpoints HTTP</td></tr>
                    <tr><td><strong>Angular Components</strong></td><td>Clases TypeScript con plantilla HTML</td></tr>
                    <tr><td><strong>Dependency Injection</strong></td><td>Inyecci√≥n de dependencias en Angular y FastAPI</td></tr>
                </tbody>
            </table>

            <h3>Habilidades Adquiridas</h3>
            <ul>
                <li>Crear proyecto FastAPI + Angular</li>
                <li>Configurar Middleware Pipeline en FastAPI</li>
                <li>Crear Routes FastAPI con operadores as√≠ncronos</li>
                <li>Implementar middleware personalizado con BaseHTTPMiddleware</li>
                <li>Usar inyecci√≥n de dependencias en Angular</li>
            </ul>

            <h3>Pr√≥ximos Pasos</h3>
            <ul>
                <li><strong>Clase 9:</strong> HTML5 y Bootstrap</li>
                <li>Practicar creando proyectos reales</li>
                <li>Explorar Reactive Forms en Angular</li>
            </ul>

            <h3>Referencias y Recursos</h3>
            <ul>
                <li><strong>Documentaci√≥n oficial de FastAPI:</strong> <a href="https://fastapi.tiangolo.com/" target="_blank" rel="noopener">https://fastapi.tiangolo.com/</a></li>
                <li><strong>Tutorial de Angular:</strong> <a href="https://angular.io/tutorial" target="_blank" rel="noopener">Angular Tutorial</a></li>
                <li><strong>Middleware en FastAPI:</strong> <a href="https://fastapi.tiangolo.com/tutorial/middleware/" target="_blank" rel="noopener">FastAPI Middleware</a></li>
                <li><strong>Inyecci√≥n de Dependencias en Angular:</strong> <a href="https://angular.io/guide/dependency-injection" target="_blank" rel="noopener">Angular DI</a></li>
                <li><strong>Uvicorn ASGI Server:</strong> <a href="https://www.uvicorn.org/" target="_blank" rel="noopener">Uvicorn Documentation</a></li>
            </ul>
        </section>

        <section id="entrega-git">
            <h2>Entrega con Git</h2>
            <p>Para el proyecto Angular + FastAPI:</p>
            <div class="code-block">
                <div class="code-header">
                    <div class="code-dots">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <span class="code-title">bash</span>
                </div>
                <div class="code-content">
                    <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14</div>
                    <pre><code class="language-bash"># Estructura del repo
git init

# Crear rama feature
git checkout -b feature/angular-fastapi-clase-08

# Commit 1: Setup
git add .
git commit -m "chore: setup Angular CLI y FastAPI"

# Commit 2: Implementaci√≥n
git commit -am "feat: agrega componente saludo y endpoint API"

# Commit 3: Documentaci√≥n
git commit -am "docs: README con instrucciones de ejecuci√≥n"

# Tag
git tag -a clase-08-v1 -m "Entrega clase 08 - Angular + FastAPI"</code></pre>
                </div>
            </div>
        </section>

        <section id="referencias">
            <h2>Referencias</h2>
            <ul>
                <li><strong>Documentaci√≥n oficial de FastAPI:</strong> <a href="https://fastapi.tiangolo.com/" target="_blank" rel="noopener">fastapi.tiangolo.com</a></li>
                <li><strong>Introducci√≥n a Angular:</strong> <a href="https://angular.io/docs" target="_blank" rel="noopener">Angular documentation</a></li>
                <li><strong>Middleware en FastAPI:</strong> <a href="https://fastapi.tiangolo.com/tutorial/middleware/" target="_blank" rel="noopener">Middleware documentation</a></li>
                <li><strong>Starlette ASGI:</strong> <a href="https://www.starlette.io/" target="_blank" rel="noopener">Starlette documentation</a></li>
            </ul>
        </section>
    </div>

    <a href="#inicio" class="back-to-top">&uarr;</a>

    <footer>
        <p><strong>IF0100 - Lenguaje de Programaci√≥n OO II</strong></p>
        <p>UNAULA - Ingenier√≠a Inform√°tica - 2026-I</p>
        <p style="margin-top: 15px; font-size: 0.9em; opacity: 0.8;">
            Contacto: [correo del docente] | Repositorio: [enlace del curso]
        </p>
    </footer>
</body>
</html>
