<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clase 11 - Formularios, Validación y Sesiones | IF0100 POO II</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }
        .header {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }
        .header h1 { font-size: 2.5rem; margin-bottom: 0.5rem; }
        .header p { font-size: 1.1rem; opacity: 0.9; }
        .meta-bar {
            background: #1e3a8a;
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .meta-bar span { font-size: 0.9rem; }
        .nav {
            background: #1e3a8a;
            padding: 0.5rem 2rem;
            display: flex;
            gap: 1.5rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        .nav a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background 0.3s;
        }
        .nav a:hover { background: rgba(255,255,255,0.2); }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        .section {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .section h2 {
            color: #1e40af;
            border-bottom: 3px solid #3b82f6;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        .section h3 {
            color: #3b82f6;
            margin: 1.5rem 0 1rem;
        }
        .section h4 {
            color: #1e3a8a;
            margin: 1rem 0 0.5rem;
        }
        .objectives-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        .objectives-table th, .objectives-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        .objectives-table th { background: #f3f4f6; }
        pre {
            background: #1f2937;
            color: #f9fafb;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1rem 0;
            font-size: 0.9rem;
        }
        code {
            background: #e5e7eb;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: "Fira Code", "Consolas", monospace;
            font-size: 0.9em;
        }
        pre code { background: none; padding: 0; }
        /* Syntax highlighting para Python */
        .token-keyword { color: #c792ea; font-weight: 600; }
        .token-type { color: #ffcb6b; }
        .token-string { color: #c3e88d; }
        .token-comment { color: #546e7a; font-style: italic; }
        .token-number { color: #f78c6c; }
        .token-operator { color: #89ddff; }
        /* Accessibility */
        abbr[title] { text-decoration: underline dotted; cursor: help; }
        .example-box {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }
        .note {
            background: #f0f4ff;
            border-left: 4px solid #3b82f6;
            padding: 10px 12px;
            border-radius: 8px;
            color: #52606d;
        }
        .figure-container {
            text-align: center;
            margin: 2rem 0;
        }
        .figure-container img {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .figure-container figcaption {
            margin-top: 0.5rem;
            font-style: italic;
            color: #6b7280;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 1rem 0;
        }
        .comparison .bad {
            background: #fef2f2;
            border: 1px solid #fca5a5;
            padding: 1rem;
            border-radius: 4px;
        }
        .comparison .good {
            background: #f0fdf4;
            border: 1px solid #86efac;
            padding: 1rem;
            border-radius: 4px;
        }
        .comparison-title {
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        .badge-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 1rem 0;
        }
        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
        }
        .badge-blue { background: #dbeafe; color: #1e40af; }
        .badge-green { background: #dcfce7; color: #166534; }
        .badge-purple { background: #f3e8ff; color: #7c3aed; }
        .badge-red { background: #fee2e2; color: #991b1b; }
        .tag-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            font-size: 0.9rem;
        }
        .tag-table th {
            background: #1e40af;
            color: white;
            padding: 0.75rem;
            text-align: left;
        }
        .tag-table td {
            padding: 0.75rem;
            border-bottom: 1px solid #e5e7eb;
        }
        ul, ol { margin-left: 1.5rem; }
        li { margin: 0.5rem 0; }
        .footer {
            background: #1e3a8a;
            color: white;
            text-align: center;
            padding: 2rem;
            margin-top: 2rem;
        }
        .note-box {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }
        .note-box strong { color: #92400e; }
        .warning-box {
            background: #fee2e2;
            border: 1px solid #fca5a5;
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }
        .warning-box strong { color: #991b1b; }
        /* Print styles */
        @media print {
            header, nav, footer { background: white !important; color: black !important; }
            a[href]:after { content: " (" attr(href) ")"; font-size: 0.8em; }
            pre, code { white-space: pre-wrap; }
        }
        @media (max-width: 768px) {
            .comparison { grid-template-columns: 1fr; }
            .header h1 { font-size: 1.8rem; }
            .meta-bar { flex-direction: column; text-align: center; }
        }

        /* BLOQUES DE CÓDIGO MEJORADOS */
        .code-block {
            background: #1e1e2e;
            border-radius: 12px;
            margin: 16px 0;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            border: 1px solid #313244;
        }

        .code-header {
            background: linear-gradient(90deg, #313244 0%, #45475a 100%);
            padding: 10px 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid #45475a;
        }

        .code-dots {
            display: flex;
            gap: 6px;
        }

        .code-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .code-dot.red { background: #f38ba8; }
        .code-dot.yellow { background: #f9e2af; }
        .code-dot.green { background: #a6e3a1; }

        .code-title {
            color: #cdd6f4;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: auto;
            font-family: 'Cascadia Code', Consolas, monospace;
        }

        .code-content {
            display: flex;
            background: #1e1e2e;
        }

        .line-numbers {
            background: #181825;
            color: #6c7086;
            padding: 12px 10px;
            text-align: right;
            font-family: 'Cascadia Code', Consolas, monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            user-select: none;
            border-right: 1px solid #313244;
        }

        .code-block pre {
            background: transparent;
            margin: 0;
            padding: 12px 16px;
            flex: 1;
            overflow-x: auto;
        }

        .code-block pre code {
            color: #cdd6f4;
            font-size: 0.95rem;
            line-height: 1.5;
            display: block;
        }

        /* Syntax highlighting mejorado - Catppuccin Mocha theme */
        .code-block .token-keyword { color: #cba6f7; font-weight: 600; } /* purple */
        .code-block .token-type { color: #f9e2af; } /* yellow */
        .code-block .token-string { color: #a6e3a1; } /* green */
        .code-block .token-comment { color: #6c7086; font-style: italic; } /* gray */
        .code-block .token-number { color: #fab387; } /* peach */
        .code-block .token-operator { color: #89dceb; } /* cyan */
        .code-block .token-method { color: #89b4fa; } /* blue */
        .code-block .token-class { color: #f9e2af; font-weight: 600; }
        .code-block .token-property { color: #b4befe; } /* lavender */
        .code-block .token-namespace { color: #f38ba8; } /* pink */

        /* Código inline */
        p code, li code {
            background: #313244;
            color: #cdd6f4;
            padding: 2px 8px;
            border-radius: 6px;
            font-size: 0.9em;
            border: 1px solid #45475a;
        }

        /* Tablas de código */
        .code-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
            margin: 16px 0;
        }

        .code-comparison .code-block {
            margin: 0;
        }

        .code-label {
            font-size: 0.8rem;
            color: #6c7086;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: #1e3a8a;
            color: #fff;
            padding: 8px 16px;
            text-decoration: none;
            z-index: 100;
            transition: top 0.3s;
        }
        .skip-link:focus {
            top: 0;
        }
    </style>
</head>
<body>
    <a href="#main" class="skip-link">Saltar al contenido</a>
    <header class="header">
        <h1>Clase 11 - Formularios, Validación y Sesiones</h1>
        <p>IF0100 - Lenguaje de Programación Orientada a Objetos II | Unidad 3 - Desarrollo Web</p>
    </header>

    <div class="meta-bar">
        <span> Duración: 90 minutos</span>
        <span> Unidad 3 - Desarrollo Web</span>
        <span> 4 Semestre - Ingeniería Informática</span>
    </div>

    <nav class="nav">
        <a href="#teoria">Teoría</a>
        <a href="#ejemplos">Ejemplos</a>
        <a href="#practica">Práctica / Laboratorio</a>
        <a href="#ejercicios">Ejercicios</a>
        <a href="#referencias">Referencias</a>
    </nav>

    <main class="container" id="main">
        <!-- Teoría -->
        <section id="teoria">
        <!-- Objetivos -->
        <section id="objetivos" class="section">
            <h2>Objetivos de la Clase</h2>
            <table class="objectives-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Objetivo</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td><strong>Implementar</strong> validación de datos con Data Annotations</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td><strong>Configurar</strong> validación en cliente y servidor</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td><strong>Utilizar</strong> TempData, ViewBag y ViewData</td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td><strong>Gestionar</strong> sesiones y cookies</td>
                    </tr>
                    <tr>
                        <td>5</td>
                        <td><strong>Implementar</strong> upload de archivos</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Agenda -->
        <section id="agenda" class="section">
            <h2>Agenda (90 min)</h2>
            <table class="objectives-table">
                <thead>
                    <tr>
                        <th>Tiempo</th>
                        <th>Tema</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>20'</td>
                        <td>Validación con Data Annotations</td>
                    </tr>
                    <tr>
                        <td>10'</td>
                        <td>Validación cliente vs servidor</td>
                    </tr>
                    <tr>
                        <td>10'</td>
                        <td>TempData y mensajes flash</td>
                    </tr>
                    <tr>
                        <td>15'</td>
                        <td>Sesiones y Cookies</td>
                    </tr>
                    <tr>
                        <td>15'</td>
                        <td>Upload de archivos</td>
                    </tr>
                    <tr>
                        <td>20'</td>
                        <td>Ejercicio integrador</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Data Annotations -->
        <section id="data-annotations" class="section">
            <h2>1. Validación con Data Annotations</h2>

            <div class="note-box">
                <strong>¿Por qué Data Annotations?</strong>
                <ul>
                    <li><strong>Declarativo:</strong> Las reglas de validación están en el modelo, no dispersas en el código</li>
                    <li><strong>Reusable:</strong> Mismas reglas para validación cliente y servidor</li>
                    <li><strong>Mantenible:</strong> Un solo lugar para cambiar reglas de negocio</li>
                    <li><strong>Estándar:</strong> <abbr title="Data Annotations - Sistema de atributos de validación declarativa en Python">Data Annotations</abbr> es parte de Python desde versión 3.5</li>
                </ul>
            </div>

            <h3>Atributos de validación en Python</h3>
            <div class="code-block">
                <div class="code-header">
                    <div class="code-dots">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <span class="code-title">estudiante_model.py</span>
                </div>
                <div class="code-content">
                    <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56</div>
                    <pre><code><span class="token-keyword">from</span> pydantic <span class="token-keyword">import</span> BaseModel, Field, field_validator, EmailStr
<span class="token-keyword">from</span> typing <span class="token-keyword">import</span> Optional
<span class="token-keyword">from</span> datetime <span class="token-keyword">import</span> date, datetime

<span class="token-keyword">class</span> <span class="token-class">EstudianteViewModel</span>(BaseModel):
    <span class="token-comment"># VALIDACIÓN BÁSICA</span>
    codigo: <span class="token-keyword">str</span> = Field(..., min_length=<span class="token-number">5</span>, max_length=<span class="token-number">10</span>,
                          description=<span class="token-string">"Código Estudiantil"</span>)
    nombre: <span class="token-keyword">str</span> = Field(..., min_length=<span class="token-number">1</span>, max_length=<span class="token-number">50</span>)
    apellido: <span class="token-keyword">str</span> = Field(..., min_length=<span class="token-number">1</span>, max_length=<span class="token-number">50</span>)

    <span class="token-comment"># VALIDACIÓN DE EMAIL</span>
    email: EmailStr

    <span class="token-comment"># VALIDACIÓN NUMÉRICA</span>
    edad: <span class="token-keyword">int</span> = Field(..., ge=<span class="token-number">18</span>, le=<span class="token-number">100</span>)
    promedio: <span class="token-keyword">float</span> = Field(..., ge=<span class="token-number">0.0</span>, le=<span class="token-number">5.0</span>)

    <span class="token-comment"># VALIDACIÓN DE PATRÓN (Regex)</span>
    telefono: <span class="token-keyword">str</span> = Field(..., pattern=<span class="token-string">r"^\d{10}$"</span>)

    <span class="token-comment"># VALIDACIÓN DE FECHAS</span>
    fecha_nacimiento: <span class="token-type">date</span>

    <span class="token-comment"># COMPARACIÓN</span>
    password: <span class="token-keyword">str</span> = Field(..., min_length=<span class="token-number">8</span>)
    confirmar_password: <span class="token-keyword">str</span>

    <span class="token-attribute">@field_validator</span>(<span class="token-string">'confirmar_password'</span>)
    <span class="token-keyword">def</span> <span class="token-function">passwords_match</span>(cls, v, info):
        <span class="token-keyword">if</span> <span class="token-string">'password'</span> <span class="token-keyword">in</span> info.data <span class="token-keyword">and</span> v != info.data[<span class="token-string">'password'</span>]:
            <span class="token-keyword">raise</span> <span class="token-exception">ValueError</span>(<span class="token-string">'Las contraseñas no coinciden'</span>)
        <span class="token-keyword">return</span> v

    <span class="token-attribute">@field_validator</span>(<span class="token-string">'fecha_nacimiento'</span>)
    <span class="token-keyword">def</span> <span class="token-function">fecha_debe_ser_pasado</span>(cls, v):
        <span class="token-keyword">if</span> v >= date.today():
            <span class="token-keyword">raise</span> <span class="token-exception">ValueError</span>(<span class="token-string">'La fecha debe ser en el pasado'</span>)
        <span class="token-keyword">return</span> v

    <span class="token-attribute">@field_validator</span>(<span class="token-string">'edad'</span>)
    <span class="token-keyword">def</span> <span class="token-function">validar_mayoria_edad</span>(cls, v):
        <span class="token-keyword">if</span> v < <span class="token-number">18</span>:
            <span class="token-keyword">raise</span> <span class="token-exception">ValueError</span>(<span class="token-string">'Debe ser mayor de edad (18 años)'</span>)
        <span class="token-keyword">return</span> v

    <span class="token-keyword">class</span> <span class="token-class">Config</span>:
        <span class="token-string">str</span> = <span class="token-string">"min length = 5 characters"</span>
        <span class="token-string">str</span> = <span class="token-string">"max length = 50 characters"</span></code></pre>
                </div>
            </div>

            <h3>Data Annotations Disponibles</h3>
            <table class="tag-table">
                <thead>
                    <tr>
                        <th>Categoría</th>
                        <th>Atributo</th>
                        <th>Descripción</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Requerimiento</td>
                        <td><code>[Required]</code></td>
                        <td>Campo obligatorio</td>
                    </tr>
                    <tr>
                        <td>Longitud</td>
                        <td><code>[StringLength(50)]</code></td>
                        <td>Máximo 50 caracteres</td>
                    </tr>
                    <tr>
                        <td>Longitud</td>
                        <td><code>[MinLength(5)]</code></td>
                        <td>Mínimo 5 caracteres</td>
                    </tr>
                    <tr>
                        <td>Numérica</td>
                        <td><code>[Range(0, 100)]</code></td>
                        <td>Entre 0 y 100</td>
                    </tr>
                    <tr>
                        <td>Formato</td>
                        <td><code>[EmailAddress]</code></td>
                        <td>Formato email</td>
                    </tr>
                    <tr>
                        <td>Formato</td>
                        <td><code>[Phone]</code></td>
                        <td>Formato teléfono</td>
                    </tr>
                    <tr>
                        <td>Formato</td>
                        <td><code>[Url]</code></td>
                        <td>Formato URL</td>
                    </tr>
                    <tr>
                        <td>Formato</td>
                        <td><code>[RegularExpression(@"...")]</code></td>
                        <td>Patrón regex personalizado</td>
                    </tr>
                    <tr>
                        <td>Comparación</td>
                        <td><code>[Compare("OtraPropiedad")]</code></td>
                        <td>Debe coincidir con otra propiedad</td>
                    </tr>
                </tbody>
            </table>

            <h3>Validación Personalizada</h3>
            <div class="code-block">
                <div class="code-header">
                    <div class="code-dots">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <span class="code-title">validacion_personalizada.py</span>
                </div>
                <div class="code-content">
                    <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53</div>
                    <pre><code><span class="token-comment"># Validación personalizada incluida en el modelo anterior</span>
<span class="token-comment">@field_validator('fecha_nacimiento')</span>
<span class="token-keyword">def</span> <span class="token-function">fecha_debe_ser_pasado</span>(cls, v):
    <span class="token-keyword">if</span> v >= date.today():
        <span class="token-keyword">raise</span> <span class="token-exception">ValueError</span>(<span class="token-string">'La fecha debe ser en el pasado'</span>)
    <span class="token-keyword">return</span> v

<span class="token-comment"># Validación de mayoría de edad incluida en el modelo anterior</span>
<span class="token-attribute">@field_validator</span>(<span class="token-string">'edad'</span>)
<span class="token-keyword">def</span> <span class="token-function">validar_mayoria_edad</span>(cls, v):
    <span class="token-keyword">if</span> v < <span class="token-number">18</span>:
        <span class="token-keyword">raise</span> <span class="token-exception">ValueError</span>(<span class="token-string">'Debe tener al menos 18 años'</span>)
    <span class="token-keyword">return</span> v

<span class="token-comment"># Uso del modelo</span>
<span class="token-keyword">from</span> pydantic <span class="token-keyword">import</span> ValidationError

<span class="token-keyword">try</span>:
    estudiante = EstudianteViewModel(
        codigo=<span class="token-string">"A001"</span>,
        nombre=<span class="token-string">"Juan"</span>,
        apellido=<span class="token-string">"Pérez"</span>,
        email=<span class="token-string">"juan.perez@example.com"</span>,
        edad=<span class="token-number">20</span>,
        promedio=<span class="token-number">4.5</span>,
        telefono=<span class="token-string">"3001234567"</span>,
        fecha_nacimiento=date(<span class="token-number">2000</span>, <span class="token-number">5</span>, <span class="token-number">15</span>),
        password=<span class="token-string">"SecurePass123"</span>,
        confirmar_password=<span class="token-string">"SecurePass123"</span>
    )
<span class="token-keyword">except</span> ValidationError <span class="token-keyword">as</span> e:
    <span class="token-keyword">print</span>(e)</code></pre>
                </div>
            </div>

            <h3>Pydantic y FastAPI para Validación de Formularios</h3>
            <p><strong>Pydantic BaseModel</strong> = Clase diseñada específicamente para validación de datos con type hints. En FastAPI, los modelos Pydantic validan automáticamente los datos de entrada.</p>
            <p><strong>Validación Automática</strong> = FastAPI valida los requests automáticamente contra el modelo Pydantic y retorna errores 422 si la validación falla.</p>

            <div class="warning-box">
                <strong>Errores Comunes con Pydantic</strong>
                <ul>
                    <li><strong>No usar field_validator correctamente:</strong> Olvidar validar el tipo de dato o retornar el valor</li>
                    <li><strong>No manejar ValidationError:</strong> Las excepciones de validación deben propagarse correctamente</li>
                    <li><strong>Validar solo en cliente:</strong> Un usuario puede enviar requests directos sin validación en frontend</li>
                </ul>
            </div>

            <h4>Validación en el Controller</h4>
            <div class="code-block">
                <div class="code-header">
                    <div class="code-dots">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <span class="code-title">estudiantes_routes.py</span>
                </div>
                <div class="code-content">
                    <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24</div>
                    <pre><code><span class="token-keyword">from</span> fastapi <span class="token-keyword">import</span> FastAPI, HTTPException
<span class="token-keyword">from</span> pydantic <span class="token-keyword">import</span> BaseModel

app = FastAPI()

<span class="token-attribute">@app.post</span>(<span class="token-string">"/api/estudiantes"</span>, status_code=<span class="token-number">201</span>)
<span class="token-keyword">async def</span> <span class="token-function">crear_estudiante</span>(
    model: EstudianteViewModel,
    estudiante_service: EstudianteService
):
    <span class="token-comment"># Validación automática basada en Pydantic</span>
    <span class="token-comment"># Si hay errores, FastAPI retorna automáticamente 422</span>

    <span class="token-comment"># Validación de negocio adicional</span>
    existe = <span class="token-keyword">await</span> estudiante_service.existe_codigo(model.codigo)
    <span class="token-keyword">if</span> existe:
        <span class="token-keyword">raise</span> HTTPException(
            status_code=<span class="token-number">400</span>,
            detail=<span class="token-string">"Ya existe un estudiante con este código"</span>
        )

    <span class="token-comment"># Guardar</span>
    <span class="token-keyword">await</span> estudiante_service.crear(model)
    <span class="token-keyword">return</span> {<span class="token-string">"mensaje"</span>: <span class="token-string">"Estudiante creado exitosamente"</span>}</code></pre>
                </div>
            </div>
        </section>

        <!-- Validacion Cliente/Servidor -->
        <section id="validacion" class="section">
            <h2>2. Validación Cliente vs Servidor</h2>

            <div class="note-box">
                <strong>¿Por qué Doble Validación?</strong>
                <ul>
                    <li><strong>Experiencia de usuario:</strong> La validación cliente (<abbr title="JavaScript - Lenguaje de programación para interactividad web">JS</abbr>) es instantánea, sin recargar la página</li>
                    <li><strong>Seguridad:</strong> La validación servidor es obligatoria porque JS puede ser desactivado o manipulado</li>
                    <li><strong>Defensa en profundidad:</strong> Dos capas de validación reducen errores y ataques</li>
                </ul>
            </div>

            <h3>Doble validación</h3>
            <div class="note-box">
                <strong>IMPORTANTE:</strong>
                <ul>
                    <li><strong>Validación cliente</strong> = UX mejor (rápida, feedback inmediato)</li>
                    <li><strong>Validación servidor</strong> = Seguridad (obligatoria)</li>
                    <li><strong>Nunca confíe solo en validación cliente</strong> - Puede ser omitida</li>
                </ul>
            </div>

            <h4>Flujo de Validación:</h4>
            <ol>
                <li>Usuario escribe datos en formulario</li>
                <li>JavaScript valida (jQuery Validation) en navegador</li>
                <li>Si es inválido, muestra error <strong>sin enviar al servidor</strong></li>
                <li>Si pasa validación cliente, envía POST</li>
                <li>Servidor valida con ModelState (Data Annotations)</li>
                <li>Si inválido, retorna vista con errores</li>
                <li>Si válido, procesa y guarda</li>
            </ol>

            <h3>jQuery Validation</h3>
            <p><strong><abbr title="jQuery Validation - Plugin de JavaScript para validación de formularios en el cliente">jQuery Validation</abbr></strong> = Plugin que lee los atributos data-val-* generados por ASPPython y valida automáticamente en el navegador.</p>

            <div class="warning-box">
                <strong>Errores Comunes en Validación Cliente</strong>
                <ul>
                    <li><strong>Olvidar incluir los scripts:</strong> La validación cliente simplemente no funciona</li>
                    <li><strong>No renderizar Partial de Scripts:</strong> Olvidar <code>@{await Html.RenderPartialAsync("_ValidationScriptsPartial");}</code></li>
                    <li><strong>Conflictos de jQuery:</strong> Incluir jQuery dos veces o versiones incompatibles</li>
                </ul>
            </div>

            <h4>Configuración en la vista</h4>
            <div class="code-block">
                <div class="code-header">
                    <div class="code-dots">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <span class="code-title">_ValidationScriptsPartial.cshtml</span>
                </div>
                <div class="code-content">
                    <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20</div>
                    <pre><code>&amp;lt;!-- Views/Shared/_ValidationScriptsPartial.cshtml --&amp;gt;
&amp;lt;script src=<span class="token-string">&quot;~/lib/jquery/dist/jquery.min.js&quot;</span>&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;script src=<span class="token-string">&quot;~/lib/jquery-validation/dist/jquery.validate.min.js&quot;</span>&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;script src=<span class="token-string">&quot;~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js&quot;</span>&amp;gt;
&amp;lt;/script&amp;gt;

&amp;lt;!-- En la vista --&amp;gt;
&amp;lt;form asp-action=<span class="token-string">&quot;Crear&quot;</span> method=<span class="token-string">&quot;post&quot;</span>&amp;gt;
    &amp;lt;div class=<span class="token-string">&quot;form-group&quot;</span>&amp;gt;
        &amp;lt;label asp-for=<span class="token-string">&quot;Email&quot;</span>&amp;gt;&amp;lt;/label&amp;gt;
        &amp;lt;input asp-for=<span class="token-string">&quot;Email&quot;</span> class=<span class="token-string">&quot;form-control&quot;</span> /&amp;gt;
        &amp;lt;span asp-validation-for=<span class="token-string">&quot;Email&quot;</span> class=<span class="token-string">&quot;text-danger&quot;</span>&amp;gt;&amp;lt;/span&amp;gt;
    &amp;lt;/div&amp;gt;

    &amp;lt;button type=<span class="token-string">&quot;submit&quot;</span> class=<span class="token-string">&quot;btn btn-primary&quot;</span>&amp;gt;Guardar&amp;lt;/button&amp;gt;
&amp;lt;/form&amp;gt;

@section Scripts {
    @{await Html.RenderPartialAsync(<span class="token-string">&quot;_ValidationScriptsPartial&quot;</span>);}
}</code></pre>
                </div>
            </div>
        </section>

        <!-- TempData/ViewBag -->
        <section id="tempdata" class="section">
            <h2>3. TempData, ViewBag y ViewData</h2>

            <div class="note-box">
                <strong>¿Por qué TempData?</strong>
                <ul>
                    <li><strong>Mensajes flash:</strong> Mostrar "Guardado exitosamente" después de un redirect</li>
                    <li><strong>Preservar input:</strong> Mantener datos del formulario cuando hay errores</li>
                    <li><strong>PRG Pattern:</strong> Evita reenvíos accidentales al recargar la página (Post-Redirect-Get)</li>
                </ul>
            </div>

            <h3>Diferencias clave</h3>
            <p><strong><abbr title="ViewData - Diccionario tipo clave-valor para pasar datos del Controller a la View (válido solo una petición)">ViewData</abbr></strong> = Diccionario para pasar datos Controller→View (una sola petición).</p>
            <p><strong><abbr title="ViewBag - Wrapper dinámico sobre ViewData para pasar datos del Controller a la View">ViewBag</abbr></strong> = Versión dinámica de ViewData (mismo propósito, sintaxis más limpia).</p>
            <p><strong><abbr title="TempData - Diccionario que persiste datos hasta la siguiente petición (útil después de redirects)">TempData</abbr></strong> = Diccionario que sobrevive un redirect (dura hasta la siguiente petición).</p>

            <h4>Formas de pasar datos en MVC</h4>
            <table class="tag-table">
                <thead>
                    <tr>
                        <th>Tipo</th>
                        <th>Alcance</th>
                        <th>Uso</th>
                        <th>Ejemplo</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>ViewData/ViewBag</td>
                        <td>Una sola petición</td>
                        <td>Controller  View</td>
                        <td><code>ViewBag.Mensaje = "Hola"</code></td>
                    </tr>
                    <tr>
                        <td>TempData</td>
                        <td>Hasta siguiente petición</td>
                        <td>Controller  Redirect  Controller/View</td>
                        <td><code>TempData["Mensaje"] = "Guardado"</code></td>
                    </tr>
                    <tr>
                        <td>Sesión</td>
                        <td>Múltiples peticiones del mismo usuario</td>
                        <td>Datos persistentes durante sesión</td>
                        <td><code>Session["UsuarioId"] = 123</code></td>
                    </tr>
                </tbody>
            </table>

            <h3>TempData en Acción</h3>
            <div class="code-block">
                <div class="code-header">
                    <div class="code-dots">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <span class="code-title">estudiantes_routes.py</span>
                </div>
                <div class="code-content">
                    <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32</div>
                    <pre><code>[<span class="token-type">HttpPost</span>]
public async Task&amp;lt;IActionResult&amp;gt; Crear(EstudianteViewModel model)
{
    if (!ModelState.IsValid)
        return View(model);

    await _service.CrearAsync(model);

    <span class="token-comment">// Mensaje que persistirá después del Redirect</span>
    TempData[<span class="token-string">&quot;MensajeExito&quot;</span>] = <span class="token-string">&quot;Estudiante creado exitosamente&quot;</span>;
    TempData[<span class="token-string">&quot;TipoMensaje&quot;</span>] = <span class="token-string">&quot;success&quot;</span>;  <span class="token-comment">// Para Bootstrap alert</span>

    return RedirectToAction(nameof(Index));
}

[<span class="token-type">HttpPost</span>]
public async Task&amp;lt;IActionResult&amp;gt; Eliminar(int id)
{
    try
    {
        await _service.EliminarAsync(id);
        TempData[<span class="token-string">&quot;MensajeExito&quot;</span>] = <span class="token-string">&quot;Estudiante eliminado correctamente&quot;</span>;
        TempData[<span class="token-string">&quot;TipoMensaje&quot;</span>] = <span class="token-string">&quot;success&quot;</span>;
    }
    catch (Exception ex)
    {
        TempData[<span class="token-string">&quot;MensajeError&quot;</span>] = <span class="token-string">&quot;No se pudo eliminar el estudiante&quot;</span>;
        TempData[<span class="token-string">&quot;TipoMensaje&quot;</span>] = <span class="token-string">&quot;danger&quot;</span>;
    }

    return RedirectToAction(nameof(Index));
}</code></pre>
                </div>
            </div>

            <h3>Mostrar Mensajes en la Vista</h3>
            <div class="code-block">
                <div class="code-header">
                    <div class="code-dots">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <span class="code-title">Index.cshtml</span>
                </div>
                <div class="code-content">
                    <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16</div>
                    <pre><code>&amp;lt;!-- Views/Estudiantes/Index.cshtml - Mostrar mensajes --&amp;gt;
@{
    var mensaje = TempData[<span class="token-string">&quot;MensajeExito&quot;</span>] ?? TempData[<span class="token-string">&quot;MensajeError&quot;</span>];
    var tipo = TempData[<span class="token-string">&quot;TipoMensaje&quot;</span>] ?? <span class="token-string">&quot;info&quot;</span>;
}

@if (mensaje != null)
{
    &amp;lt;div class=<span class="token-string">&quot;alert alert-@tipo alert-dismissible fade show&quot;</span> role=<span class="token-string">&quot;alert&quot;</span>&amp;gt;
        @mensaje
        &amp;lt;button type=<span class="token-string">&quot;button&quot;</span> class=<span class="token-string">&quot;btn-close&quot;</span> data-bs-dismiss=<span class="token-string">&quot;alert&quot;</span>&amp;gt;&amp;lt;/button&amp;gt;
    &amp;lt;/div&amp;gt;
}

&amp;lt;!-- O usando Partial View --&amp;gt;
&amp;lt;partial name=<span class="token-string">&quot;_Mensajes&quot;</span> /&amp;gt;</code></pre>
                </div>
            </div>
        </section>

        <!-- Sesiones y Cookies -->
        <section id="sesiones" class="section">
            <h2>4. Sesiones y Cookies</h2>

            <div class="note-box">
                <strong>¿Por qué Sesiones vs Cookies?</strong>
                <ul>
                    <li><strong>Session:</strong> Datos almacenados en servidor (seguro, pero consume memoria)</li>
                    <li><strong>Cookie:</strong> Datos almacenados en navegador del cliente (limitado, pero no consume servidor)</li>
                    <li><strong>Combinación:</strong> Session ID en cookie + datos en sesión = estándar de autenticación web</li>
                </ul>
            </div>

            <h3>Diferencias clave</h3>
            <p><strong><abbr title="Session - Almacenamiento de datos en servidor asociado a un usuario mediante un ID de sesión">Sesión</abbr></strong> = Datos almacenados en el servidor, identificados por un cookie de sesión.</p>
            <p><strong><abbr title="Cookie - Pequeño archivo de texto almacenado en el navegador del usuario">Cookie</abbr></strong> = Datos almacenados en el navegador del cliente, enviados en cada petición.</p>

            <h4>Configuración de sesiones</h4>
            <div class="code-block">
                <div class="code-header">
                    <div class="code-dots">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <span class="code-title">Program.cs</span>
                </div>
                <div class="code-content">
                    <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16</div>
                    <pre><code><span class="token-comment">// Program.cs - Configurar servicio de sesiones</span>

<span class="token-comment">// Agregar servicio de sesiones</span>
builder.Services.AddDistributedMemoryCache();  <span class="token-comment">// Almacenamiento en memoria</span>
builder.Services.AddSession(options =&amp;gt;
{
    options.IdleTimeout = TimeSpan.FromMinutes(30);  <span class="token-comment">// Tiempo de expiración</span>
    options.Cookie.HttpOnly = true;  <span class="token-comment">// Solo accesible por HTTP</span>
    options.Cookie.IsEssential = true;  <span class="token-comment">// Necesaria para GDPR</span>
});

var app = builder.Build();

<span class="token-comment">// Usar sesiones (antes de MapControllers)</span>
app.UseSession();
app.MapControllers();</code></pre>
                </div>
            </div>

            <h3>Usando Sesiones</h3>
            <p><strong><abbr title="GUID - Globally Unique Identifier (Identificador Único Global) de 128 bits">GUID</abbr></strong> = Identificador único de 128 bits (ej: <code>123e4567-e89b-12d3-a456-426614174000</code>).</p>
            <p><strong><abbr title="JSON - JavaScript Object Notation, formato ligero de intercambio de datos">JSON</abbr></strong> = Formato de texto para representar objetos, usado para serializar datos en sesión.</p>

            <div class="code-block">
                <div class="code-header">
                    <div class="code-dots">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <span class="code-title">auth_routes.py</span>
                </div>
                <div class="code-content">
                    <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44</div>
                    <pre><code><span class="token-keyword">from</span> fastapi <span class="token-keyword">import</span> FastAPI, HTTPException, Depends
<span class="token-keyword">from</span> fastapi.security <span class="token-keyword">import</span> OAuth2PasswordBearer
<span class="token-keyword">from</span> datetime <span class="token-keyword">import</span> timedelta, datetime

<span class="token-comment"># Configuración JWT (en producción usar variables de entorno)</span>
SECRET_KEY = <span class="token-string">"tu-clave-secreta-aqui"</span>
ALGORITHM = <span class="token-string">"HS256"</span>
ACCESS_TOKEN_EXPIRE_MINUTES = <span class="token-number">30</span>

oauth2_scheme = OAuth2PasswordBearer(tokenUrl=<span class="token-string">"token"</span>)

<span class="token-keyword">class</span> <span class="token-class">AccountController</span>:
    <span class="token-attribute">@app.post</span>(<span class="token-string">"/api/auth/login"</span>)
    <span class="token-keyword">async def</span> <span class="token-function">login</span>(
        credentials: LoginViewModel,
        auth_service: AuthService
    ):
        <span class="token-comment"># Validar credenciales contra BD</span>
        usuario = <span class="token-keyword">await</span> auth_service.autenticar(credentials.email, credentials.password)

        <span class="token-keyword">if</span> <span class="token-keyword">not</span> usuario:
            <span class="token-keyword">raise</span> HTTPException(
                status_code=<span class="token-number">401</span>,
                detail=<span class="token-string">"Credenciales inválidas"</span>
            )

        <span class="token-comment"># Crear token JWT</span>
        access_token_expires = timedelta(minutes=<span class="token-number">ACCESS_TOKEN_EXPIRE_MINUTES</span>)
        expire = datetime.utcnow() + access_token_expires

        <span class="token-keyword">to_encode</span> = {
            <span class="token-string">"sub"</span>: usuario.email,
            <span class="token-string">"exp"</span>: expire,
            <span class="token-string">"usuario_id"</span>: usuario.id
        }

        token = <span class="token-function">create_access_token</span>(data=<span class="token-keyword">to_encode</span>, secret_key=SECRET_KEY, algorithm=ALGORITHM)

        <span class="token-keyword">return</span> {
            <span class="token-string">"access_token"</span>: token,
            <span class="token-string">"token_type"</span>: <span class="token-string">"bearer"</span>,
            <span class="token-string">"expires_in"</span>: access_token_expires.seconds
        }

<span class="token-attribute">@app.get</span>(<span class="token-string">/api/auth/perfil"</span>)
<span class="token-keyword">async def</span> <span class="token-function">perfil</span>(
    current_user: <span class="token-type">dict</span> = Depends(get_current_user)
):
    <span class="token-comment"># Leer del token JWT</span>
    <span class="token-keyword">return</span> {
        <span class="token-string">"usuario_id"</span>: current_user.get(<span class="token-string">"usuario_id"</span>),
        <span class="token-string">"email"</span>: current_user.get(<span class="token-string">"sub"</span>)
    }

<span class="token-attribute">@app.post</span>(<span class="token-string">/api/auth/logout"</span>)
<span class="token-keyword">async def</span> <span class="token-function">logout</span>():
    <span class="token-comment"># En frontend, eliminar el token</span>
    <span class="token-keyword">return</span> {<span class="token-string">"mensaje"</span>: <span class="token-string">"Sesión cerrada exitosamente"</span>}</code></pre>
                </div>
            </div>

            <h3>Cookies</h3>
            <p>Manipulación directa de cookies con opciones de seguridad:</p>
            <ul>
                <li><strong><abbr title="HttpOnly - Bandera de cookie que previene acceso desde JavaScript">HttpOnly</abbr></strong> = Si es true, la cookie NO es accesible vía JavaScript (protege contra XSS)</li>
                <li><strong><abbr title="SameSite - Atributo de cookie que controla cuándo se envía en solicitudes cross-site">SameSite</abbr></strong> = Controla envío de cookies en peticiones cross-site (previene CSRF)</li>
                <li><strong>Secure</strong> = Si es true, la cookie solo se envía por HTTPS</li>
                <li><strong><abbr title="GDPR - General Data Protection Regulation, reglamento europeo de protección de datos">GDPR</abbr></strong> = Reglamento UE que requiere consentimiento para cookies no esenciales</li>
            </ul>

            <div class="warning-box">
                <strong>Errores Comunes con Cookies</strong>
                <ul>
                    <li><strong>Guardar datos sensibles sin HttpOnly:</strong> Vulnerable a robo via XSS</li>
                    <li><strong>No usar SameSite:</strong> Vulnerable a ataques CSRF</li>
                    <li><strong>Exceder tamaño límite:</strong> Cookies máx 4KB (si necesitas más, usa Session)</li>
                </ul>
            </div>

            <h4>Ejemplo de manipulación</h4>
            <div class="code-block">
                <div class="code-header">
                    <div class="code-dots">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <span class="code-title">PreferenciasController.cs</span>
                </div>
                <div class="code-content">
                    <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32</div>
                    <pre><code>public class PreferenciasController : Controller
{
    <span class="token-comment">// Establecer cookie</span>
    public IActionResult SetTema(string tema)
    {
        <span class="token-comment">// Cookie con opciones de seguridad</span>
        Response.Cookies.Append(<span class="token-string">&quot;Tema&quot;</span>, tema, new CookieOptions
        {
            Expires = DateTime.Now.AddDays(30),  <span class="token-comment">// Expira en 30 días</span>
            HttpOnly = false,  <span class="token-comment">// Accesible por JavaScript (true para datos sensibles)</span>
            Secure = true,     <span class="token-comment">// Solo HTTPS</span>
            SameSite = SameSiteMode.Strict  <span class="token-comment">// Previene CSRF</span>
        });

        return RedirectToAction(<span class="token-string">&quot;Index&quot;</span>);
    }

    <span class="token-comment">// Leer cookie</span>
    public IActionResult Index()
    {
        var tema = Request.Cookies[<span class="token-string">&quot;Tema&quot;</span>] ?? <span class="token-string">&quot;claro&quot;</span>;
        ViewBag.Tema = tema;
        return View();
    }

    <span class="token-comment">// Eliminar cookie</span>
    public IActionResult EliminarTema()
    {
        Response.Cookies.Delete(<span class="token-string">&quot;Tema&quot;</span>);
        return RedirectToAction(<span class="token-string">&quot;Index&quot;</span>);
    }
}</code></pre>
                </div>
            </div>
        </section>

        <!-- Upload de Archivos -->
        <section id="upload" class="section">
            <h2>5. Upload de Archivos</h2>

            <div class="note-box">
                <strong>¿Por qué IFormFile?</strong>
                <ul>
                    <li><strong>Abstracción:</strong> Representa un archivo recibido en una petición HTTP</li>
                    <li><strong>Stream:</strong> Permite leer el archivo sin cargarlo completo en memoria</li>
                    <li><strong>Validación:</strong> Facilita verificar tipo, tamaño y nombre del archivo</li>
                </ul>
            </div>

            <h3><abbr title="IFormFile - Interfaz de ASPPython Core que representa un archivo enviado en una petición HTTP">IFormFile</abbr></h3>
            <p>Interfaz que representa un archivo recibido en una petición HTTP. Propiedades clave:</p>
            <ul>
                <li><code>FileName</code> - Nombre original del archivo</li>
                <li><code>Length</code> - Tamaño en bytes</li>
                <li><code>ContentType</code> - Tipo MIME (ej: "image/jpeg")</li>
            </ul>

            <div class="warning-box">
                <strong>Errores Comunes en Upload</strong>
                <ul>
                    <li><strong>No validar extensión:</strong> Permite subir archivos ejecutables (.exe, .bat)</li>
                    <li><strong>No limitar tamaño:</strong> Puede saturar el servidor</li>
                    <li><strong>Sobrescribir archivos:</strong> <code>Guid.NewGuid()</code> genera nombres únicos para evitar colisiones</li>
                    <li><strong>Olvidar enctype="multipart/form-data":</strong> El formulario NO envía archivos sin este atributo</li>
                </ul>
            </div>

            <h4>Vista con formulario</h4>
            <div class="code-block">
                <div class="code-header">
                    <div class="code-dots">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <span class="code-title">SubirFoto.cshtml</span>
                </div>
                <div class="code-content">
                    <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10</div>
                    <pre><code>&amp;lt;!-- Vista con formulario para subir archivo --&amp;gt;
&amp;lt;form asp-action=<span class="token-string">&quot;SubirFoto&quot;</span> method=<span class="token-string">&quot;post&quot;</span> enctype=<span class="token-string">&quot;multipart/form-data&quot;</span>&amp;gt;
    &amp;lt;div class=<span class="token-string">&quot;mb-3&quot;</span>&amp;gt;
        &amp;lt;label class=<span class="token-string">&quot;form-label&quot;</span>&amp;gt;Foto del Estudiante&amp;lt;/label&amp;gt;
        &amp;lt;input type=<span class="token-string">&quot;file&quot;</span> name=<span class="token-string">&quot;archivo&quot;</span> class=<span class="token-string">&quot;form-control&quot;</span>
               accept=<span class="token-string">&quot;.jpg,.jpeg,.png&quot;</span> /&amp;gt;
        &amp;lt;div class=<span class="token-string">&quot;form-text&quot;</span>&amp;gt;Formatos permitidos: JPG, PNG (máx. 2MB)&amp;lt;/div&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;button type=<span class="token-string">&quot;submit&quot;</span> class=<span class="token-string">&quot;btn btn-primary&quot;</span>&amp;gt;Subir&amp;lt;/button&amp;gt;
&amp;lt;/form&amp;gt;</code></pre>
                </div>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <div class="code-dots">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <span class="code-title">estudiantes_routes.py</span>
                </div>
                <div class="code-content">
                    <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46</div>
                    <pre><code>[<span class="token-type">HttpPost</span>]
public async Task&amp;lt;IActionResult&amp;gt; SubirFoto(IFormFile archivo, int estudianteId)
{
    if (archivo == null || archivo.Length == 0)
    {
        ModelState.AddModelError(<span class="token-string">&quot;&quot;</span>, <span class="token-string">&quot;No se seleccionó ningún archivo&quot;</span>);
        return View();
    }

    <span class="token-comment">// Validaciones</span>
    var extensionesPermitidas = new[] { <span class="token-string">&quot;.jpg&quot;</span>, <span class="token-string">&quot;.jpeg&quot;</span>, <span class="token-string">&quot;.png&quot;</span> };
    var extension = Path.GetExtension(archivo.FileName).ToLowerInvariant();

    if (!extensionesPermitidas.Contains(extension))
    {
        ModelState.AddModelError(<span class="token-string">&quot;&quot;</span>, <span class="token-string">&quot;Formato de archivo no válido&quot;</span>);
        return View();
    }

    if (archivo.Length &amp;gt; 2 * 1024 * 1024)  <span class="token-comment">// 2MB</span>
    {
        ModelState.AddModelError(<span class="token-string">&quot;&quot;</span>, <span class="token-string">&quot;El archivo es demasiado grande (máx. 2MB)&quot;</span>);
        return View();
    }

    <span class="token-comment">// Generar nombre único</span>
    var nombreArchivo = $<span class="token-string">&quot;{estudianteId}_{Guid.NewGuid()}{extension}&quot;</span>;
    var rutaCarpeta = Path.Combine(_environment.WebRootPath, <span class="token-string">&quot;uploads&quot;</span>, <span class="token-string">&quot;fotos&quot;</span>);
    var rutaCompleta = Path.Combine(rutaCarpeta, nombreArchivo);

    <span class="token-comment">// Crear carpeta si no existe</span>
    if (!Directory.Exists(rutaCarpeta))
        Directory.CreateDirectory(rutaCarpeta);

    <span class="token-comment">// Guardar archivo</span>
    using (var stream = new FileStream(rutaCompleta, FileMode.Create))
    {
        await archivo.CopyToAsync(stream);
    }

    <span class="token-comment">// Guardar ruta en base de datos</span>
    await _service.ActualizarFotoAsync(estudianteId, $<span class="token-string">&quot;/uploads/fotos/{nombreArchivo}&quot;</span>);

    TempData[<span class="token-string">&quot;Mensaje&quot;</span>] = <span class="token-string">&quot;Foto subida correctamente&quot;</span>;
    return RedirectToAction(<span class="token-string">&quot;Detalles&quot;</span>, new { id = estudianteId });
}</code></pre>
                </div>
            </div>

            <h3>Subir Varios Archivos</h3>
            <div class="code-block">
                <div class="code-header">
                    <div class="code-dots">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <span class="code-title">SubirDocumentos.cshtml</span>
                </div>
                <div class="code-content">
                    <div class="line-numbers">1<br>2<br>3<br>4</div>
                    <pre><code>&amp;lt;form asp-action=<span class="token-string">&quot;SubirDocumentos&quot;</span> method=<span class="token-string">&quot;post&quot;</span> enctype=<span class="token-string">&quot;multipart/form-data&quot;</span>&amp;gt;
    &amp;lt;input type=<span class="token-string">&quot;file&quot;</span> name=<span class="token-string">&quot;archivos&quot;</span> multiple class=<span class="token-string">&quot;form-control&quot;</span> /&amp;gt;
    &amp;lt;button type=<span class="token-string">&quot;submit&quot;</span> class=<span class="token-string">&quot;btn btn-primary&quot;</span>&amp;gt;Subir Documentos&amp;lt;/button&amp;gt;
&amp;lt;/form&amp;gt;</code></pre>
                </div>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <div class="code-dots">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <span class="code-title">estudiantes_routes.py</span>
                </div>
                <div class="code-content">
                    <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20</div>
                    <pre><code>[<span class="token-type">HttpPost</span>]
public async Task&amp;lt;IActionResult&amp;gt; SubirDocumentos(List&amp;lt;IFormFile&amp;gt; archivos)
{
    foreach (var archivo in archivos)
    {
        if (archivo.Length &amp;gt; 0)
        {
            var nombre = Path.GetFileName(archivo.FileName);
            var ruta = Path.Combine(_environment.WebRootPath, <span class="token-string">&quot;uploads&quot;</span>, nombre);

            using (var stream = new FileStream(ruta, FileMode.Create))
            {
                await archivo.CopyToAsync(stream);
            }
        }
    }

    TempData[<span class="token-string">&quot;Mensaje&quot;</span>] = $<span class="token-string">&quot;{archivos.Count} archivos subidos&quot;</span>;
    return RedirectToAction(<span class="token-string">&quot;Index&quot;</span>);
}</code></pre>
                </div>
            </div>
        </section>

        <!-- CSRF Protection -->
        <section id="csrf" class="section">
            <h2>6. Protección CSRF</h2>

            <div class="note-box">
                <strong>¿Por qué protección CSRF?</strong>
                <ul>
                    <li><strong>Ataque silencioso:</strong> Un sitio malicioso puede enviar peticiones en tu nombre sin que lo sepas</li>
                    <li><strong>Acciones críticas:</strong> Cambio de contraseña, transferencias, eliminación de datos</li>
                    <li><strong>Token único:</strong> El token antiforgery solo es válido para tu sesión y tu formulario</li>
                </ul>
            </div>

            <h3>Seguridad contra ataques</h3>
            <p><strong><abbr title="CSRF - Cross-Site Request Forgery, ataque que engaña al navegador para enviar peticiones no autorizadas">CSRF</abbr> (Cross-Site Request Forgery)</strong> = Ataque donde un sitio malicioso envía un formulario con las credenciales del usuario autenticado a su servidor.</p>

            <div class="warning-box">
                <strong>¿Cómo funciona el ataque CSRF?</strong>
                <ol>
                    <li>Usuario inicia sesión en sitio-banco.com</li>
                    <li>Usuario visita sitio-malicioso.com (todavía con la sesión de banco activa)</li>
                    <li>sitio-malicioso.com tiene un formulario oculto que POST a sitio-banco.com/transferir</li>
                    <li>El navegador envía automáticamente las cookies de sesión del banco</li>
                    <li>El banco procesa la transferencia porque parece legítima</li>
                </ol>
                <p><strong>SOLUCIÓN: Token antiforgery que solo el servidor conoce</strong></p>
            </div>

            <h4>Implementación Automática:</h4>
            <ul>
                <li><code>[ValidateAntiForgeryToken]</code> en Controller</li>
                <li><code>@Html.AntiForgeryToken()</code> en form (genera input oculto con token)</li>
                <li>Token generado automáticamente y válido por sesión</li>
            </ul>

            <h4>Tag Helpers (átomos de HTML en Angular templates)</h4>
            <p><strong><abbr title="Tag Helpers - Característica de Angular templates que permite usar atributos especiales para generar HTML dinámico">Tag Helpers</abbr></strong> = Atributos especiales que se convierten en HTML en el servidor. Ejemplos: <code>asp-action</code>, <code>asp-for</code>, <code>asp-validation-for</code>.</p>

            <h4>Implementación con Tag Helpers</h4>
            <div class="code-block">
                <div class="code-header">
                    <div class="code-dots">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <span class="code-title">CSRF-Example.html</span>
                </div>
                <div class="code-content">
                    <div class="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15</div>
                    <pre><code>&amp;lt;!-- EN FORMULARIO (Tag Helper): --&amp;gt;
&amp;lt;form method=<span class="token-string">&quot;post&quot;</span>&amp;gt;
    @Html.AntiForgeryToken()  &amp;lt;-- Token oculto
    &amp;lt;input name=<span class="token-string">&quot;_codigo&quot;</span> /&amp;gt;
&amp;lt;/form&amp;gt;

&amp;lt;!-- EN AJAX: --&amp;gt;
&amp;lt;!-- AJAX = Asynchronous JavaScript and XML, técnica para actualizar página sin recargar --&amp;gt;
$.ajax({
    url: &#x27;/estudiantes/eliminar&#x27;,
    type: &#x27;POST&#x27;,
    headers: {
        <span class="token-string">&quot;RequestVerificationToken&quot;</span>: $(&#x27;input[name=<span class="token-string">&quot;__RequestVerificationToken&quot;</span>]&#x27;).val()
    }
});</code></pre>
                </div>
            </div>

            <div class="note-box">
                <strong>Mini-Chequeo: CSRF Protection</strong>
                <ul>
                    <li>¿Puedes explicar cómo funciona el ataque CSRF paso a paso?</li>
                    <li>¿Por qué el token antiforgery protege contra este ataque?</li>
                    <li>¿Qué pasa si olvidas poner [ValidateAntiForgeryToken] en una acción POST?</li>
                </ul>
            </div>
        </section>

        <!-- Evaluación 4 -->
        <section class="evaluacion-calificable">
            <h3>📋 Evaluación programada</h3>
            <p><strong>Detalle:</strong> Consultar plataforma del curso para información completa sobre evaluación calificable.</p>
        </section>
        </section>

        <!-- Ejemplos -->
        <section id="ejemplos" class="section">
            <h2>Ejemplos</h2>
            <p>Los ejemplos de código están integrados en las secciones teóricas anteriores. Consulte cada sección para ver ejemplos prácticos de:</p>
            <ul>
                <li>Data Annotations para validación</li>
                <li>Validación en cliente y servidor</li>
                <li>Uso de TempData y ViewBag</li>
                <li>Manejo de sesiones y cookies</li>
                <li>Upload de archivos</li>
                <li>Protección CSRF</li>
            </ul>
        </section>

        <!-- Practica / Laboratorio -->
        <section id="practica" class="section">
            <h2>Práctica / Laboratorio</h2>
            <p><strong>Duración estimada:</strong> 40 minutos</p>
            <p><strong>Objetivo:</strong> Implementar un formulario de registro con validaciones y manejo de TempData para mensajes.</p>

            <h3>Pasos en VS Code / Visual Studio Code</h3>
            <ol>
                <li>Abre VS Code / Visual Studio Code y crea un proyecto <strong>ASPPython Core Web App (Model-View-Controller)</strong></li>
                <li>Crea la clase <code>Models/RegistroViewModel.cs</code> con Data Annotations</li>
                <li>Añade validaciones: [Required], [StringLength], [EmailAddress], [Compare]</li>
                <li>En <code>Controllers/AccountController.cs</code>, crea acciones GET y POST</li>
                <li>Implementa lógica POST con ModelState.IsValid y TempData para mensajes</li>
                <li>En la vista, usa Tag Helpers y añade scripts de validación jQuery</li>
                <li>Prueba validaciones cliente y servidor, verifica mensajes TempData</li>
            </ol>

            <h3>Checklist de verificación</h3>
            <ul>
                <li>El modelo tiene Data Annotations ([Required], [StringLength], etc.)</li>
                <li>Las validaciones funcionan en el navegador (jQuery Validation)</li>
                <li>ModelState.IsValid se valida en el controller</li>
                <li>TempData muestra mensajes después de RedirectToAction</li>
                <li>[ValidateAntiForgeryToken] protege contra CSRF</li>
            </ul>
        </section>
        <!-- Ejercicios -->
        <section id="ejercicios" class="section">
            <h2>Ejercicios Prácticos</h2>

            <h3>Ejercicio 1: Login Completo</h3>
            <p><strong>Duración estimada:</strong> 25 minutos</p>
            <h4>Checklist:</h4>
            <ul>
                <li>Email con validación [EmailAddress]</li>
                <li>Password con [Required] y [MinLength]</li>
                <li>Session.SetInt32/GetString para guardar usuario</li>
                <li>Session.Clear() en logout</li>
            </ul>
            <ul>
                <li>Validación de email</li>
                <li>Validación de clave (mínimo 6 caracteres)</li>
                <li>Manejo de sesión</li>
                <li>Logout</li>
            </ul>

            <h3>Ejercicio 2: Carrito con Session</h3>
            <p><strong>Duración estimada:</strong> 20 minutos</p>
            <h4>Checklist:</h4>
            <ul>
                <li>Session guardar lista de productos</li>
                <li>Session recuperar y mostrar carrito</li>
                <li>Botón vaciar carrito con Session.Clear()</li>
            </ul>
            <ul>
                <li>Agregar productos a session</li>
                <li>Mostrar carrito</li>
                <li>Vaciar carrito</li>
            </ul>

            <h3>Ejercicio Integrador: Sistema de Inscripción</h3>
            <p><strong>Duración estimada:</strong> 45 minutos</p>
            <p>Crear sistema de inscripción de estudiantes con:</p>
            <table class="objectives-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Requisito</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td><strong>ViewModel con validaciones:</strong> Código (requerido, 5-10 caracteres, único), Nombre (requerido, máx. 50), Email (requerido, formato válido), FechaNacimiento (requerido, mayor de 15 años), Carrera (seleccionar de dropdown), Foto (opcional, solo JPG/PNG, máx. 1MB)</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td><strong>Controller:</strong> GET (mostrar formulario), POST (validar, guardar, mostrar mensaje éxito), Validación de código único</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td><strong>Vista:</strong> Formulario Bootstrap estilizado, Validación cliente activada, Vista previa de foto (JS), Mensajes de error específicos por campo</td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td><strong>Sesión:</strong> Guardar último estudiante registrado, Mostrar en barra superior "último registro: [Nombre]"</td>
                    </tr>
                    <tr>
                        <td>5</td>
                        <td><strong>Extra:</strong> Exportar lista a Excel (simulado), Filtrar por carrera (session)</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Referencias -->
        <section id="referencias" class="section">
            <h2>Referencias y Recursos</h2>

            <table class="objectives-table">
                <thead>
                    <tr>
                        <th>Recurso</th>
                        <th>Enlace</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Model Validation</td>
                        <td><a href="https://learn.microsoft.com/en-us/aspnet/core/mvc/models/validation" target="_blank">docs.microsoft.com/aspnet/core/mvc/models/validation</a></td>
                    </tr>
                    <tr>
                        <td>Session State</td>
                        <td><a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/app-state" target="_blank">docs.microsoft.com/aspnet/core/fundamentals/app-state</a></td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Resumen -->
        <section id="resumen" class="section">
            <h2>Resumen de la Clase</h2>
            <table class="objectives-table">
                <thead>
                    <tr>
                        <th>Concepto</th>
                        <th>Descripción</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Data Annotations</strong></td>
                        <td>Atributos para validación de modelos</td>
                    </tr>
                    <tr>
                        <td><strong>ModelState</strong></td>
                        <td>Estado de validación en servidor</td>
                    </tr>
                    <tr>
                        <td><strong>jQuery Validation</strong></td>
                        <td>Validación en cliente</td>
                    </tr>
                    <tr>
                        <td><strong>TempData</strong></td>
                        <td>Datos persistentes hasta siguiente petición</td>
                    </tr>
                    <tr>
                        <td><strong>Session</strong></td>
                        <td>Datos persistentes durante sesión de usuario</td>
                    </tr>
                    <tr>
                        <td><strong>Cookies</strong></td>
                        <td>Almacenamiento en navegador</td>
                    </tr>
                    <tr>
                        <td><strong>IFormFile</strong></td>
                        <td>Manejo de archivos subidos</td>
                    </tr>
                    <tr>
                        <td><strong>Remote Validation</strong></td>
                        <td>Validación AJAX en tiempo real</td>
                    </tr>
                    <tr>
                        <td><strong>CSRF Protection</strong></td>
                        <td>Token antiforgery para seguridad</td>
                    </tr>
                    <tr>
                        <td><strong>Distributed Cache</strong></td>
                        <td>Sesión escalable (Redis, SQL Server)</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Proxima Clase -->
        <section class="section">
            <h2>Próxima Clase: Introducción a ADOPython</h2>
            <table class="objectives-table">
                <thead>
                    <tr>
                        <th>Tema</th>
                        <th>Descripción</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>ADOPython</strong></td>
                        <td>SqlConnection, SqlCommand, SqlDataReader</td>
                    </tr>
                    <tr>
                        <td><strong>CRUD básico</strong></td>
                        <td>Create, Read, Update, Delete con SQL puro</td>
                    </tr>
                    <tr>
                        <td><strong>Parámetros</strong></td>
                        <td>Consultas parametrizadas para evitar SQL Injection</td>
                    </tr>
                    <tr>
                        <td><strong>Transacciones</strong></td>
                        <td>Commit, Rollback</td>
                    </tr>
                </tbody>
            </table>
        </section>
    </main>

    <section id='entrega-git'>
  <h3>Entrega con Git</h3>
  <p>Branch: <code>feature/tema-clase-11</code></p>
  <ul>
    <li>Commits: setup / implementación / pruebas-docs</li>
  </ul>
  <p>Tag: <code>clase-11-v1</code></p>
</section><footer class="footer">
        <p><strong>Unidad 3 completada: 4/4 clases ✅</strong></p>
        <p>UNAULA - Ingeniería Informática - 2026-I</p>
        <p>IF0100 - Lenguaje de Programación Orientada a Objetos II</p>
    </footer>
</body>
</html>


