<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clase 15: Datos desconectados y sincronizaci√≥n - IF0100 POO II</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        header {
            background-color: #1e40af;
            color: white;
            padding: 20px;
            text-align: center;
        }
        nav {
            background-color: #333;
            color: white;
            padding: 10px;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        nav ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
        }
        nav li {
            margin: 0 15px;
        }
        nav a {
            color: white;
            text-decoration: none;
        }
        main {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        section {
            margin-bottom: 40px;
        }
        h1, h2, h3 {
            color: #1e40af;
        }
        figure {
            text-align: center;
            margin: 20px 0;
        }
        figure img {
            max-width: 100%;
            height: auto;
        }
        figcaption {
            font-style: italic;
            color: #666;
        }
        pre {
            background: #1e1e2e;
            color: #cdd6f4;
            padding: 16px;
            border-radius: 12px;
            overflow-x: auto;
            line-height: 1.45;
            font-family: "Cascadia Code", "Consolas", "Monaco", "Courier New", monospace;
            border: 1px solid #313244;
            box-shadow: 0 4px 20px rgba(0,0,0,0.12);
        }
        code {
            font-family: "Cascadia Code", "Consolas", "Monaco", "Courier New", monospace;
            font-size: 0.95rem;
        }
        pre code {
            background: transparent;
            color: inherit;
        }
        p code, li code, td code {
            background: #313244;
            color: #cdd6f4;
            padding: 2px 8px;
            border-radius: 6px;
            font-size: 0.9em;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #1e40af;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .objectives ul {
            list-style-type: disc;
            margin-left: 20px;
        }
        .prerequisites {
            background-color: #e7f3ff;
            padding: 15px;
            border-left: 5px solid #1e40af;
        }
        .note {
            background: #f0f4ff;
            border-left: 4px solid #3b82f6;
            padding: 10px 12px;
            border-radius: 8px;
            color: #52606d;
        }
        /* Syntax highlighting para Python */
        .token-keyword { color: #c792ea; font-weight: 600; }
        .token-type { color: #ffcb6b; }
        .token-string { color: #c3e88d; }
        .token-comment { color: #546e7a; font-style: italic; }
        .token-number { color: #f78c6c; }
        .token-operator { color: #89ddff; }
        /* Accessibility */
        abbr[title] { text-decoration: underline dotted; cursor: help; }
        /* Print styles */
        @media print {
            header, nav, footer { background: white !important; color: black !important; }
            a[href]:after { content: " (" attr(href) ")"; font-size: 0.8em; }
            pre, code { white-space: pre-wrap; }
        }

        /* BLOQUES DE C√ìDIGO MEJORADOS */
        .code-block {
            background: #1e1e2e;
            border-radius: 12px;
            margin: 16px 0;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            border: 1px solid #313244;
        }

        .code-header {
            background: linear-gradient(90deg, #313244 0%, #45475a 100%);
            padding: 10px 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid #45475a;
        }

        .code-dots {
            display: flex;
            gap: 6px;
        }

        .code-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .code-dot.red { background: #f38ba8; }
        .code-dot.yellow { background: #f9e2af; }
        .code-dot.green { background: #a6e3a1; }

        .code-title {
            color: #cdd6f4;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: auto;
            font-family: 'Cascadia Code', Consolas, monospace;
        }

        .code-content {
            display: flex;
            background: #1e1e2e;
        }

        .line-numbers {
            background: #181825;
            color: #6c7086;
            padding: 12px 10px;
            text-align: right;
            font-family: 'Cascadia Code', Consolas, monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            user-select: none;
            border-right: 1px solid #313244;
        }

        .code-block pre {
            background: transparent;
            margin: 0;
            padding: 12px 16px;
            flex: 1;
            overflow-x: auto;
        }

        .code-block pre code {
            color: #cdd6f4;
            font-size: 0.95rem;
            line-height: 1.5;
            display: block;
        }

        /* Syntax highlighting mejorado - Catppuccin Mocha theme */
        .code-block .token-keyword { color: #cba6f7; font-weight: 600; } /* purple */
        .code-block .token-type { color: #f9e2af; } /* yellow */
        .code-block .token-string { color: #a6e3a1; } /* green */
        .code-block .token-comment { color: #6c7086; font-style: italic; } /* gray */
        .code-block .token-number { color: #fab387; } /* peach */
        .code-block .token-operator { color: #89dceb; } /* cyan */
        .code-block .token-method { color: #89b4fa; } /* blue */
        .code-block .token-class { color: #f9e2af; font-weight: 600; }
        .code-block .token-property { color: #b4befe; } /* lavender */
        .code-block .token-namespace { color: #f38ba8; } /* pink */

        /* C√≥digo inline */
        p code, li code {
            background: #313244;
            color: #cdd6f4;
            padding: 2px 8px;
            border-radius: 6px;
            font-size: 0.9em;
            border: 1px solid #45475a;
        }

        /* Tablas de c√≥digo */
        .code-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
            margin: 16px 0;
        }

        .code-comparison .code-block {
            margin: 0;
        }

        .code-label {
            font-size: 0.8rem;
            color: #6c7086;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: #1e40af;
            color: #fff;
            padding: 8px 16px;
            text-decoration: none;
            z-index: 100;
            transition: top 0.3s;
        }
        .skip-link:focus {
            top: 0;
        }
    </style>
</head>
<body>
    <a href="#main" class="skip-link">Saltar al contenido</a>
    <header>
        <h1>IF0100 - Lenguaje de Programaci√≥n OO II</h1>
        <h2>Unidad 5: Arquitectura de Datos Desconectados</h2>
        <h3>Clase 15: Datos desconectados y sincronizaci√≥n</h3>
        <p><strong>Duraci√≥n:</strong> 90 minutos | <strong>Fecha:</strong> 2026-05-18</p>
    </header>

    <nav>
        <ul>
            <li><a href="#teoria">Teor√≠a</a></li>
            <li><a href="#ejemplos">Ejemplos</a></li>
            <li><a href="#practica">Pr√°ctica / Laboratorio</a></li>
            <li><a href="#ejercicios">Ejercicios</a></li>
            <li><a href="#referencias">Referencias</a></li>
        </ul>
    </nav>

    <main id="main">
        <section id="teoria">
        <section id="objetivos">
            <h2>üéØ Objetivos de Aprendizaje</h2>
            <div class="objectives">
                <p>Al finalizar esta clase, el estudiante ser√° capaz de:</p>
                <ul>
                    <li>Comprender el modelo de datos desconectados en Python + Angular</li>
                    <li>Usar DTOs y estado local como cach√© en memoria</li>
                    <li>Implementar sincronizaci√≥n expl√≠cita con el backend</li>
                    <li>Manipular datos offline y resolver conflictos simples</li>
                    <li>Comparar modelo conectado vs desconectado</li>
                </ul>
            </div>
        </section>

        <section id="prerrequisitos">
            <h2>üìã Prerrequisitos</h2>
            <div class="prerequisites">
                <p>Para comprender esta clase, se requiere:</p>
                <ul>
                    <li>Conocimientos b√°sicos de pyodbc y SQL Server</li>
                    <li>Familiaridad con consultas SQL y CRUD</li>
                    <li>Conceptos de POO y DTOs en Python</li>
                    <li>Servicios y estado local en Angular</li>
                </ul>
            </div>
        </section>

        <section id="teoria-content">
            <h2>üìä Teor√≠a: Arquitectura de Datos Desconectados</h2>

            <div class="prerequisites">
                <strong>¬øPor qu√© datos desconectados?</strong>
                <ul>
                    <li><strong>Escalabilidad:</strong> Trabajar sin conexi√≥n constante (offline)</li>
                    <li><strong>Performance:</strong> Operaciones en memoria son m√°s r√°pidas</li>
                    <li><strong>Distribuido:</strong> Ideal para aplicaciones multicapa donde la conexi√≥n es costosa</li>
                    <li><strong>Cache:</strong> Mantener datos en memoria para evitar consultas repetitivas</li>
                </ul>
            </div>

            <h3>¬øQu√© son datos desconectados?</h3>
            <p><strong><abbr title="Datos que se cargan en memoria, se manipulan localmente, y luego se sincronizan con la BD. La conexi√≥n solo se usa para cargar y sincronizar">Datos desconectados</abbr></strong> = Modelo de Python/pyodbc donde los datos se cargan en memoria del cliente, se pueden manipular sin mantener una conexi√≥n activa, y los cambios se sincronizan con la base de datos solo cuando se invoca expl√≠citamente. La conexi√≥n solo se usa para:</p>
            <ul>
                <li>‚¨áÔ∏è Cargar datos (Fill)</li>
                <li>‚¨ÜÔ∏è Sincronizar cambios (Update)</li>
            </ul>
            
            <h4>Ventajas:</h4>
            <ul>
                <li>‚úÖ Menor carga en el servidor de BD</li>
                <li>‚úÖ Trabaja offline (sin conexi√≥n constante)</li>
                <li>‚úÖ Mejor para aplicaciones distribuidas</li>
                <li>‚úÖ M√∫ltiples tablas relacionadas en memoria</li>
                <li>‚úÖ Tracking autom√°tico de cambios</li>
            </ul>
            
            <h4>Desventajas:</h4>
            <ul>
                <li>‚ùå Mayor uso de memoria cliente</li>
                <li>‚ùå Complejidad adicional</li>
                <li>‚ùå Posibles conflictos de concurrencia</li>
                <li>‚ùå No apto para datos de tiempo real</li>
            </ul>

            <h3>Cu√°ndo usar datos desconectados vs conectados</h3>
            <table>
                <tr>
                    <th>Escenario</th>
                    <th>Usa Conectado</th>
                    <th>Usa Desconectado</th>
                </tr>
                <tr>
                    <td>Aplicaci√≥n web</td>
                    <td>‚úÖ (SqlDataReader)</td>
                    <td>‚ùå</td>
                </tr>
                <tr>
                    <td>Aplicaci√≥n desktop</td>
                    <td>‚ö†Ô∏è Depende</td>
                    <td>‚úÖ (DataSet)</td>
                </tr>
                <tr>
                    <td>App m√≥vil</td>
                    <td>‚ùå</td>
                    <td>‚úÖ (DataSet + SQLite)</td>
                </tr>
                <tr>
                    <td>Reportes complejos</td>
                    <td>‚ùå</td>
                    <td>‚úÖ (DataSet)</td>
                </tr>
                <tr>
                    <td>Edici√≥n offline</td>
                    <td>‚ùå</td>
                    <td>‚úÖ (DataSet)</td>
                </tr>
                <tr>
                    <td>Lectura simple</td>
                    <td>‚úÖ (DataReader)</td>
                    <td>‚ùå</td>
                </tr>
            </table>

            <h3>Componentes Principales</h3>
            <figure>
                <img src="../assets/infografias/clase-15-dataset.png" alt="Arquitectura desconectada con DataSet y DataAdapter - Diagrama que muestra DataSet en memoria, DataAdapter como puente, y SQL Server como fuente de datos" onerror="this.onerror=null;this.src='/assets/infografias/clase-15-dataset.png'">
                <figcaption>Figura 1: Arquitectura de datos desconectados - DataSet act√∫a como una base de datos en memoria, mientras DataAdapter sincroniza datos con SQL Server solo durante operaciones Fill() y Update(), permitiendo trabajar offline.</figcaption>
            </figure>
            
            <p><strong>Componentes clave:</strong></p>
            <ul>
                <li><strong><abbr title="Contenedor de datos en memoria que act√∫a como una mini base de datos, puede contener m√∫ltiples DataTables y relaciones entre ellas">DataSet</abbr></strong> = Contenedor de datos en memoria (mini-BD)</li>
                <li><strong><abbr title="Tabla en memoria con filas (DataRow) y columnas (DataColumn), similar a una tabla de base de datos pero residente en RAM">DataTable</abbr></strong> = Tabla con filas y columnas</li>
                <li><strong><abbr title="Fila individual de un DataTable que contiene los datos reales y tiene propiedades como RowState para tracking de cambios">DataRow</abbr></strong> = Fila individual con datos</li>
                <li><strong><abbr title="Definici√≥n de columna en un DataTable que especifica nombre, tipo de dato, restricciones y valores por defecto">DataColumn</abbr></strong> = Definici√≥n de columna</li>
                <li><strong><abbr title="Clase puente que conecta un DataSet con una base de datos, ejecuta comandos SELECT para llenar (Fill) y comandos INSERT/UPDATE/DELETE para sincronizar (Update)">DataAdapter</abbr></strong> = Puente entre DataSet y BD</li>
                <li><strong><abbr title="Objeto que establece una relaci√≥n entre dos DataTables usando columnas clave (similar a FOREIGN KEY en SQL), permitiendo navegar registros relacionados">DataRelation</abbr></strong> = Relaci√≥n entre tablas (FK)</li>
            </ul>

            <h3>DataSet B√°sico</h3>
            <p>Crear DataSet manualmente:</p>
            <pre><code>// 1. Crear DataSet
DataSet dsUniversidad = new DataSet("Universidad");

// 2. Crear DataTable
DataTable dtEstudiantes = new DataTable("Estudiantes");

// 3. Definir columnas
dtEstudiantes.Columns.Add("Id", typeof(int));
dtEstudiantes.Columns.Add("Nombre", typeof(string));
dtEstudiantes.Columns.Add("Apellido", typeof(string));
dtEstudiantes.Columns.Add("Edad", typeof(int));
dtEstudiantes.Columns.Add("Promedio", typeof(decimal));

// Definir clave primaria
dtEstudiantes.PrimaryKey = new DataColumn[] { dtEstudiantes.Columns["Id"] };

// 4. Agregar filas
DataRow fila1 = dtEstudiantes.NewRow();
fila1["Id"] = 1;
fila1["Nombre"] = "Juan";
fila1["Apellido"] = "P√©rez";
fila1["Edad"] = 20;
fila1["Promedio"] = 4.2m;
dtEstudiantes.Rows.Add(fila1);

// M√©todo alternativo (m√°s corto)
dtEstudiantes.Rows.Add(3, "Carlos", "L√≥pez", 19, 3.8m);

// 5. Agregar tabla al DataSet
dsUniversidad.Tables.Add(dtEstudiantes);</code></pre>

            <h3>Operaciones en DataTable</h3>
            <pre><code>// Buscar por clave primaria
DataRow filaEncontrada = dtEstudiantes.Rows.Find(2);

// Filtrar filas
DataRow[] estudiantesDestacados = dtEstudiantes.Select("Promedio >= 4.0");

// Ordenar
DataRow[] ordenados = dtEstudiantes.Select("", "Promedio DESC");

// Actualizar
DataRow filaActualizar = dtEstudiantes.Rows.Find(1);
filaActualizar["Promedio"] = 4.7m;

// Eliminar
DataRow filaEliminar = dtEstudiantes.Rows.Find(3);
filaEliminar.Delete();

// Aceptar o rechazar cambios
dtEstudiantes.AcceptChanges(); // Confirma cambios
// dtEstudiantes.RejectChanges(); // Revierte cambios</code></pre>

            <h3>pyodbc - Puente con la BD</h3>
            <p><strong><abbr title="M√≥dulo Python para conectarse a bases de datos SQL usando ODBC">pyodbc</abbr></strong> = Biblioteca para conectar a bases de datos SQL usando ODBC, facilitando la ejecuci√≥n de consultas y recuperaci√≥n de datos.</p>
            <p>Cargar datos desde BD:</p>
            <pre><code><span class="token-keyword">import</span> pyodbc
<span class="token-keyword">from</span> dataclasses <span class="token-keyword">import</span> dataclass, asdict
<span class="token-keyword">from</span> typing <span class="token-keyword">import</span> List

<span class="token-keyword">@dataclass</span>
<span class="token-keyword">class</span> <span class="token-type">Estudiante</span>:
    id: <span class="token-type">int</span>
    nombre: <span class="token-type">str</span>
    apellido: <span class="token-type">str</span>
    cedula: <span class="token-type">str</span>
    email: <span class="token-type">str</span>

<span class="token-keyword">class</span> <span class="token-type">EstudianteRepository</span>:
    <span class="token-keyword">def</span> <span class="token-method">__init__</span>(<span class="token-keyword">self</span>):
        <span class="token-keyword">self</span>.connection_string = (
            <span class="token-string">"DRIVER={ODBC Driver 17 for SQL Server};"</span>
            <span class="token-string">"Server=localhost;"</span>
            <span class="token-string">"Database=Universidad;"</span>
            <span class="token-string">"Trusted_Connection=yes;"</span>
        )

    <span class="token-keyword">def</span> <span class="token-method">cargar_estudiantes</span>(<span class="token-keyword">self</span>) -> List[<span class="token-type">Estudiante</span>]:
        query = <span class="token-string">"SELECT Id, Nombre, Apellido, Cedula, Email FROM Estudiantes"</span>

        <span class="token-keyword">with</span> pyodbc.connect(<span class="token-keyword">self</span>.connection_string) <span class="token-keyword">as</span> conn:
            cursor = conn.cursor()
            cursor.execute(query)

            estudiantes = []
            <span class="token-keyword">for</span> row <span class="token-keyword">in</span> cursor:
                est = Estudiante(
                    id=row.Id,
                    nombre=row.Nombre,
                    apellido=row.Apellido,
                    cedula=row.Cedula,
                    email=row.Email
                )
                estudiantes.append(est)

            <span class="token-keyword">return</span> estudiantes
</code></pre>

            <p>Sincronizar cambios con BD (Update/Insert/Delete):</p>
            <p><strong><abbr title="En Python, usamos par√°metros y consultas SQL expl√≠citas para INSERT, UPDATE, DELETE">SQL con Par√°metros</abbr></strong> = Consultas SQL con par√°metros para prevenir SQL injection y ejecutar operaciones CRUD.</p>
            <pre><code><span class="token-keyword">def</span> <span class="token-method">guardar_cambios</span>(<span class="token-keyword">self</span>, estudiantes: List[<span class="token-type">Estudiante</span>]) -> <span class="token-type">int</span>:
    filas_afectadas = 0

    <span class="token-keyword">with</span> pyodbc.connect(<span class="token-keyword">self</span>.connection_string) <span class="token-keyword">as</span> conn:
        cursor = conn.cursor()

        <span class="token-keyword">for</span> est <span class="token-keyword">in</span> estudiantes:
            <span class="token-keyword">if</span> est.id:  <span class="token-comment"># UPDATE para existentes</span>
                query = <span class="token-string">"""UPDATE Estudiantes
                          SET Nombre=?, Apellido=?, Cedula=?, Email=?
                          WHERE Id=?"</span>
                cursor.execute(query, est.nombre, est.apellido,
                              est.cedula, est.email, est.id)
            <span class="token-keyword">else</span>:  <span class="token-comment"># INSERT para nuevos</span>
                query = <span class="token-string">"""INSERT INTO Estudiantes (Nombre, Apellido, Cedula, Email)
                          VALUES (?, ?, ?, ?)"</span>
                cursor.execute(query, est.nombre, est.apellido,
                              est.cedula, est.email)

            filas_afectadas += cursor.rowcount

        conn.commit()

    <span class="token-keyword">return</span> filas_afectadas
</code></pre>

            <div class="prerequisites" style="background-color: #fff3cd; border-left-color: #ffc107;">
                <strong>Errores Comunes con pyodbc</strong>
                <ul>
                    <li><strong>No usar par√°metros (?):</strong> Siempre usar par√°metros para prevenir SQL injection</li>
                    <li><strong>Olvidar commit():</strong> Los cambios no se persisten hasta llamar conn.commit()</li>
                    <li><strong>Consultas complejas:</strong> Para JOINs o GROUP BY, considerar SQLAlchemy ORM</li>
                    <li><strong>Cerrar conexi√≥n:</strong> Usar 'with' para asegurar que la conexi√≥n se cierre correctamente</li>
                </ul>
            </div>

            <h3>Tracking de Cambios con Dataclasses</h3>
            <p><strong><abbr title="En Python, usamos dataclasses con __post_init__ y atributos para tracking de estado de objetos">Estado de Objetos</abbr></strong> = Propiedad que indica el estado de cada objeto para tracking de cambios:</p>
            <ul>
                <li><strong>Objeto sin cambios:</strong> Datos originales de la BD</li>
                <li><strong>Objeto nuevo (id=None):</strong> Pendiente de INSERT</li>
                <li><strong>Objeto modificado:</strong> Pendiente de UPDATE</li>
                <li><strong>Objeto marcado para borrar:</strong> Pendiente de DELETE</li>
            </ul>

            <p><strong>Commit:</strong> Confirma cambios pendientes envi√°ndolos a la BD.</p>
            <p><strong>Rollback:</strong> Revierte cambios pendientes, recargando desde la BD.</p>

            <h3>Cargar M√∫ltiples Tablas con pyodbc</h3>
            <pre><code><span class="token-keyword">def</span> <span class="token-method">cargar_universidad_completa</span>(<span class="token-keyword">self</span>) -> dict:
    universidad = {
        <span class="token-string">"estudiantes"</span>: [],
        <span class="token-string">"cursos"</span>: [],
        <span class="token-string">"matriculas"</span>: []
    }

    <span class="token-keyword">with</span> pyodbc.connect(<span class="token-keyword">self</span>.connection_string) <span class="token-keyword">as</span> conn:
        cursor = conn.cursor()

        <span class="token-comment"># Cargar Estudiantes</span>
        cursor.execute(<span class="token-string">"SELECT * FROM Estudiantes"</span>)
        <span class="token-keyword">for</span> row <span class="token-keyword">in</span> cursor:
            universidad[<span class="token-string">"estudiantes"</span>].append({
                <span class="token-string">"id"</span>: row.Id,
                <span class="token-string">"nombre"</span>: row.Nombre,
                <span class="token-string">"apellido"</span>: row.Apellido,
                <span class="token-string">"cedula"</span>: row.Cedula,
                <span class="token-string">"email"</span>: row.Email
            })

        <span class="token-comment"># Cargar Cursos</span>
        cursor.execute(<span class="token-string">"SELECT * FROM Cursos"</span>)
        <span class="token-keyword">for</span> row <span class="token-keyword">in</span> cursor:
            universidad[<span class="token-string">"cursos"</span>].append({
                <span class="token-string">"id"</span>: row.Id,
                <span class="token-string">"nombre"</span>: row.Nombre,
                <span class="token-string">"creditos"</span>: row.Creditos
            })

        <span class="token-comment"># Cargar Matr√≠culas (con JOIN para obtener nombres)</span>
        cursor.execute(<span class="token-string">"""
            SELECT m.Id, m.EstudianteId, m.CursoId,
                   e.Nombre as EstudianteNombre,
                   c.Nombre as CursoNombre
            FROM Matriculas m
            JOIN Estudiantes e ON m.EstudianteId = e.Id
            JOIN Cursos c ON m.CursoId = c.Id
        """</span>)
        <span class="token-keyword">for</span> row <span class="token-keyword">in</span> cursor:
            universidad[<span class="token-string">"matriculas"</span>].append({
                <span class="token-string">"id"</span>: row.Id,
                <span class="token-string">"estudiante_id"</span>: row.EstudianteId,
                <span class="token-string">"curso_id"</span>: row.CursoId,
                <span class="token-string">"estudiante_nombre"</span>: row.EstudianteNombre,
                <span class="token-string">"curso_nombre"</span>: row.CursoNombre
            })

    <span class="token-keyword">return</span> universidad
</code></pre>

            <h3>Comparaci√≥n: Conectado vs Desconectado</h3>
            <table>
                <tr>
                    <th>Aspecto</th>
                    <th>Conectado (Cursor)</th>
                    <th>Desconectado (Listas/Dicts)</th>
                </tr>
                <tr>
                    <td>Conexi√≥n</td>
                    <td>Abierta todo el tiempo</td>
                    <td>Solo para Fill/Update</td>
                </tr>
                <tr>
                    <td>Memoria</td>
                    <td>Bajo consumo</td>
                    <td>Alto consumo</td>
                </tr>
                <tr>
                    <td>Navegaci√≥n</td>
                    <td>Solo hacia adelante</td>
                    <td>Bidireccional, aleatoria</td>
                </tr>
                <tr>
                    <td>Modificaci√≥n</td>
                    <td>No permite</td>
                    <td>Permite CRUD local</td>
                </tr>
                <tr>
                    <td>Relaciones</td>
                    <td>No soporta</td>
                    <td>Soporta DataRelation</td>
                </tr>
                <tr>
                    <td>Tracking cambios</td>
                    <td>No</td>
                    <td>S√≠ (RowState)</td>
                </tr>
                <tr>
                    <td>Offline</td>
                    <td>No funciona</td>
                    <td>Funciona</td>
                </tr>
            </table>

            <div class="prerequisites" style="background-color: #d4edda; border-left-color: #28a745;">
                <strong>Mini-Chequeo: Datos Desconectados</strong>
                <ul>
                    <li>¬øCu√°ndo usar estado local vs consulta directa?</li>
                    <li>¬øQu√© validaciones haces antes de sincronizar cambios?</li>
                    <li>¬øQu√© hace "confirmar cambios" vs "revertir cambios"?</li>
                    <li>¬øC√≥mo mantienes relaciones entre colecciones locales?</li>
                </ul>
            </div>
        </section>
        </section>

        <section id="ejemplos">
            <h2>üíª Ejemplos Pr√°cticos</h2>
            
            <h3>Ejemplo completo de uso</h3>
            <pre><code>from dataclasses import dataclass

@dataclass
class EstudianteDTO:
    id: int
    nombre: str
    apellido: str
    cedula: str
    email: str

# Estado local (equivalente a DataSet)
estado_local = repo.cargar_estudiantes()
print(f"Cargados: {len(estado_local)} estudiantes\n")

# Insertar nuevo estudiante
estado_local.append(EstudianteDTO(0, "Ana", "Mart√≠nez", "1234567890", "ana@unaula.edu.co"))

# Actualizar estudiante existente
for e in estado_local:
    if e.id == 1:
        e.email = "nuevo_email@unaula.edu.co"

# Eliminar estudiante (marcar para borrar)
estado_local = [e for e in estado_local if e.id != 5]

# Sincronizar cambios con BD
afectadas = repo.sincronizar(estado_local)
print(f"\nTotal cambios guardados: {afectadas}")</code></pre>

            <h3>Comandos personalizados</h3>
            <pre><code>import pyodbc

def crear_repositorio(conn_str: str):
    def insertar(estudiante):
        query = "INSERT INTO Estudiantes (Nombre, Apellido, Email) VALUES (?, ?, ?)"
        with pyodbc.connect(conn_str) as conn:
            conn.execute(query, (estudiante.nombre, estudiante.apellido, estudiante.email))
            conn.commit()

    def actualizar(estudiante):
        query = "UPDATE Estudiantes SET Nombre = ?, Apellido = ?, Email = ? WHERE Id = ?"
        with pyodbc.connect(conn_str) as conn:
            conn.execute(query, (estudiante.nombre, estudiante.apellido, estudiante.email, estudiante.id))
            conn.commit()

    def eliminar(estudiante_id: int):
        query = "DELETE FROM Estudiantes WHERE Id = ?"
        with pyodbc.connect(conn_str) as conn:
            conn.execute(query, (estudiante_id,))
            conn.commit()

    return insertar, actualizar, eliminar</code></pre>
        </section>

        <section id="practica" class="actividad">
            <h3>Actividad: Sistema de Gesti√≥n de Inventario</h3>
            <p><strong>Tipo:</strong> Opcional / pr√°ctica</p>
            <p><strong>Relacionado con:</strong> Ninguno</p>
            <p><strong>Entregable:</strong> Sistema de inventario con estado local y sincronizaci√≥n</p>
            <p><strong>Tiempo estimado:</strong> 45 min</p>
            <p><strong>Criterios de √©xito:</strong> Comprensi√≥n de datos desconectados y sync</p>
            <h2>üõ†Ô∏è Pr√°ctica: Sistema de Gesti√≥n de Inventario</h2>
            
            <h3>Tablas requeridas</h3>
            <pre><code>CREATE TABLE Productos (
    Id INT PRIMARY KEY IDENTITY(1,1),
    Nombre NVARCHAR(100) NOT NULL,
    Precio DECIMAL(10,2) NOT NULL,
    Stock INT NOT NULL
);

CREATE TABLE Movimientos (
    Id INT PRIMARY KEY IDENTITY(1,1),
    ProductoId INT FOREIGN KEY REFERENCES Productos(Id),
    Tipo NVARCHAR(10) NOT NULL, -- 'Entrada' o 'Salida'
    Cantidad INT NOT NULL,
    Fecha DATETIME DEFAULT GETDATE()
);</code></pre>

            <h3>Requisitos funcionales</h3>
            <ul>
                <li>Cargar datos al iniciar (GET de ambas tablas)</li>
                <li>Men√∫ interactivo con opciones CRUD</li>
                <li>Validaciones de negocio</li>
                <li>Marcar cambios locales (added/modified/deleted)</li>
                <li>Opci√≥n para deshacer cambios</li>
                <li>Sincronizar cambios con backend</li>
            </ul>

            <h3>Caracter√≠sticas avanzadas</h3>
            <ul>
                <li>Exportar inventario a XML</li>
                <li>Reporte de productos con bajo stock</li>
                <li>Calcular valor total del inventario</li>
            </ul>
        </section>

        <section id="ejercicios" class="actividad">
            <h3>Actividad: Ejercicios de Arquitectura Desconectada</h3>
            <p><strong>Tipo:</strong> Opcional / pr√°ctica</p>
            <p><strong>Relacionado con:</strong> Ninguno</p>
            <p><strong>Entregable:</strong> Sistema de inventario completo en parejas</p>
            <p><strong>Tiempo estimado:</strong> 60 min</p>
            <p><strong>Criterios de √©xito:</strong> Integraci√≥n de todos los conceptos de datos desconectados</p>
            <h2>üìù Ejercicios</h2>
            
            <h3>Ejercicio para Casa (En Parejas)</h3>
            <p><strong>Sistema de Gesti√≥n de Inventario Desconectado</strong></p>
            
            <p>Crear una aplicaci√≥n de consola que use estado local y sincronizaci√≥n para gestionar un inventario.</p>
            
            <h4>Entrega:</h4>
            <ul>
                <li>C√≥digo fuente completo</li>
                <li>Script SQL para crear tablas</li>
                <li>Video de 5 min demostrando funcionamiento</li>
                <li>Sustentaci√≥n en parejas</li>
            </ul>
        </section>

        <section id="referencias">
            <h2>üìö Recursos Adicionales</h2>
            
            <h3>Documentaci√≥n oficial</h3>
            <ul>
                <li><a href="https://fastapi.tiangolo.com/" target="_blank">FastAPI - Python Docs</a></li>
                <li><a href="https://docs.python.org/3/library/dataclasses.html" target="_blank">dataclasses - Python Docs</a></li>
                <li><a href="https://angular.io/guide/signals" target="_blank">Angular Signals</a></li>
            </ul>
        </section>
    </main>

    <section id="equivalencia-ado-net">
        <h3>Equivalencia ADO.NET / Datos desconectados</h3>
        <ul>
            <li>Repositorios/servicios que serializan DTOs a JSON.</li>
            <li>Estado local (cach√©) en frontend y sincronizaci√≥n (offline-first / sync) con el servidor.</li>
            <li>Ejemplo: repositorios Python con pyodbc + Angular cache + endpoints REST.</li>
        </ul>
    </section>
    <section id="entrega-git">
        <h3>Entrega con Git</h3>
        <pre><code>git checkout -b feature/datos-desconectados-clase-15
git add src/ api/
git commit -m "chore: estructura inicial datos desconectados"
git commit -m "feat: estado local y sincronizacion"
git commit -m "docs: ejercicios y notas de equivalencia"
git tag -a clase-15-v1 -m "Entrega clase 15 - datos desconectados"</code></pre>
    </section>
    <footer style="background:#1e293b;color:#fff;text-align:center;padding:24px;margin-top:40px;">
        <p><strong>IF0100 - Lenguaje de Programaci√≥n OO II</strong></p>
        <p>UNAULA - Ingenier√≠a Inform√°tica - 2026-I</p>
    </footer>
</body>
</html>
