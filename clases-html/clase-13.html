<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Clase 13 - CRUD con Python, pyodbc y SQL Server | IF0100 - POO II</title>
  <style>
    :root {
      --bg: #f7f7f4;
      --ink: #1f2933;
      --muted: #52606d;
      --brand: #1e3a8a;
      --accent: #3b82f6;
      --card: #ffffff;
      --line: #d9e2ec;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "IBM Plex Sans", "Segoe UI", Tahoma, sans-serif;
      color: var(--ink);
      background: var(--bg);
      line-height: 1.65;
    }
    header {
      background: linear-gradient(135deg, #0b2d6b, #1e40af);
      color: #fff;
      padding: 36px 20px 28px;
    }
    header .wrap { max-width: 1100px; margin: 0 auto; }
    header h1 {
      font-family: "Merriweather", Georgia, serif;
      margin: 8px 0 10px;
      font-size: 2.2rem;
    }
    header .meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 16px;
      margin-top: 18px;
      background: rgba(255, 255, 255, 0.12);
      padding: 16px;
      border-radius: 12px;
    }
    header ul { margin: 8px 0 0 18px; }
    nav {
      max-width: 1100px;
      margin: 18px auto 0;
      padding: 14px 18px;
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 12px;
    }
    nav ul {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 8px 14px;
    }
    nav a {
      color: var(--brand);
      text-decoration: none;
      padding: 8px 10px;
      border-radius: 8px;
      background: #eef2ff;
      display: block;
    }
    nav a:hover { background: #dbeafe; }
    main { max-width: 1100px; margin: 18px auto 60px; padding: 0 20px; }
    section {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 22px;
      margin: 18px 0;
    }
    h2 { margin-top: 0; color: var(--brand); font-size: 1.6rem; border-bottom: 3px solid var(--accent); padding-bottom: 6px; }
    h3 { color: #0b2d6b; margin-top: 20px; }
    h4 { color: #2f4b7c; margin-top: 16px; }
    .grid-2 {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 16px;
      align-items: start;
    }
    .note {
      background: #f0f4ff;
      border-left: 4px solid var(--accent);
      padding: 10px 12px;
      border-radius: 8px;
      color: var(--muted);
    }
    pre {
      background: #1e1e2e;
      color: #cdd6f4;
      padding: 14px 16px;
      border-radius: 12px;
      overflow-x: auto;
      border: 1px solid #313244;
      box-shadow: 0 4px 20px rgba(0,0,0,0.12);
    }
    code { font-family: "Cascadia Code", Consolas, monospace; font-size: 0.95rem; }
    table { width: 100%; border-collapse: collapse; margin: 10px 0; }
    th, td { border: 1px solid var(--line); padding: 8px 10px; text-align: left; }
    th { background: #f1f5f9; }
    /* Syntax highlighting para Python */
    .token-keyword { color: #c792ea; font-weight: 600; }
    .token-type { color: #ffcb6b; }
    .token-string { color: #c3e88d; }
    .token-comment { color: #546e7a; font-style: italic; }
    .token-number { color: #f78c6c; }
    .token-operator { color: #89ddff; }
    /* Accessibility */
    abbr[title] { text-decoration: underline dotted; cursor: help; }
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: var(--brand);
      color: #fff;
      padding: 8px 16px;
      text-decoration: none;
      z-index: 100;
      transition: top 0.3s;
    }
    .skip-link:focus {
      top: 0;
    }
    /* Print styles */
    @media print {
      header, nav, footer { background: white !important; color: black !important; }
      a[href]:after { content: " (" attr(href) ")"; font-size: 0.8em; }
      pre, code { white-space: pre-wrap; }
    }

    /* BLOQUES DE CÃ“DIGO MEJORADOS */
    .code-block {
      background: #1e1e2e;
      border-radius: 12px;
      margin: 16px 0;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      border: 1px solid #313244;
    }

    .code-header {
      background: linear-gradient(90deg, #313244 0%, #45475a 100%);
      padding: 10px 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      border-bottom: 1px solid #45475a;
    }

    .code-dots {
      display: flex;
      gap: 6px;
    }

    .code-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    .code-dot.red { background: #f38ba8; }
    .code-dot.yellow { background: #f9e2af; }
    .code-dot.green { background: #a6e3a1; }

    .code-title {
      color: #cdd6f4;
      font-size: 0.85rem;
      font-weight: 600;
      margin-left: auto;
      font-family: 'Cascadia Code', Consolas, monospace;
    }

    .code-content {
      display: flex;
      background: #1e1e2e;
    }

    .line-numbers {
      background: #181825;
      color: #6c7086;
      padding: 12px 10px;
      text-align: right;
      font-family: 'Cascadia Code', Consolas, monospace;
      font-size: 0.9rem;
      line-height: 1.5;
      user-select: none;
      border-right: 1px solid #313244;
    }

    .code-block pre {
      background: transparent;
      margin: 0;
      padding: 12px 16px;
      flex: 1;
      overflow-x: auto;
    }

    .code-block pre code {
      color: #cdd6f4;
      font-size: 0.95rem;
      line-height: 1.5;
      display: block;
    }

    /* Syntax highlighting mejorado - Catppuccin Mocha theme */
    .code-block .token-keyword { color: #cba6f7; font-weight: 600; } /* purple */
    .code-block .token-type { color: #f9e2af; } /* yellow */
    .code-block .token-string { color: #a6e3a1; } /* green */
    .code-block .token-comment { color: #6c7086; font-style: italic; } /* gray */
    .code-block .token-number { color: #fab387; } /* peach */
    .code-block .token-operator { color: #89dceb; } /* cyan */
    .code-block .token-method { color: #89b4fa; } /* blue */
    .code-block .token-class { color: #f9e2af; font-weight: 600; }
    .code-block .token-property { color: #b4befe; } /* lavender */
    .code-block .token-namespace { color: #f38ba8; } /* pink */

    /* CÃ³digo inline */
    p code, li code {
      background: #313244;
      color: #cdd6f4;
      padding: 2px 8px;
      border-radius: 6px;
      font-size: 0.9em;
      border: 1px solid #45475a;
    }

    /* Tablas de cÃ³digo */
    .code-comparison {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 16px;
      margin: 16px 0;
    }

    .code-comparison .code-block {
      margin: 0;
    }

    .code-label {
      font-size: 0.8rem;
      color: #6c7086;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 6px;
    }
    </style>
</head>
<body>
  <a href="#main" class="skip-link">Saltar al contenido</a>
  <header>
    <div class="wrap">
      <div>IF0100 - Lenguaje de ProgramaciÃ³n OO II | Unidad 4</div>
      <h1>Clase 13: CRUD con Python, pyodbc y SQL Server</h1>
      <div>DuraciÃ³n: 90 minutos</div>
      <div class="meta">
        <div>
          <strong>Objetivos</strong>
          <ul>
            <li>Implementar CRUD completo con Python y pyodbc.</li>
            <li>Modelar base de datos y entidad Python (dataclass/DTO).</li>
            <li>Aplicar validaciones y parÃ¡metros seguros.</li>
            <li>Implementar paginaciÃ³n y operaciones masivas.</li>
            <li>Escribir consultas avanzadas con SQL.</li>
          </ul>
        </div>
        <div>
          <strong>Prerrequisitos</strong>
          <ul>
            <li>Conocer pyodbc, conexiones y cursores.</li>
            <li>SQL Server instalado o acceso a instancia.</li>
            <li>Conceptos bÃ¡sicos de POO y capas.</li>
          </ul>
        </div>
      </div>
    </div>
  </header>

  <nav>
    <ul>
      <li><a href="#teorÃ­a">TeorÃ­a</a></li>
      <li><a href="#ejemplos">Ejemplos</a></li>
      <li><a href="#practica">PrÃ¡ctica / Laboratorio</a></li>
      <li><a href="#ejercicios">Ejercicios</a></li>
      <li><a href="#referencias">Referencias</a></li>
    </ul>
  </nav>

  <main id="main">
    <section id="teorÃ­a">
      <h2>TeorÃ­a</h2>

      <h3>Arquitectura por capas</h3>
      <p><strong>Arquitectura por capas</strong> = Separar el cÃ³digo en niveles con responsabilidades distintas. Cada capa solo interactÃºa con la capa inmediatamente inferior/superior.</p>
      <div class="note">
        <strong>Â¿Por quÃ© arquitectura por capas?</strong>
        <ul>
          <li><strong>Mantenibilidad:</strong> Cambios en UI no afectan lÃ³gica de datos</li>
          <li><strong>ReutilizaciÃ³n:</strong> La lÃ³gica de negocio puede usarse desde Console, Web o API</li>
          <li><strong>Testing:</strong> Cada capa se puede probar independientemente</li>
        </ul>
      </div>
      <pre><code>PresentaciÃ³n (Console/WinForms)
   â†“
LÃ³gica de negocio (validaciones)
   â†“
Acceso a datos (Python + pyodbc)
   â†“
SQL Server (tabla Estudiantes)</code></pre>

      <h3>Modelo de base de datos</h3>
      <p><strong><abbr title="IDENTITY(1,1) - Columna auto-incremental que empieza en 1 y aumenta de 1 en 1">IDENTITY(1,1)</abbr></strong> = ConfiguraciÃ³n para que SQL Server genere automÃ¡ticamente valores Ãºnicos consecutivos.</p>
      <p><strong><abbr title="NVARCHAR - Tipo de dato SQL para texto Unicode (admite caracteres especiales)">NVARCHAR</abbr></strong> = Tipo de dato para texto en SQL Server que soporta caracteres Unicode (emojis, acentos, caracteres internacionales).</p>
      <p><strong><abbr title="UNIQUE - RestricciÃ³n que impide valores duplicados en una columna">UNIQUE</abbr></strong> = RestricciÃ³n que garantiza que no haya valores duplicados en una columna (ej: dos estudiantes con mismo cÃ³digo).</p>
      <p><strong><abbr title="CHECK - RestricciÃ³n que valida que un valor cumpla una condiciÃ³n">CHECK constraint</abbr></strong> = Regla de validaciÃ³n a nivel base de datos (ej: promedio debe estar entre 0 y 5).</p>
      <p><strong><abbr title="BIT - Tipo de dato SQL para valores booleanos (0 o 1)">BIT</abbr></strong> = Tipo de dato booleano en SQL Server (0 = false, 1 = true).</p>
      <p><strong><abbr title="GETDATE() - FunciÃ³n de SQL Server que retorna la fecha y hora actual">GETDATE()</abbr></strong> = FunciÃ³n que retorna la fecha y hora actual del servidor.</p>
      <pre><code class="language-sql">CREATE TABLE Estudiantes (
  Id INT PRIMARY KEY IDENTITY(1,1),
  Codigo NVARCHAR(20) NOT NULL UNIQUE,
  Nombre NVARCHAR(100) NOT NULL,
  Apellido NVARCHAR(100) NOT NULL,
  Email NVARCHAR(100) NOT NULL,
  FechaNacimiento DATE,
  Promedio DECIMAL(3,2) CHECK (Promedio BETWEEN 0 AND 5),
  Activo BIT DEFAULT 1,
  FechaCreaciÃ³n DATETIME DEFAULT GETDATE()
);</code></pre>

      <h3>Entidad Python (dataclass)</h3>
      <p><strong>@property</strong> = Decorador de Python para exponer propiedades calculadas (solo lectura) a partir de otros atributos.</p>
      <pre><code class="language-python"><span class="token-keyword">from</span> dataclasses <span class="token-keyword">import</span> dataclass
<span class="token-keyword">from</span> datetime <span class="token-keyword">import</span> datetime, date

<span class="token-keyword">@dataclass</span>
<span class="token-keyword">class</span> <span class="token-class">Estudiante</span>:
    id: int = <span class="token-keyword">None</span>
    codigo: str = <span class="token-string">""</span>
    nombre: str = <span class="token-string">""</span>
    apellido: str = <span class="token-string">""</span>
    email: str = <span class="token-string">""</span>
    fecha_nacimiento: date = <span class="token-keyword">None</span>
    promedio: float = <span class="token-number">0.0</span>
    activo: bool = <span class="token-keyword">True</span>
    fecha_creacion: datetime = <span class="token-keyword">None</span>

    <span class="token-keyword">@property</span>
    <span class="token-keyword">def</span> <span class="token-method">nombre_completo</span>(<span class="token-property">self</span>) -> str:
        <span class="token-keyword">return</span> <span class="token-string">f"{self.nombre} {self.apellido}"</span>

    <span class="token-keyword">@property</span>
    <span class="token-keyword">def</span> <span class="token-method">edad</span>(<span class="token-property">self</span>) -> int:
        <span class="token-keyword">return</span> date.today().year - <span class="token-property">self</span>.fecha_nacimiento.year</code></pre>

      <h3>Seguridad bÃ¡sica</h3>
      <ul>
        <li>Usar parÃ¡metros SQL para evitar inyecciÃ³n.</li>
        <li>Manejar excepciones de clave Ãºnica (cÃ³digo duplicado).</li>
        <li>Validar datos antes de persistir.</li>
      </ul>
    </section>

    <section id="ejemplos">
      <h2>Ejemplos</h2>

      <h3>CREATE con pyodbc</h3>
      <pre><code class="language-python"><span class="token-keyword">import</span> pyodbc

<span class="token-keyword">def</span> <span class="token-method">crear</span>(<span class="token-property">self</span>, estudiante: Estudiante) -> int:
    query = <span class="token-string">"""
        INSERT INTO Estudiantes (Codigo, Nombre, Apellido, Email,
                               FechaNacimiento, Promedio, Activo)
        VALUES (?, ?, ?, ?, ?, ?, ?);
        SELECT CAST(SCOPE_IDENTITY() AS INT);
    """</span>
    
    <span class="token-keyword">with</span> pyodbc.connect(<span class="token-property">self</span>._connection_string) <span class="token-keyword">as</span> conn:
        <span class="token-keyword">with</span> conn.cursor() <span class="token-keyword">as</span> cursor:
            cursor.execute(query, (
                estudiante.codigo, estudiante.nombre, 
                estudiante.apellido, estudiante.email,
                estudiante.fecha_nacimiento, estudiante.promedio, 
                estudiante.activo
            ))
            <span class="token-keyword">return</span> cursor.fetchone()[<span class="token-number">0</span>]</span></code></pre>

      <h3>READ (lista) con pyodbc</h3>
      <pre><code class="language-python"><span class="token-keyword">def</span> <span class="token-method">obtener_todos</span>(<span class="token-property">self</span>) -> list[Estudiante]:
    query = <span class="token-string">"""
        SELECT Id, Codigo, Nombre, Apellido, Email,
               FechaNacimiento, Promedio, Activo, FechaCreaciÃ³n
        FROM Estudiantes
        WHERE Activo = 1
        ORDER BY Apellido, Nombre
    """</span>

    estudiantes = []
    <span class="token-keyword">with</span> pyodbc.connect(<span class="token-property">self</span>._connection_string) <span class="token-keyword">as</span> conn:
        cursor = conn.cursor()
        cursor.execute(query)
        <span class="token-keyword">for</span> row <span class="token-keyword">in</span> cursor:
            estudiantes.append(Estudiante(*row))
    <span class="token-keyword">return</span> estudiantes</code></pre>

      <h3>UPDATE y DELETE lÃ³gico</h3>
      <p><strong>DELETE lÃ³gico</strong> = Marcar un registro como inactivo (Activo = 0) en lugar de eliminarlo fÃ­sicamente. Permite recuperar datos y mantiene auditorÃ­a.</p>
      <div class="note">
        <strong>Â¿Por quÃ© DELETE lÃ³gico?</strong>
        <ul>
          <li><strong>AuditorÃ­a:</strong> Mantener historial de todos los registros</li>
          <li><strong>RecuperaciÃ³n:</strong> PodÃ©s "reactivar" un registro eliminado por error</li>
          <li><strong>Integridad:</strong> No rompe relaciones con otras tablas ( FOREIGN KEY )</li>
        </ul>
      </div>
      <pre><code class="language-python"><span class="token-keyword">def</span> <span class="token-method">actualizar</span>(<span class="token-property">self</span>, estudiante: Estudiante) -> bool:
    query = <span class="token-string">"""
        UPDATE Estudiantes
        SET Nombre = ?, Apellido = ?, Email = ?,
            FechaNacimiento = ?, Promedio = ?, Activo = ?
        WHERE Id = ?
    """</span>

    <span class="token-keyword">with</span> pyodbc.connect(<span class="token-property">self</span>._connection_string) <span class="token-keyword">as</span> conn:
        cursor = conn.cursor()
        cursor.execute(query, (
            estudiante.nombre,
            estudiante.apellido,
            estudiante.email,
            estudiante.fecha_nacimiento,
            estudiante.promedio,
            estudiante.activo,
            estudiante.id
        ))
        <span class="token-keyword">return</span> cursor.rowcount > <span class="token-number">0</span>

<span class="token-keyword">def</span> <span class="token-method">eliminar_logico</span>(<span class="token-property">self</span>, estudiante_id: int) -> bool:
    query = <span class="token-string">"UPDATE Estudiantes SET Activo = 0 WHERE Id = ?"</span>
    <span class="token-keyword">with</span> pyodbc.connect(<span class="token-property">self</span>._connection_string) <span class="token-keyword">as</span> conn:
        cursor = conn.cursor()
        cursor.execute(query, (estudiante_id,))
        <span class="token-keyword">return</span> cursor.rowcount > <span class="token-number">0</span></code></pre>
    </section>

    <section class="evaluacion-calificable">
      <h3>ğŸ“‹ EvaluaciÃ³n programada</h3>
      <p><strong>Detalle:</strong> Consultar plataforma del curso para informaciÃ³n completa sobre evaluaciÃ³n calificable.</p>
    </section>

    <section id="practica">
      <h2>PrÃ¡ctica / Laboratorio</h2>

      <h3>MenÃº en consola</h3>
      <pre><code class="language-python"><span class="token-keyword">while</span> <span class="token-keyword">True</span>:
    <span class="token-method">print</span>(<span class="token-string">"1. Crear"</span>)
    <span class="token-method">print</span>(<span class="token-string">"2. Listar"</span>)
    <span class="token-method">print</span>(<span class="token-string">"3. Buscar por ID"</span>)
    <span class="token-method">print</span>(<span class="token-string">"4. Actualizar"</span>)
    <span class="token-method">print</span>(<span class="token-string">"5. Eliminar"</span>)
    <span class="token-method">print</span>(<span class="token-string">"6. Salir"</span>)
    opcion = <span class="token-method">input</span>(<span class="token-string">"OpciÃ³n: "</span>)
    <span class="token-comment"># if/elif con llamadas a mÃ©todos CRUD</span></code></pre>

      <h3>PaginaciÃ³n OFFSET/FETCH</h3>
      <p><strong>PaginaciÃ³n</strong> = Dividir un conjunto de resultados grandes en pÃ¡ginas mÃ¡s pequeÃ±as (ej: 20 registros por pÃ¡gina) para mejorar rendimiento y UX.</p>
      <p><strong><abbr title="OFFSET/FETCH - ClÃ¡usulas de SQL Server para saltar registros y tomar un nÃºmero limitado de filas (paginaciÃ³n)">OFFSET/FETCH</abbr></strong> = OFFSET salta N registros, FETCH NEXT toma M registros a partir de ahÃ­.</p>
      <pre><code class="language-sql">SELECT Id, Codigo, Nombre, Apellido, Promedio
FROM Estudiantes
WHERE Activo = 1
ORDER BY Apellido, Nombre
OFFSET @Offset ROWS
FETCH NEXT @PageSize ROWS ONLY;</code></pre>

      <h3>Bulk insert (pyodbc + fast_executemany)</h3>
      <p><strong><abbr title="fast_executemany - OptimizaciÃ³n de pyodbc para enviar lotes de parÃ¡metros de forma eficiente">fast_executemany</abbr></strong> = OpciÃ³n de pyodbc para insertar grandes cantidades de datos muy rÃ¡pido. Es mucho mÃ¡s eficiente que INSERT individual.</p>
      <div class="note">
        <strong>Â¿Por quÃ© fast_executemany?</strong>
        <ul>
          <li><strong>Rendimiento:</strong> Puede insertar 100,000 filas en segundos</li>
          <li><strong>ImportaciÃ³n:</strong> Ideal para importar datos de Excel, CSV, etc.</li>
          <li><strong>MÃ­nimo overhead:</strong> No crea logs detallados como INSERT normal</li>
        </ul>
      </div>
      <pre><code class="language-python"><span class="token-keyword">def</span> <span class="token-method">insertar_masivo</span>(<span class="token-property">self</span>, filas: list[tuple]) -> None:
    query = <span class="token-string">"""
        INSERT INTO Estudiantes (Codigo, Nombre, Apellido, Email, FechaNacimiento, Promedio, Activo)
        VALUES (?, ?, ?, ?, ?, ?, ?)
    """</span>
    <span class="token-keyword">with</span> pyodbc.connect(<span class="token-property">self</span>._connection_string) <span class="token-keyword">as</span> conn:
        cursor = conn.cursor()
        cursor.fast_executemany = <span class="token-keyword">True</span>
        cursor.executemany(query, filas)</code></pre>

      <h3>ValidaciÃ³n previa</h3>
      <ul>
        <li>Codigo obligatorio y con prefijo.</li>
        <li>Nombre y apellido con longitud vÃ¡lida.</li>
        <li>Email en formato correcto.</li>
        <li>Promedio entre 0 y 5.</li>
      </ul>
    </section>

    <section id="ejercicios">
      <h2>Ejercicios</h2>

      <h3>BÃºsqueda por nombre</h3>
      <p><strong><abbr title="LIKE - Operador de SQL para bÃºsqueda de patrones en texto (con comodines %)">LIKE</abbr></strong> = Operador de SQL para bÃºsqueda parcial. % representa cualquier secuencia de caracteres (comodÃ­n).</p>
      <p>Ejemplo: <code>WHERE Nombre LIKE '%Mar%'</code> encuentra "MarÃ­a", "Mar", "Amargo", etc.</p>
      <p>Implementar <code>BuscarPorNombre(string tÃ©rmino)</code> con LIKE en nombre y apellido.</p>

      <div class="note">
        <strong>Mini-Chequeo: CRUD Completo</strong>
        <ul>
          <li>Â¿Por quÃ© usar DELETE lÃ³gico en lugar de DELETE fÃ­sico?</li>
          <li>Â¿CuÃ¡ndo usarÃ­as fast_executemany vs INSERT normal?</li>
          <li>Â¿CÃ³mo funciona la paginaciÃ³n con OFFSET/FETCH?</li>
        </ul>
      </div>

      <h3>PaginaciÃ³n</h3>
      <p>Modificar <code>obtener_todos</code> para aceptar pÃ¡gina y tamaÃ±o y retornar resultado paginado.</p>

      <h3>Transacciones</h3>
      <p>Crear un mÃ©todo que actualice mÃºltiples promedios en una sola transacciÃ³n.</p>

      <h3>Checklist de errores comunes</h3>
      <ul>
        <li>Concatenar strings en SQL (inyecciÃ³n).</li>
        <li>No cerrar conexiones o cursores.</li>
        <li>No manejar claves duplicadas.</li>
        <li>Usar tipos incorrectos en parÃ¡metros.</li>
      </ul>
    </section>

    <section id="equivalencia-datos-desconectados">
      <h2>Equivalencia: ADO.NET DataSet / DataAdapter â†’ Python</h2>
      
      <h3>Concepto de Datos Desconectados</h3>
      <p>En ADO.NET, el <strong>DataSet</strong> y <strong>DataAdapter</strong> permiten trabajar con datos desconectados del servidor: se cargan los datos en memoria, se manipulan localmente, y luego se sincronizan con la base de datos.</p>
      
      <div class="note">
        <h4>Equivalencia en el stack Python + Angular</h4>
        <ul>
          <li><strong>DTO (Data Transfer Object)</strong>: Clases Python que representan los datos (similar a DataTable)</li>
          <li><strong>Estado local en Angular</strong>: Servicios con BehaviorSubject o signals para mantener datos en memoria</li>
          <li><strong>SincronizaciÃ³n (sync)</strong>: Repositorio que detecta cambios y envÃ­a al backend</li>
          <li><strong>Offline-first</strong>: Almacenamiento en localStorage/IndexedDB para operar sin conexiÃ³n</li>
        </ul>
      </div>

      <h3>Arquitectura de Datos Desconectados</h3>
      <div class="code-block">
        <div class="code-header">
          <div class="code-dots">
            <span class="code-dot red"></span>
            <span class="code-dot yellow"></span>
            <span class="code-dot green"></span>
          </div>
          <span class="code-title">arquitectura_datos_desconectados.txt</span>
        </div>
        <div class="code-content">
          <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ANGULAR (FRONTEND)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Component  â”‚â†’ â”‚   Service   â”‚â†’ â”‚  Estado (Signals)   â”‚  â”‚
â”‚  â”‚    UI       â”‚  â”‚  (Repositorio)â”‚  â”‚  (como DataSet)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†“                                   â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                   â”‚localStorage â”‚ (persistencia offline)     â”‚
â”‚                   â”‚  /IndexedDB â”‚                           â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“ HTTP/REST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              FASTAPI + PYODBC (BACKEND)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Router    â”‚â†’ â”‚  Servicio   â”‚â†’ â”‚  Repositorio        â”‚  â”‚
â”‚  â”‚   API       â”‚  â”‚  Negocio    â”‚  â”‚  (pyodbc)           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                              â†“               â”‚
â”‚                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚                                       â”‚ SQL Server  â”‚        â”‚
â”‚                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
        </div>
      </div>

      <h3>Ejemplo: SincronizaciÃ³n de Estado</h3>
      <div class="code-comparison">
        <div class="code-block">
          <div class="code-header">
            <span class="code-title">estudiante.service.ts (Angular)</span>
          </div>
          <div class="code-content">
            <pre><code>// Estado local como "DataSet"
private estudiantes = signal&lt;Estudiante[]&gt;([]);

// Cargar datos (Fill)
async cargarEstudiantes() {
  const data = await http.get('/api/estudiantes');
  this.estudiantes.set(data); // En memoria
}

// Actualizar localmente
actualizarPromedio(id: number, nota: number) {
  const current = this.estudiantes();
  const updated = current.map(e => 
    e.id === id ? {...e, promedio: nota} : e
  );
  this.estudiantes.set(updated); // Cambio local
}

// Sincronizar con backend (Update)
async sincronizar() {
  await http.post('/api/estudiantes/sync', 
    this.estudiantes());
}</code></pre>
          </div>
        </div>
        <div class="code-block">
          <div class="code-header">
            <span class="code-title">repositorio.py (Python)</span>
          </div>
          <div class="code-content">
            <pre><code>class EstudianteRepo:
    def __init__(self, conn_str):
        self.conn_str = conn_str
    
    # Similar a DataAdapter.Fill()
    def obtener_todos(self) -> list[EstudianteDTO]:
        with pyodbc.connect(self.conn_str) as conn:
            cursor = conn.cursor()
            cursor.execute("SELECT * FROM Estudiantes")
            return [EstudianteDTO(*row) for row in cursor]
    
    # Similar a DataAdapter.Update()
    def sincronizar(self, cambios: list):
        with pyodbc.connect(self.conn_str) as conn:
            for dto in cambios:
                self._aplicar_cambio(conn, dto)
            conn.commit()</code></pre>
          </div>
        </div>
      </div>

      <div class="note">
        <strong>Resumen de equivalencias:</strong>
        <ul>
          <li><code>DataSet</code> â†’ Servicio Angular con signals/BehaviorSubject</li>
          <li><code>DataTable</code> â†’ Array de DTOs en memoria</li>
          <li><code>DataAdapter.Fill()</code> â†’ GET desde API, cargar en estado</li>
          <li><code>DataAdapter.Update()</code> â†’ POST/PUT a API, sincronizar cambios</li>
          <li><code>AcceptChanges()</code> â†’ Confirmar cambios en el estado local</li>
          <li><code>RejectChanges()</code> â†’ Revertir cambios locales no sincronizados</li>
        </ul>
      </div>
    </section>

    <section id="entrega-git">
      <h2>Entrega con Git</h2>
      <pre><code>git checkout -b feature/crud-pyodbc-clase-13
git add repositorio/ models/
git commit -m "chore: setup pyodbc y modelo Estudiante"
git commit -am "feat: implementa CRUD completo con pyodbc"
git commit -am "docs: agrega equivalencia datos desconectados"
git tag -a clase-13-v1 -m "Entrega clase 13 - CRUD pyodbc"</code></pre>
    </section>

    <section id="referencias">
      <h2>Referencias</h2>
      <ul>
        <li>pyodbc: <a href="https://github.com/mkleehammer/pyodbc/wiki">pyodbc Documentation</a></li>
        <li>SQL Server OFFSET/FETCH y transacciones.</li>
        <li>Python dataclasses para DTOs.</li>
        <li>Equivalencia DataSet: Angular Signals + Servicios.</li>
      </ul>
    </section>

    <section id="resumen">
      <h2>Resumen de la Clase</h2>
      <ul>
        <li>CRUD completo con Python + pyodbc usando parÃ¡metros seguros.</li>
        <li>Arquitectura por capas: presentaciÃ³n, negocio y repositorio.</li>
        <li>DELETE lÃ³gico conserva historial y evita romper relaciones.</li>
        <li>PaginaciÃ³n con OFFSET/FETCH mejora rendimiento en listados grandes.</li>
        <li>Inserciones masivas con fast_executemany.</li>
        <li>Equivalencia de datos desconectados: DTOs + estado local en Angular + sincronizaciÃ³n.</li>
      </ul>
    </section>
  </main>

  <footer style="background:#1e293b;color:#fff;text-align:center;padding:24px;margin-top:40px;">
    <p><strong>IF0100 - Lenguaje de ProgramaciÃ³n OO II</strong></p>
    <p>UNAULA - IngenierÃ­a InformÃ¡tica - 2026-I</p>
  </footer>
</body>
</html>
